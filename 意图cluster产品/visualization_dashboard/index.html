<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intent Analytics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <!-- WordCloud library - using multiple CDN fallbacks -->
    <script src="https://cdn.jsdelivr.net/npm/wordcloud@1.2.2/src/wordcloud2.js" 
            onerror="loadWordCloudFallback()"></script>
    <script>
        // Fallback solution when WordCloud library fails to load
        function loadWordCloudFallback() {
            console.warn('Primary CDN failed, trying fallback CDN...');
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/wordcloud@1.2.2/src/wordcloud2.js';
            script.onerror = function() {
                console.error('All WordCloud CDNs failed to load');
                window.WordCloudLoaded = false;
            };
            script.onload = function() {
                console.log('WordCloud library loaded successfully from fallback CDN');
                window.WordCloudLoaded = true;
                // If page is already loaded, re-render word clouds
                if (typeof renderAllWordClouds === 'function') {
                    setTimeout(renderAllWordClouds, 100);
                }
            };
            document.head.appendChild(script);
        }
        
        // Check if WordCloud loaded successfully
        window.addEventListener('load', function() {
            setTimeout(function() {
                if (typeof WordCloud !== 'undefined' || typeof window.WordCloud !== 'undefined') {
                    window.WordCloudLoaded = true;
                    console.log('WordCloud library loaded');
                } else {
                    console.error('WordCloud library not loaded');
                    window.WordCloudLoaded = false;
                }
            }, 500);
        });
    </script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Top Navigation Bar -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-brand">
                <a href="../../index.html" class="back-button" data-i18n-title="header.backTitle">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 12H5M12 19l-7-7 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span data-i18n="back">Back to Home</span>
                </a>
                <div class="brand-logo">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <div class="brand-text">
                    <span class="brand-name">Intent Analytics</span>
                    <span class="brand-subtitle" data-i18n="brand.subtitle">Intent Analytics Platform</span>
                </div>
            </div>
            
            <div class="navbar-menu">
                <a href="#" class="nav-link active" data-tab="home" data-i18n="nav.home">Home</a>
                <a href="#" class="nav-link" data-tab="overview" data-i18n="nav.overview">Overview</a>
                <a href="#" class="nav-link" data-tab="journey" data-i18n="nav.journey">Conversion Analysis</a>
                <a href="#" class="nav-link" data-tab="clusters" data-i18n="nav.clusters">User Analysis</a>
            </div>
            
            <!-- Shop Selector -->
            <div class="shop-selector-nav" id="shopSelectorContainer">
                <select id="shopSelector" class="shop-select-dropdown">
                    <option value="">Select Shop...</option>
                    <option value="28">Shop 28</option>
                    <option value="29">Shop 29</option>
                    <option value="39">Shop 39</option>
                    <option value="49">Shop 49</option>
                    <option value="53">Shop 53</option>
                </select>
            </div>
            
            <!-- Language Switcher -->
            <div class="language-switcher">
                <button class="lang-btn" id="langBtn" title="Switch Language">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                    </svg>
                    <span id="currentLang">English</span>
                </button>
            </div>
        </div>
    </nav>

    <div class="dashboard-container">
        <!-- Dashboard Header (only shown on non-home pages) -->
        <header class="dashboard-header" id="dashboardHeader" style="display: none;">
            <div class="header-content">
                <div>
                    <h1 data-i18n="header.overview">Data Overview</h1>
                    <p class="subtitle" data-i18n="header.overviewSubtitle">Real-time User Intent Analysis & Business Insights</p>
                </div>
                <div class="header-actions">
                    <div class="update-settings">
                        <div class="auto-update-selector">
                            <label for="autoUpdateInterval" data-i18n="header.autoUpdate">Auto Update:</label>
                            <select id="autoUpdateInterval" class="update-select">
                                <option value="manual" data-i18n="header.manual">Manual Update</option>
                                <option value="3days" data-i18n="header.update3days">Every 3 Days</option>
                                <option value="1week" data-i18n="header.update1week">Weekly</option>
                                <option value="1month" data-i18n="header.update1month">Monthly</option>
                                <option value="3months" data-i18n="header.update3months">Every 3 Months</option>
                            </select>
                        </div>
                        <button class="btn-update" id="updateClustersBtn" data-i18n-title="header.updateClustersTitle">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8 2v4M2 6l6-4 6 4M8 14v-4M14 10l-6 4-6-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span data-i18n="header.updateClusters">Update Clusters</span>
                        </button>
                    </div>
                    <button class="btn-secondary">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14 2v4M2 2v4M2 2h12M2 6h12v8a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V6z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                        <span data-i18n="header.selectDate">Select Date</span>
                    </button>
                    <button class="btn-primary">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8 2v12M2 8h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <span data-i18n="header.exportReport">Export Report</span>
                    </button>
                </div>
            </div>
            <div class="header-stats">
                <div class="stat-card">
                    <div class="stat-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalUsers">276</div>
                        <div class="stat-label" data-i18n="header.stats.totalUsers">Unique Users</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <polyline points="3.27 6.96 12 12.01 20.73 6.96" stroke="currentColor" stroke-width="2"/>
                            <line x1="12" y1="22.08" x2="12" y2="12" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalSegments">344</div>
                        <div class="stat-label" data-i18n="header.stats.totalSegments">Intent Segments</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2L2 7l10 5 10-5-10-5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M2 17l10 5 10-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M2 12l10 5 10-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalClusters">15</div>
                        <div class="stat-label" data-i18n="header.stats.totalClusters">User Clusters</div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="dashboard-main">
            <!-- Home Tab -->
            <div id="home" class="tab-content active">
                <div class="homepage-hero">
                    <div class="hero-content">
                        <h1 data-i18n="home.title">User Intent Clustering Analytics Platform</h1>
                        <p class="hero-subtitle" data-i18n="home.subtitle">Intelligent user segmentation based on business dimensions, driving precision marketing strategies</p>
                        <div class="hero-stats">
                            <div class="hero-stat">
                                <div class="hero-stat-value" id="homeTotalUsers">276</div>
                                <div class="hero-stat-label" data-i18n="home.stats.users">Unique Users</div>
                            </div>
                            <div class="hero-stat">
                                <div class="hero-stat-value" id="homeTotalClusters">15</div>
                                <div class="hero-stat-label" data-i18n="home.stats.clusters">User Clusters</div>
                            </div>
                            <div class="hero-stat">
                                <div class="hero-stat-value" id="homeTotalSegments">344</div>
                                <div class="hero-stat-label" data-i18n="home.stats.segments">Intent Segments</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="clustering-intro">
                    <div class="intro-header">
                        <h2 data-i18n="home.methodology.title">User Clustering Methodology</h2>
                        <p data-i18n="home.methodology.description">Intelligent clustering based on business dimensions, ensuring each cluster has clear business meaning and differentiated marketing strategies</p>
                    </div>

                    <div class="clustering-dimensions">
                        <div class="dimension-card">
                            <div class="dimension-icon">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M9 11l3 3L22 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <h3 data-i18n="home.dimensions.purchaseStage.title">Purchase Stage</h3>
                            <p data-i18n="home.dimensions.purchaseStage.desc">Identify which stage of the purchase funnel the user is in</p>
                            <div class="dimension-tags">
                                <span class="dimension-tag" data-i18n="home.dimensions.purchaseStage.tags.0">Browsing Stage</span>
                                <span class="dimension-tag" data-i18n="home.dimensions.purchaseStage.tags.1">Comparison Stage</span>
                                <span class="dimension-tag" data-i18n="home.dimensions.purchaseStage.tags.2">Decision Stage</span>
                            </div>
                        </div>

                        <div class="dimension-card">
                            <div class="dimension-icon">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <line x1="12" y1="1" x2="12" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <h3 data-i18n="home.dimensions.priceSensitivity.title">Price Sensitivity</h3>
                            <p data-i18n="home.dimensions.priceSensitivity.desc">Analyze user sensitivity to price</p>
                            <div class="dimension-tags">
                                <span class="dimension-tag" data-i18n="home.dimensions.priceSensitivity.tags.0">Price Sensitive</span>
                                <span class="dimension-tag" data-i18n="home.dimensions.priceSensitivity.tags.1">Moderate Price</span>
                                <span class="dimension-tag" data-i18n="home.dimensions.priceSensitivity.tags.2">Premium Value</span>
                            </div>
                        </div>

                        <div class="dimension-card">
                            <div class="dimension-icon">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <polyline points="22 4 12 14.01 9 11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <h3 data-i18n="home.dimensions.engagement.title">Engagement</h3>
                            <p data-i18n="home.dimensions.engagement.desc">Assess user browsing depth and engagement level</p>
                            <div class="dimension-tags">
                                <span class="dimension-tag" data-i18n="home.dimensions.engagement.tags.0">Quick Browser</span>
                                <span class="dimension-tag" data-i18n="home.dimensions.engagement.tags.1">Moderate Engagement</span>
                                <span class="dimension-tag" data-i18n="home.dimensions.engagement.tags.2">Deep Researcher</span>
                            </div>
                        </div>

                        <div class="dimension-card">
                            <div class="dimension-icon">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 7h-4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <h3 data-i18n="home.dimensions.productPreference.title">Product Preference</h3>
                            <p data-i18n="home.dimensions.productPreference.desc">Identify product types and models users are interested in</p>
                            <div class="dimension-tags">
                                <span class="dimension-tag" data-i18n="home.dimensions.productPreference.tags.0">Z6 Preference</span>
                                <span class="dimension-tag" data-i18n="home.dimensions.productPreference.tags.1">A1 Preference</span>
                                <span class="dimension-tag" data-i18n="home.dimensions.productPreference.tags.2">F1 Preference</span>
                                <span class="dimension-tag" data-i18n="home.dimensions.productPreference.tags.3">Multi-Product Comparison</span>
                            </div>
                        </div>

                        <div class="dimension-card">
                            <div class="dimension-icon">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 2L2 7l10 5 10-5-10-5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M2 17l10 5 10-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M2 12l10 5 10-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <h3 data-i18n="home.dimensions.concerns.title">Concerns</h3>
                            <p data-i18n="home.dimensions.concerns.desc">Understand product features users care most about</p>
                            <div class="dimension-tags">
                                <span class="dimension-tag" data-i18n="home.dimensions.concerns.tags.0">Function-Oriented</span>
                                <span class="dimension-tag" data-i18n="home.dimensions.concerns.tags.1">Price-Oriented</span>
                                <span class="dimension-tag" data-i18n="home.dimensions.concerns.tags.2">Comfort-Oriented</span>
                                <span class="dimension-tag" data-i18n="home.dimensions.concerns.tags.3">Effectiveness-Oriented</span>
                            </div>
                        </div>

                        <div class="dimension-card">
                            <div class="dimension-icon">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <h3 data-i18n="home.dimensions.coreNeeds.title">Core Needs</h3>
                            <p data-i18n="home.dimensions.coreNeeds.desc">Identify users' core purchase motivations</p>
                            <div class="dimension-tags">
                                <span class="dimension-tag" data-i18n="home.dimensions.coreNeeds.tags.0">Snoring Relief</span>
                                <span class="dimension-tag" data-i18n="home.dimensions.coreNeeds.tags.1">Neck Pain</span>
                                <span class="dimension-tag" data-i18n="home.dimensions.coreNeeds.tags.2">Sleep Quality</span>
                                <span class="dimension-tag" data-i18n="home.dimensions.coreNeeds.tags.3">Comprehensive Needs</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="clustering-benefits">
                    <div class="benefits-header">
                        <h2 data-i18n="home.benefits.title">Clustering Value</h2>
                        <p data-i18n="home.benefits.description">Each cluster has clear business meaning and differentiated marketing strategies</p>
                    </div>

                    <div class="benefits-grid">
                        <div class="benefit-card">
                            <div class="benefit-number" data-i18n="home.benefits.items.clear.number">01</div>
                            <h3 data-i18n="home.benefits.items.clear.title">Clear Business Differentiation</h3>
                            <p data-i18n="home.benefits.items.clear.desc">Clustering based on business dimensions, each cluster has clear labels and characteristics, easy to understand and apply</p>
                        </div>
                        <div class="benefit-card">
                            <div class="benefit-number" data-i18n="home.benefits.items.strategy.number">02</div>
                            <h3 data-i18n="home.benefits.items.strategy.title">Differentiated Marketing Strategies</h3>
                            <p data-i18n="home.benefits.items.strategy.desc">Provide unique marketing recommendations for different clusters, ensuring each group has targeted strategies</p>
                        </div>
                        <div class="benefit-card">
                            <div class="benefit-number" data-i18n="home.benefits.items.actionable.number">03</div>
                            <h3 data-i18n="home.benefits.items.actionable.title">Actionable Recommendations</h3>
                            <p data-i18n="home.benefits.items.actionable.desc">Provide specific marketing activities, content strategies, and conversion optimization recommendations that can be directly applied to business</p>
                        </div>
                        <div class="benefit-card">
                            <div class="benefit-number" data-i18n="home.benefits.items.dataDriven.number">04</div>
                            <h3 data-i18n="home.benefits.items.dataDriven.title">Data-Driven Decision Making</h3>
                            <p data-i18n="home.benefits.items.dataDriven.desc">Based on real user behavior data, ensuring the scientific and effective nature of marketing strategies</p>
                        </div>
                    </div>
                </div>

                <div class="quick-actions">
                    <h2 data-i18n="home.quickActions.title">Quick Start</h2>
                    <div class="actions-grid">
                        <a href="#" class="action-card" data-tab="overview">
                            <div class="action-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <line x1="18" y1="20" x2="18" y2="10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <line x1="12" y1="20" x2="12" y2="4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <line x1="6" y1="20" x2="6" y2="14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                            </div>
                            <h3 data-i18n="home.quickActions.overview.title">View Data Overview</h3>
                            <p data-i18n="home.quickActions.overview.desc">Understand overall user intent distribution and key metrics</p>
                        </a>
                        <a href="#" class="action-card" data-tab="clusters">
                            <div class="action-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <h3 data-i18n="home.quickActions.clusters.title">Analyze User Clusters</h3>
                            <p data-i18n="home.quickActions.clusters.desc">Deep dive into characteristics of each user group</p>
                        </a>
                        <a href="#" class="action-card business-insights-card" data-tab="financial" style="position: relative;">
                            <div class="action-icon" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 2L2 7l10 5 10-5-10-5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M2 17l10 5 10-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M2 12l10 5 10-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <h3 data-i18n="home.quickActions.businessInsights.title">Business Insights Analysis</h3>
                                <span class="beta-badge" style="font-size: 0.65rem; padding: 0.15rem 0.4rem;">BETA</span>
                            </div>
                            <p data-i18n="home.quickActions.businessInsights.desc">Intelligent user segmentation and operations strategy based on financial characteristics</p>
                        </a>
                        <a href="data_extract/results/visualizations/browser_session_cluster_dashboard.html" class="action-card">
                            <div class="action-icon" style="background: linear-gradient(135deg, rgba(240, 147, 251, 0.2) 0%, rgba(245, 87, 108, 0.2) 100%);">
                                üó∫Ô∏è
                            </div>
                            <h3>Browser Session Journey Analysis</h3>
                            <p>Interactive visualization of user journey clustering based on browser session IDs. Explore detailed timelines, behavior paths, and user journey flows with expandable cards showing step-by-step user interactions, purchase stages, and intent evolution.</p>
                        </a>
                        <a href="data_extract/results/results/deep_analysis/browser_session_deep_analysis_dashboard.html" class="action-card">
                            <div class="action-icon" style="background: linear-gradient(135deg, rgba(255, 107, 107, 0.2) 0%, rgba(238, 90, 111, 0.2) 100%);">
                                üíé
                            </div>
                            <h3>High-Value User Deep Analysis</h3>
                            <p>Comprehensive deep analysis dashboard for high-value users based on browser session data. Discover unique user profiles, distinctive characteristics, value propositions, and cluster-specific opportunities through detailed business insights and evidence-based recommendations.</p>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Overview Tab -->
            <div id="overview" class="tab-content">
                <div class="section-title">
                    <h2 data-i18n="overview.title">Data Overview</h2>
                    <p data-i18n="overview.subtitle">Overall user intent analysis overview and key metrics</p>
                </div>

                <div class="charts-grid">
                    <div class="chart-card">
                        <h3 data-i18n="overview.charts.clusterDistribution">User Cluster Distribution</h3>
                        <canvas id="clusterDistributionChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3 data-i18n="overview.charts.purchaseStage">Purchase Stage Distribution</h3>
                        <canvas id="purchaseStageChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3 data-i18n="overview.charts.pricePreference">Price Preference Distribution</h3>
                        <canvas id="pricePreferenceChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3 data-i18n="overview.charts.concerns">Core Concerns</h3>
                        <canvas id="concernsChart"></canvas>
                    </div>
                </div>

                <div class="insights-summary">
                    <div class="section-header">
                        <h3 data-i18n="overview.insights.title">Key Insights</h3>
                        <span class="section-badge" data-i18n="overview.insights.badge">Real-time Update</span>
                    </div>
                    <div class="insights-grid" id="keyInsights">
                        <!-- Dynamically generated -->
                    </div>
                </div>
            </div>

            <!-- Conversion Analysis Tab -->
            <div id="journey" class="tab-content">
                <div class="section-title">
                    <h2 data-i18n="journey.title">Conversion Analysis</h2>
                    <p data-i18n="journey.subtitle">Explore user conversion paths and intent trajectories</p>
                </div>

                <!-- Sub-tab Navigation -->
                <div class="sub-tabs">
                    <button class="sub-tab-btn active" data-sub-tab="path" onclick="switchSubTab('path')">
                        <span data-i18n="journey.tabs.path">Conversion Path</span>
                    </button>
                    <button class="sub-tab-btn" data-sub-tab="trajectory" onclick="switchSubTab('trajectory')">
                        <span data-i18n="journey.tabs.trajectory">User Trajectory</span>
                    </button>
                    <button class="sub-tab-btn" data-sub-tab="cluster" onclick="switchSubTab('cluster')">
                        <span data-i18n="journey.tabs.cluster">User Clusters</span>
                    </button>
                </div>

                <!-- Conversion Path Sub-page -->
                <div id="subTab-path" class="sub-tab-content active">
                    <div class="journey-hero">
                        <h1 data-i18n="journey.path.title">User Conversion Path Visualization</h1>
                        <p data-i18n="journey.path.subtitle">Explore the complete journey from browsing to decision, understand the distribution of different profiles at each conversion stage</p>
                    </div>
                    <div id="journeyVisualization" class="journey-container">
                        <!-- Dynamically generated conversion path -->
                    </div>
                </div>

                <!-- User Trajectory Sub-page -->
                <div id="subTab-trajectory" class="sub-tab-content">
                    <div class="section-title" style="margin-top: 0;">
                        <h3 data-i18n="journey.trajectory.title">User Intent Trajectory Analysis</h3>
                        <p data-i18n="journey.trajectory.subtitle">View intent segments for each user at different time periods and their corresponding cluster distribution</p>
                    </div>

                    <!-- Search and Filter -->
                    <div class="user-filters" style="margin-bottom: 2rem; display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;">
                        <div class="search-box" style="flex: 1; min-width: 300px;">
                            <input type="text" id="userSearch" data-i18n-placeholder="journey.trajectory.search" placeholder="Search User ID..." style="width: 100%; padding: 0.75rem 1rem; background: var(--card); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 14px;">
                        </div>
                        <div class="filter-group">
                            <label style="margin-right: 0.5rem; color: var(--text-secondary);" data-i18n="journey.trajectory.filter">Filter:</label>
                            <select id="clusterFilter" style="padding: 0.75rem 1rem; background: var(--card); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 14px;">
                                <option value="" data-i18n="journey.trajectory.allClusters">All Clusters</option>
                            </select>
                        </div>
                        <div class="sort-group">
                            <label style="margin-right: 0.5rem; color: var(--text-secondary);" data-i18n="journey.trajectory.sort">Sort:</label>
                            <select id="sortOption" style="padding: 0.75rem 1rem; background: var(--card); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 14px;">
                                <option value="time" data-i18n="journey.trajectory.sortByTime">By Time</option>
                                <option value="segments" data-i18n="journey.trajectory.sortBySegments">By Segment Count</option>
                                <option value="clusters" data-i18n="journey.trajectory.sortByClusters">By Cluster Count</option>
                            </select>
                        </div>
                    </div>

                    <!-- User List -->
                    <div id="userTrajectories" class="user-trajectories">
                        <!-- Dynamically generated -->
                    </div>
                </div>

                <!-- User Cluster Sub-page -->
                <div id="subTab-cluster" class="sub-tab-content">
                    <div class="section-title" style="margin-top: 0;">
                        <h3 data-i18n="journey.cluster.title">User Cluster Analysis</h3>
                        <p data-i18n="journey.cluster.subtitle">Deep dive into characteristics and behavior patterns of each user group</p>
                    </div>

                    <div class="cluster-selector">
                        <label for="clusterSelect" data-i18n="journey.cluster.select">Select Cluster:</label>
                        <select id="clusterSelect" onchange="showClusterDetails(this.value)">
                            <option value="" data-i18n="journey.cluster.selectPlaceholder">-- Select Cluster --</option>
                        </select>
                    </div>

                    <div id="clusterDetails" class="cluster-details">
                        <!-- Dynamically generated cluster details -->
                    </div>
                </div>
            </div>

            <!-- User Analysis Tab -->
            <div id="clusters" class="tab-content">
                <div class="section-title">
                    <h2 data-i18n="clusters.title">User Analysis</h2>
                    <p data-i18n="clusters.subtitle">Deep dive into user group characteristics and behavior patterns</p>
                </div>

                <!-- Sub-tab Navigation -->
                <div class="sub-tabs">
                    <button class="sub-tab-btn active" data-sub-tab="portrait" onclick="switchSubTab('portrait')">
                        <span data-i18n="clusters.portrait.title">User Portrait Analysis</span>
                    </button>
                </div>

                <!-- User Portrait Sub-page -->
                <div id="subTab-portrait" class="sub-tab-content active">
                    <div class="section-title" style="margin-top: 0;">
                        <h3 data-i18n="clusters.portrait.title">User Portrait Analysis</h3>
                        <p data-i18n="clusters.portrait.subtitle">Detailed user characteristics, behavior patterns, and preference analysis</p>
                    </div>

                    <div class="portrait-cards" id="portraitCards">
                        <!-- Dynamically generated -->
                    </div>
                </div>
            </div>

            <!-- Financial Market Analysis Tab (Beta) -->
            <div id="financial" class="tab-content">
                <!-- Top Business Overview -->
                <div class="financial-dashboard-header" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); padding: 2rem; border-radius: 16px; margin-bottom: 2rem; border: 1px solid var(--border);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <div>
                            <h2 style="margin: 0 0 0.5rem 0; color: var(--text); font-size: 1.75rem;">YUP User Behavior Analysis <span class="beta-badge">BETA</span></h2>
                            <p style="margin: 0; color: var(--text-secondary);">Intelligent segmentation based on user behavior characteristics to help you operate and convert precisely</p>
                        </div>
                    </div>
                    
                    <!-- Core Business Metrics -->
                    <div id="financialStats" class="financial-kpi-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem;">
                        <!-- Dynamically generated -->
                    </div>
                </div>

                <!-- Quick Insights Cards -->
                <div id="financialQuickInsights" style="margin-bottom: 2rem;">
                    <!-- Dynamically generated -->
                </div>

                <!-- Sub-tab Navigation -->
                <div class="sub-tabs">
                    <button class="sub-tab-btn active" data-sub-tab="financial-overview" onclick="switchFinancialSubTab('overview')">
                        <span>üìä User Groups</span>
                    </button>
                    <button class="sub-tab-btn" data-sub-tab="financial-portrait" onclick="switchFinancialSubTab('portrait')">
                        <span>üîÑ User Trajectories</span>
                    </button>
                    <button class="sub-tab-btn" data-sub-tab="financial-clusters" onclick="switchFinancialSubTab('clusters')">
                        <span>üéØ Operations Strategy</span>
                    </button>
                </div>

                <!-- Cluster Overview Sub-page -->
                <div id="subTab-financial-overview" class="sub-tab-content active">
                    <!-- User Group Cards -->
                    <div id="financialUserGroups" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                        <!-- Dynamically generated -->
                    </div>

                    <!-- Data Distribution Charts -->
                    <div class="section-title" style="margin-top: 2rem; margin-bottom: 1.5rem;">
                        <h3>Data Distribution</h3>
                        <p>Overview of user status and behavior distribution</p>
                    </div>

                    <div class="charts-grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">
                        <div class="chart-card">
                            <h3>User Status Distribution</h3>
                            <canvas id="financialTransactionStatusChart"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3>Identity Verification Progress</h3>
                            <canvas id="financialKYCStatusChart"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3>User Behavior Preferences</h3>
                            <canvas id="financialMainActivityChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- User Trajectory Sub-page -->
                <div id="subTab-financial-portrait" class="sub-tab-content">
                    <div class="section-title" style="margin-top: 0;">
                        <h3>User Intent Trajectory Analysis</h3>
                        <p>View intent segments for each user at different time periods and their corresponding cluster distribution</p>
                    </div>

                    <!-- Search and Filter -->
                    <div class="user-filters" style="margin-bottom: 2rem; display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;">
                        <div class="search-box" style="flex: 1; min-width: 300px;">
                            <input type="text" id="financialUserSearch" placeholder="Search User ID..." style="width: 100%; padding: 0.75rem 1rem; background: var(--card); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 14px;">
                        </div>
                        <div class="filter-group">
                            <label style="margin-right: 0.5rem; color: var(--text-secondary);">Filter:</label>
                            <select id="financialClusterFilter" style="padding: 0.75rem 1rem; background: var(--card); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 14px;">
                                <option value="">All Clusters</option>
                            </select>
                        </div>
                        <div class="sort-group">
                            <label style="margin-right: 0.5rem; color: var(--text-secondary);">Sort:</label>
                            <select id="financialSortOption" style="padding: 0.75rem 1rem; background: var(--card); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 14px;">
                                <option value="time">By Time</option>
                                <option value="segments">By Segment Count</option>
                                <option value="clusters">By Cluster Count</option>
                            </select>
                        </div>
                    </div>

                    <!-- User List -->
                    <div id="financialUserTrajectories" class="user-trajectories">
                        <!-- Dynamically generated -->
                    </div>
                </div>

                <!-- Operations Strategy Sub-page -->
                <div id="subTab-financial-clusters" class="sub-tab-content">
                    <div class="section-title" style="margin-top: 0;">
                        <h3>Precision Operations Strategy</h3>
                        <p>Personalized operations recommendations and action plans for different user groups</p>
                    </div>

                    <div class="cluster-selector" style="margin-bottom: 2rem;">
                        <label for="financialClusterSelect" style="font-weight: 600; color: var(--text); margin-right: 1rem;">Select User Group:</label>
                        <select id="financialClusterSelect" onchange="showFinancialClusterDetails(this.value)" style="padding: 0.75rem 1.5rem; background: var(--card); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 1rem; min-width: 300px;">
                            <option value="">-- Please Select User Group --</option>
                        </select>
                    </div>

                    <div id="financialClusterDetails" class="cluster-details">
                        <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">üëÜ</div>
                            <p style="font-size: 1.1rem;">Please select a user group above to view detailed operations strategy</p>
                        </div>
                    </div>
                </div>
            </div>

        </main>

        <!-- Footer -->
        <footer class="dashboard-footer">
            <div class="footer-content">
                <div class="footer-left">
                    <p>¬© 2025 Intent Analytics Platform. All rights reserved.</p>
                </div>
                <div class="footer-right">
                    <a href="#" data-i18n="footer.help">Help Documentation</a>
                    <a href="#" data-i18n="footer.api">API Documentation</a>
                    <a href="#" data-i18n="footer.contact">Contact Us</a>
                </div>
            </div>
        </footer>
    </div>

    <script src="i18n.js"></script>
    <!-- Load multi-shop data first, fallback to default data if not available -->
    <script src="multi_shop_data.js" onerror="loadDefaultData()"></script>
    <script>
        function loadDefaultData() {
            const script = document.createElement('script');
            script.src = 'data.js';
            document.head.appendChild(script);
        }
    </script>
    <script src="dashboard.js"></script>
    <script>
        // Shop switching functionality
        let currentShopId = null;
        
        // Initialize shop selector
        function initShopSelector() {
            const shopSelector = document.getElementById('shopSelector');
            const shopSelectorContainer = document.getElementById('shopSelectorContainer');
            
            if (!shopSelector) {
                console.warn('Shop selector element not found');
                return;
            }
            
            // Always show the selector container (unless on financial tab)
            if (shopSelectorContainer) {
                const currentTab = document.querySelector('.nav-link.active')?.getAttribute('data-tab');
                if (currentTab !== 'financial') {
                    shopSelectorContainer.style.display = 'block';
                }
            }
            
            // Ensure selector is enabled and clickable
            shopSelector.disabled = false;
            shopSelector.style.pointerEvents = 'auto';
            shopSelector.style.cursor = 'pointer';
            
            // Check if multi-shop data exists
            if (typeof shopSummary === 'undefined' || typeof shopData === 'undefined') {
                // If no multi-shop data, keep selector visible but show message
                console.log('Multi-shop data not loaded, using default data file');
                shopSelector.innerHTML = '<option value="">Select Shop...</option>';
                shopSelector.disabled = false; // Keep enabled even without data
                shopSelector.title = 'Multi-shop data not available';
                // Still allow clicking, just won't switch shops
                return;
            }
            
            // Enable selector
            shopSelector.disabled = false;
            shopSelector.style.pointerEvents = 'auto';
            shopSelector.style.cursor = 'pointer';
            shopSelector.title = '';
            
            // Populate shop options (exclude YUP, YUP only shown in financial analysis tab)
            shopSelector.innerHTML = '<option value="">Select Shop...</option>';
            
            // Get available shops from shopData (actual data) instead of shopSummary
            const availableShops = shopData ? Object.keys(shopData).filter(id => id !== 'YUP' && id !== 'yup') : [];
            
            if (availableShops.length > 0) {
                // Use shops that actually have data
                availableShops.forEach(shopId => {
                    const option = document.createElement('option');
                    option.value = String(shopId);
                    const stats = shopSummary?.shop_stats?.[shopId] || shopSummary?.shop_stats?.[Number(shopId)];
                    if (stats) {
                        option.textContent = `Shop ${shopId} (${stats.total_users} users)`;
                    } else {
                        option.textContent = `Shop ${shopId}`;
                    }
                    shopSelector.appendChild(option);
                });
                
                console.log(`Shop selector populated with ${availableShops.length} shops (from available data)`);
            } else if (shopSummary && shopSummary.shops && Array.isArray(shopSummary.shops)) {
                // Fallback: use shopSummary if shopData is not available
                shopSummary.shops.forEach(shopId => {
                    // Exclude YUP, as YUP is only shown in financial analysis tab
                    if (shopId === 'YUP' || shopId === 'yup') return;
                    
                    const option = document.createElement('option');
                    option.value = String(shopId);
                    const stats = shopSummary.shop_stats && (shopSummary.shop_stats[shopId] || shopSummary.shop_stats[String(shopId)]);
                    if (stats) {
                        option.textContent = `Shop ${shopId} (${stats.total_users} users)`;
                    } else {
                        option.textContent = `Shop ${shopId}`;
                    }
                    shopSelector.appendChild(option);
                });
                
                console.log(`Shop selector populated with ${shopSummary.shops.length - 1} shops (from shopSummary, excluding YUP)`);
            } else {
                console.warn('No shop data available');
                // Fallback: add default shops
                const defaultShops = [28, 29, 39, 49, 53];
                defaultShops.forEach(shopId => {
                    const option = document.createElement('option');
                    option.value = String(shopId);
                    option.textContent = `Shop ${shopId}`;
                    shopSelector.appendChild(option);
                });
            }
            
            // Listen for selection changes
            shopSelector.addEventListener('change', function(e) {
                const selectedShop = e.target.value;
                if (selectedShop) {
                    switchShop(selectedShop);
                } else {
                    // If "Select Shop..." is selected, use default data
                    loadDefaultShopData();
                }
            });
        }
        
        // Switch shop
        function switchShop(shopId) {
            console.log(`Switching to shop ${shopId}...`);
            
            // Try both string and number keys for shopData
            const shopDataObj = shopData[String(shopId)] || shopData[Number(shopId)];
            
            if (!shopDataObj) {
                console.error(`Shop ${shopId} data does not exist`);
                console.log('Available shops:', Object.keys(shopData || {}));
                alert(`Shop ${shopId} data is not available. Please check if the data file is loaded correctly.`);
                return;
            }
            
            currentShopId = shopId;
            
            console.log(`Loading shop ${shopId} data:`, {
                businessInsights: shopDataObj.businessInsights?.length || 0,
                userPortraits: shopDataObj.userPortraits?.length || 0,
                stats: shopDataObj.stats
            });
            
            // Update global data variables (use shopDataObj instead of shopData[shopId])
            window.businessInsights = shopDataObj.businessInsights || [];
            window.userPortraits = shopDataObj.userPortraits || [];
            window.stats = shopDataObj.stats || {};
            window.timeSeries = shopDataObj.timeSeries || [];
            window.userTrajectories = shopDataObj.userTrajectories || [];
            
            // Update shop indicator
            updateShopIndicator(shopId);
            
            // Update statistics at top of page
            if (typeof stats !== 'undefined' && stats) {
                const totalUsersEl = document.getElementById('totalUsers');
                const totalSegmentsEl = document.getElementById('totalSegments');
                const totalClustersEl = document.getElementById('totalClusters');
                
                if (totalUsersEl && typeof animateValue === 'function') {
                    animateValue(totalUsersEl, parseInt(totalUsersEl.textContent) || 0, stats.totalUsers || 0, 1500);
                } else if (totalUsersEl) {
                    totalUsersEl.textContent = stats.totalUsers || 0;
                }
                
                if (totalSegmentsEl && typeof animateValue === 'function') {
                    animateValue(totalSegmentsEl, parseInt(totalSegmentsEl.textContent) || 0, stats.totalSegments || 0, 1500);
                } else if (totalSegmentsEl) {
                    totalSegmentsEl.textContent = stats.totalSegments || 0;
                }
                
                if (totalClustersEl && typeof animateValue === 'function') {
                    animateValue(totalClustersEl, parseInt(totalClustersEl.textContent) || 0, stats.totalClusters || 0, 1500);
                } else if (totalClustersEl) {
                    totalClustersEl.textContent = stats.totalClusters || 0;
                }
            }
            
            // Reload current tab content
            const activeTab = document.querySelector('.tab-content.active');
            if (activeTab) {
                const tabName = activeTab.id;
                if (typeof loadTabContent === 'function') {
                    loadTabContent(tabName);
                }
            }
        }
        
        // Load default shop data
        function loadDefaultShopData() {
            // If default data.js exists, use it
            if (typeof businessInsights !== 'undefined') {
                currentShopId = null;
                const activeTab = document.querySelector('.tab-content.active');
                if (activeTab && typeof loadTabContent === 'function') {
                    loadTabContent(activeTab.id);
                }
            }
        }
        
        // Update shop indicator
        function updateShopIndicator(shopId) {
            const shopStats = shopSummary.shop_stats[shopId];
            if (shopStats) {
                const shopSelector = document.getElementById('shopSelector');
                if (shopSelector) {
                    shopSelector.title = `Shop ${shopId} - ${shopStats.total_users} users, ${shopStats.total_segments} segments, ${shopStats.total_clusters} clusters`;
                }
            }
        }
        
        // Initialize after page load
        window.addEventListener('load', function() {
            // Ensure shop selector container is visible
            const shopSelectorContainer = document.getElementById('shopSelectorContainer');
            if (shopSelectorContainer) {
                const currentTab = document.querySelector('.nav-link.active')?.getAttribute('data-tab');
                if (currentTab !== 'financial') {
                    shopSelectorContainer.style.display = 'block';
                }
            }
            
            // Delay initialization to ensure data is loaded
            setTimeout(function() {
                initShopSelector();
                
                // Retry if data not loaded yet (up to 3 times)
                let retryCount = 0;
                const maxRetries = 3;
                function retryInit() {
                    if ((typeof shopSummary === 'undefined' || typeof shopData === 'undefined') && retryCount < maxRetries) {
                        retryCount++;
                        console.log(`Retrying shop selector initialization (attempt ${retryCount}/${maxRetries})...`);
                        setTimeout(function() {
                            initShopSelector();
                            retryInit();
                        }, 1000);
                    } else if (retryCount >= maxRetries) {
                        console.warn('Shop selector initialization failed after max retries');
                    }
                }
                retryInit();
                
            // If multi-shop data exists and no shop is selected, auto-select first shop (exclude YUP)
                if (typeof shopSummary !== 'undefined' && typeof shopData !== 'undefined' && shopSummary.shops.length > 0) {
                const shopsWithoutYUP = shopSummary.shops.filter(s => s !== 'YUP');
                if (shopsWithoutYUP.length > 0 && !currentShopId) {
                    const firstShop = shopsWithoutYUP[0];
                        switchShop(firstShop);
                    }
                }
            }, 1000);
        });
    </script>
</body>
</html>

