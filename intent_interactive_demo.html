<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Real-time Intent Experience | Intent Recognition Demo</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
  
  :root {
    --primary: #00ff88;
    --primary-dark: #00cc6f;
    --bg-dark: #000000;
    --bg-secondary: #0a0a0a;
    --text-primary: #ffffff;
    --text-secondary: #a0a0a0;
    --border: rgba(255, 255, 255, 0.08);
    --glass: rgba(255, 255, 255, 0.03);
    --shop-bg: #ffffff;
    --shop-text: #1a1a1a;
    --shop-border: #e5e5e5;
  }
  
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  
 body {
    margin: 0;
    padding: 0;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg-dark);
    color: var(--text-primary);
    display: flex;
    flex-direction: column;
    height: 100vh;
    position: relative;
    overflow: hidden;
  }
  
  /* Grain texture */
  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.4'/%3E%3C/svg%3E");
    opacity: 0.1;
    pointer-events: none;
    z-index: 1;
  }
  
  .navbar {
    background: rgba(10, 10, 10, 0.8);
    border-bottom: 1px solid var(--border);
    padding: 16px 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    backdrop-filter: blur(20px);
    z-index: 1000;
    position: relative;
  }
  
  .navbar-brand {
    font-weight: 700;
    font-size: 16px;
    letter-spacing: -0.5px;
    color: var(--text-primary);
  }
  
  .navbar-links {
    display: flex;
    gap: 12px;
    align-items: center;
  }
  
  .navbar a {
    color: var(--text-primary);
    text-decoration: none;
    padding: 10px 20px;
    border-radius: 8px;
    font-size: 14px;
    transition: all 0.2s;
    font-weight: 500;
    opacity: 0.8;
  }
  
  .navbar a:hover {
    background: var(--glass);
    opacity: 1;
  }
  
  .navbar .home-link {
    background: rgba(0, 255, 136, 0.1);
    color: var(--primary);
    border: 1px solid rgba(0, 255, 136, 0.2);
  }
  
  .navbar .home-link:hover {
    background: rgba(0, 255, 136, 0.15);
    border-color: rgba(0, 255, 136, 0.3);
  }
  
  .content-wrapper {
    display: flex;
    flex: 1;
    overflow: hidden;
    position: relative;
    z-index: 2;
  }
  
  /* Left: Simulated Independent Store */
  .shop-panel {
    width: 50%;
    background: var(--shop-bg);
    border-right: 1px solid var(--border);
    position: relative;
    overflow-y: auto;
    color: var(--shop-text);
  }
  
  .shop-panel::-webkit-scrollbar {
    width: 8px;
  }
  
  .shop-panel::-webkit-scrollbar-thumb {
    background: var(--shop-border);
    border-radius: 4px;
  }
  
  /* Store Navigation Bar */
  .shop-header {
    background: var(--shop-bg);
    border-bottom: 1px solid var(--shop-border);
    padding: 16px 40px;
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(10px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
  }
  
  .shop-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .shop-logo {
    font-size: 22px;
    font-weight: 700;
    color: var(--shop-text);
    letter-spacing: -0.5px;
  }
  
  .shop-menu {
    display: flex;
    gap: 40px;
    list-style: none;
    align-items: center;
  }
  
  .shop-menu li {
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: color 0.2s;
    position: relative;
  }
  
  .shop-menu li:hover {
    color: #333;
  }
  
  .shop-menu li::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 0;
    height: 2px;
    background: #333;
    transition: width 0.3s;
  }
  
  .shop-menu li:hover::after {
    width: 100%;
  }
  
  .shop-actions {
    display: flex;
    gap: 20px;
    align-items: center;
  }
  
  .shop-search {
    display: flex;
    align-items: center;
    background: #f5f5f5;
    border-radius: 20px;
    padding: 8px 16px;
    gap: 8px;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .shop-search:hover {
    background: #e8e8e8;
  }
  
  .shop-search-icon {
    width: 16px;
    height: 16px;
    opacity: 0.5;
  }
  
  .shop-search input {
    border: none;
    background: transparent;
    outline: none;
    font-size: 14px;
    width: 120px;
  }
  
  .shop-cart {
    width: 24px;
    height: 24px;
    cursor: pointer;
    opacity: 0.7;
    transition: opacity 0.2s;
  }
  
  .shop-cart:hover {
    opacity: 1;
  }
  
  /* Hero Banner */
  .shop-banner {
    background: linear-gradient(135deg, #00ff88 0%, #7da6ff 100%);
    color: white;
    padding: 100px 40px;
    text-align: center;
    margin: 0;
    position: relative;
    overflow: hidden;
  }
  
  .shop-banner::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    opacity: 0.3;
  }
  
  .shop-banner h2 {
    font-size: 52px;
    font-weight: 800;
    margin-bottom: 16px;
    position: relative;
    z-index: 1;
    letter-spacing: -1px;
  }
  
  .shop-banner p {
    font-size: 20px;
    opacity: 0.95;
    position: relative;
    z-index: 1;
    margin-bottom: 32px;
  }
  
  .shop-banner-btn {
    background: white;
    color: #00ff88;
    padding: 14px 32px;
    border-radius: 30px;
    font-weight: 600;
    font-size: 16px;
    border: none;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    z-index: 1;
  }
  
  .shop-banner-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
  }
  
  /* Product Banner Area */
  .product-banners {
    padding: 60px 40px;
    background: #fafafa;
  }
  
  .banner-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 24px;
    margin-bottom: 60px;
  }
  
  .product-banner-card {
    background: white;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
  }
  
  .product-banner-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
  }
  
  .banner-image {
    width: 100%;
    height: 280px;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    position: relative;
    overflow: hidden;
  }
  
  .banner-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .banner-content {
    padding: 32px;
  }
  
  .banner-content h3 {
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 12px;
    color: var(--shop-text);
  }
  
  .banner-content p {
    font-size: 15px;
    color: #666;
    line-height: 1.6;
    margin-bottom: 20px;
  }
  
  .banner-link {
    color: #00ff88;
    font-weight: 600;
    font-size: 14px;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: gap 0.2s;
  }
  
  .banner-link:hover {
    gap: 12px;
  }
  
  /* Category Tags */
  .category-tags {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: 40px;
    padding: 0 40px;
  }
  
  .category-tag {
    padding: 10px 24px;
    background: white;
    border: 2px solid var(--shop-border);
    border-radius: 30px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .category-tag:hover,
  .category-tag.active {
    background: #333;
    color: white;
    border-color: #333;
  }
  
  /* Product Grid */
  .products-section {
    padding: 60px 40px;
  }
  
  .section-title {
    font-size: 32px;
    font-weight: 700;
    margin-bottom: 40px;
    text-align: center;
  }
  
  .products-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 32px;
    margin-bottom: 60px;
  }
  
  .product-card {
    background: var(--shop-bg);
    border: 1px solid var(--shop-border);
    border-radius: 12px;
    overflow: hidden;
    cursor: pointer;
    opacity: 0;
    transform: translateY(20px) scale(0.95);
    transition: box-shadow 0.3s, border-color 0.3s, transform 0.3s;
    animation: product-card-appear 0.8s ease-out forwards;
    visibility: hidden;
  }
  
  /* Ensure cards are visible after animation completes */
  .product-card[style*="opacity: 1"],
  .product-card:not([style*="opacity: 0"]) {
    visibility: visible !important;
  }
  
  /* State after animation completes */
  .product-card.animation-complete {
    opacity: 1 !important;
    visibility: visible !important;
    transform: translateY(0) scale(1) !important;
  }
  
  /* Use more precise selectors for cards in each grid */
  .products-grid .product-card:nth-child(1) { animation-delay: 1.2s; }
  .products-grid .product-card:nth-child(2) { animation-delay: 1.4s; }
  .products-grid .product-card:nth-child(3) { animation-delay: 1.6s; }
  .products-grid .product-card:nth-child(4) { animation-delay: 1.8s; }
  .products-grid .product-card:nth-child(5) { animation-delay: 2.0s; }
  .products-grid .product-card:nth-child(6) { animation-delay: 2.2s; }
  
  @keyframes product-card-appear {
    0% {
      opacity: 0;
      visibility: hidden;
      transform: translateY(20px) scale(0.95);
    }
    100% {
      opacity: 1;
      visibility: visible;
      transform: translateY(0) scale(1);
    }
  }
  
  /* Ensure hover effects are only applied after animation completes */
  .product-card:hover {
    transform: translateY(-4px) scale(1) !important;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    border-color: #999;
  }
  
  .product-image {
    width: 100%;
    height: 300px;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 48px;
    color: #999;
    position: relative;
    overflow: hidden;
  }
  
  .product-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s;
    display: block;
  }
  
  .product-image img[src=""],
  .product-image img:not([src]) {
    display: none;
  }
  
  .product-card:hover .product-image img {
    transform: scale(1.05);
  }
  
  .product-image.fallback {
    font-size: 48px;
    color: #999;
  }
  
  .product-image.fallback img {
    display: none;
  }
  
  .product-info {
    padding: 24px;
  }
  
  .product-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 8px;
  }
  
  .product-price {
    font-size: 20px;
    font-weight: 700;
    color: #333;
    margin-bottom: 16px;
  }
  
  .product-actions {
    display: flex;
    gap: 12px;
  }
  
  .btn-add-cart {
    flex: 1;
    padding: 12px 20px;
    background: var(--primary);
    color: var(--bg-dark);
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    font-family: 'Inter', sans-serif;
  }
  
  .btn-add-cart:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 255, 136, 0.3);
  }
  
  .btn-add-cart:active {
    transform: translateY(0);
  }
  
  .btn-view {
    padding: 12px 20px;
    background: transparent;
    color: #333;
    border: 2px solid var(--shop-border);
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    font-family: 'Inter', sans-serif;
  }
  
  .btn-view:hover {
    border-color: #999;
    background: #f5f5f5;
  }
  
  /* Guide Tooltips */
  .guide-tooltip {
    position: absolute;
    background: var(--primary);
    color: var(--bg-dark);
    padding: 12px 20px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    z-index: 1000;
    pointer-events: none;
    opacity: 0;
    transform: translateY(-10px);
    transition: all 0.3s;
  }
  
  .guide-tooltip.show {
    opacity: 1;
    transform: translateY(0);
  }
  
  .guide-tooltip::after {
    content: '';
    position: absolute;
    bottom: -6px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-top: 6px solid var(--primary);
  }
  
  /* Guide Animation */
  .guide-highlight {
    position: relative;
    z-index: 10;
    animation: pulse-glow 2s ease-in-out infinite;
  }
  
  /* Ensure highlight doesn't affect product card display */
  .product-card.guide-highlight {
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
  }
  
  @keyframes pulse-glow {
    0%, 100% {
      box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.4);
    }
    50% {
      box-shadow: 0 0 0 8px rgba(0, 255, 136, 0);
    }
  }
  
  .guide-arrow {
    position: absolute;
    z-index: 999;
    pointer-events: none;
    animation: bounce-arrow 1.5s ease-in-out infinite;
  }
  
  @keyframes bounce-arrow {
    0%, 100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-10px);
    }
  }
  
  .guide-arrow svg {
    width: 32px;
    height: 32px;
    fill: var(--primary);
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
  }
  
  .guide-hint {
    position: absolute;
    background: linear-gradient(135deg, var(--primary) 0%, #7da6ff 100%);
    color: var(--bg-dark);
    padding: 14px 20px;
    border-radius: 12px;
    font-size: 15px;
    font-weight: 600;
    white-space: nowrap;
    z-index: 1001;
    pointer-events: none;
    animation: fade-in-out 4s ease-in-out infinite, hint-bounce 2.5s ease-in-out infinite;
    box-shadow: 0 4px 20px rgba(0, 255, 136, 0.4);
    border: 2px solid rgba(255, 255, 255, 0.3);
    transition: opacity 0.5s, transform 0.5s;
  }
  
  @keyframes hint-bounce {
    0%, 100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-8px);
    }
  }
  
  @keyframes fade-in-out {
    0%, 100% {
      opacity: 0;
      transform: translateY(-5px);
    }
    15%, 85% {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .guide-hint::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 8px solid transparent;
    border-right: 8px solid transparent;
    border-top: 8px solid var(--primary);
    filter: drop-shadow(0 2px 4px rgba(0, 255, 136, 0.3));
  }
  
  /* Guide Overlay */
  .guide-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.3);
    z-index: 998;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
  }
  
  .guide-overlay.active {
    opacity: 1;
    pointer-events: all;
  }
  
  /* Guide Step Indicator */
  .guide-steps {
    position: fixed;
    bottom: 40px;
    right: 40px;
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.95) 0%, rgba(10, 10, 10, 0.95) 100%);
    color: white;
    padding: 24px 28px;
    border-radius: 16px;
    z-index: 1002;
    min-width: 280px;
    border: 2px solid var(--primary);
    box-shadow: 0 8px 32px rgba(0, 255, 136, 0.3), 0 0 0 4px rgba(0, 255, 136, 0.1);
    animation: guide-pulse 2s ease-in-out infinite;
    backdrop-filter: blur(10px);
  }
  
  @keyframes guide-pulse {
    0%, 100% {
      box-shadow: 0 8px 32px rgba(0, 255, 136, 0.3), 0 0 0 4px rgba(0, 255, 136, 0.1);
      transform: scale(1);
    }
    50% {
      box-shadow: 0 8px 40px rgba(0, 255, 136, 0.5), 0 0 0 8px rgba(0, 255, 136, 0.2);
      transform: scale(1.02);
    }
  }
  
  .guide-steps h4 {
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 16px;
    color: var(--primary);
    display: flex;
    align-items: center;
    gap: 8px;
    letter-spacing: 0.5px;
  }
  
  .guide-steps h4::before {
    content: '✨';
    font-size: 18px;
    animation: sparkle 2s ease-in-out infinite;
  }
  
  .guide-journey-hint {
    font-size: 11px;
    color: rgba(255, 255, 255, 0.6);
    margin: -8px 0 12px 0;
    letter-spacing: 0.5px;
  }
  
  @keyframes sparkle {
    0%, 100% { transform: scale(1) rotate(0deg); }
    50% { transform: scale(1.2) rotate(180deg); }
  }
  
  .guide-step {
    font-size: 14px;
    padding: 10px 0;
    opacity: 0.5;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 500;
  }
  
  .guide-step.active {
    opacity: 1;
    color: var(--primary);
    font-weight: 600;
    transform: translateX(4px);
    text-shadow: 0 0 8px rgba(0, 255, 136, 0.5);
  }
  
  .guide-step.completed {
    opacity: 0.8;
    color: rgba(255, 255, 255, 0.7);
  }
  
  .guide-step::before {
    content: '○';
    font-size: 12px;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    transition: all 0.3s;
  }
  
  .guide-step.active::before {
    content: '●';
    color: var(--primary);
    background: rgba(0, 255, 136, 0.2);
    box-shadow: 0 0 12px rgba(0, 255, 136, 0.6);
    animation: active-dot 1.5s ease-in-out infinite;
  }
  
  @keyframes active-dot {
    0%, 100% {
      box-shadow: 0 0 12px rgba(0, 255, 136, 0.6);
      transform: scale(1);
    }
    50% {
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.9);
      transform: scale(1.1);
    }
  }
  
  .guide-step.completed::before {
    content: '✓';
    color: var(--primary);
    background: rgba(0, 255, 136, 0.15);
    font-size: 14px;
    font-weight: bold;
  }
  
  /* Guide Tooltip Popup */
  .guide-notification {
    position: fixed;
    top: 80px;
    right: 40px;
    background: linear-gradient(135deg, var(--primary) 0%, #7da6ff 100%);
    color: var(--bg-dark);
    padding: 20px 24px;
    border-radius: 16px;
    z-index: 1003;
    min-width: 320px;
    box-shadow: 0 8px 32px rgba(0, 255, 136, 0.4);
    animation: slide-in-right 0.5s ease-out, notification-pulse 2s ease-in-out infinite 0.5s;
    transform: translateX(0);
  }
  
  @keyframes slide-in-right {
    from {
      transform: translateX(400px);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  @keyframes notification-pulse {
    0%, 100% {
      box-shadow: 0 8px 32px rgba(0, 255, 136, 0.4);
    }
    50% {
      box-shadow: 0 8px 40px rgba(0, 255, 136, 0.6);
    }
  }
  
  .guide-notification h5 {
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .guide-notification p {
    font-size: 14px;
    line-height: 1.5;
    opacity: 0.9;
  }
  
  .guide-notification-close {
    position: absolute;
    top: 12px;
    right: 12px;
    width: 24px;
    height: 24px;
    border: none;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 50%;
    color: var(--bg-dark);
    cursor: pointer;
    font-size: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }
  
  .guide-notification-close:hover {
    background: rgba(0, 0, 0, 0.3);
    transform: scale(1.1);
  }
  
  /* Right: Intent Recognition Output */
  .intent-panel {
    width: 50%;
    padding: 40px;
    overflow-y: auto;
    background: var(--bg-dark);
    position: relative;
  }
  
  .intent-panel::-webkit-scrollbar {
    width: 6px;
  }
  
  .intent-panel::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 3px;
  }
  
  .intent-header {
    margin-bottom: 32px;
  }
  
  .intent-header h2 {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 8px;
    letter-spacing: -0.5px;
  }
  
  .intent-header .subtitle {
    font-size: 14px;
    color: var(--text-secondary);
  }
  
  .intent-status {
    display: inline-block;
    padding: 6px 12px;
    background: rgba(0, 255, 136, 0.1);
    border: 1px solid rgba(0, 255, 136, 0.2);
    border-radius: 6px;
    font-size: 12px;
    color: var(--primary);
    font-weight: 600;
    margin-bottom: 24px;
  }
  
  /* Conversion Funnel Visualization */
  .conversion-funnel {
    background: var(--glass);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 24px;
  }
  
  .conversion-funnel h3 {
    font-size: 16px;
    font-weight: 600;
    color: var(--primary);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .funnel-steps {
    display: flex;
    justify-content: space-between;
    gap: 12px;
    position: relative;
  }
  
  .funnel-steps::before {
    content: '';
    position: absolute;
    top: 20px;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--border);
    z-index: 0;
  }
  
  .funnel-step {
    flex: 1;
    text-align: center;
    position: relative;
    z-index: 1;
  }
  
  .funnel-step-circle {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--border);
    border: 2px solid var(--border);
    margin: 0 auto 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    font-weight: 700;
    color: var(--text-secondary);
    transition: all 0.5s;
    position: relative;
  }
  
  .funnel-step.active .funnel-step-circle {
    background: var(--primary);
    border-color: var(--primary);
    color: var(--bg-dark);
    box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
    transform: scale(1.1);
  }
  
  .funnel-step.completed .funnel-step-circle {
    background: rgba(0, 255, 136, 0.3);
    border-color: var(--primary);
    color: var(--primary);
  }
  
  .funnel-step.completed .funnel-step-circle::after {
    content: '✓';
    position: absolute;
    font-size: 16px;
  }
  
  .funnel-step-label {
    font-size: 12px;
    color: var(--text-secondary);
    font-weight: 500;
    transition: color 0.3s;
  }
  
  .funnel-step.active .funnel-step-label {
    color: var(--primary);
    font-weight: 600;
  }
  
  .funnel-step.completed .funnel-step-label {
    color: var(--text-secondary);
    opacity: 0.8;
  }
  
  .funnel-progress {
    height: 4px;
    background: var(--border);
    border-radius: 2px;
    margin-top: 16px;
    overflow: hidden;
    position: relative;
  }
  
  .funnel-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), #7da6ff);
    border-radius: 2px;
    transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
  }
  
  .funnel-progress-bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    animation: shimmer 2s infinite;
  }
  
  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }
  
  .intent-card {
    background: var(--glass);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 20px;
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .intent-card.show {
    opacity: 1;
    transform: translateY(0);
    animation: card-appear 1s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  @keyframes card-appear {
    0% {
      opacity: 0;
      transform: translateY(30px) scale(0.96);
    }
    60% {
      transform: translateY(-3px) scale(1.01);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
  
  /* Page Loading Animation */
  .page-loading {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--bg-dark);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 24px;
    opacity: 1;
    transition: opacity 1s ease-out;
  }
  
  .page-loading.hide {
    opacity: 0;
    pointer-events: none;
  }
  
  .loading-logo {
    font-size: 48px;
    font-weight: 800;
    background: linear-gradient(135deg, var(--primary) 0%, #7da6ff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: logo-fade-in 1.2s ease-out;
  }
  
  @keyframes logo-fade-in {
    0% {
      opacity: 0;
      transform: translateY(20px) scale(0.9);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
  
  .loading-text {
    font-size: 16px;
    color: var(--text-secondary);
    animation: text-fade-in 1.5s ease-out;
  }
  
  @keyframes text-fade-in {
    0%, 50% {
      opacity: 0;
    }
    100% {
      opacity: 1;
    }
  }
  
  .loading-progress {
    width: 200px;
    height: 2px;
    background: var(--border);
    border-radius: 1px;
    overflow: hidden;
    margin-top: 8px;
  }
  
  .loading-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), #7da6ff);
    border-radius: 1px;
    width: 0%;
    animation: progress-load 2s ease-out forwards;
  }
  
  @keyframes progress-load {
    0% {
      width: 0%;
    }
    100% {
      width: 100%;
    }
  }
  
  /* Shop Panel Initial Animation */
  .shop-panel {
    opacity: 0;
    animation: panel-fade-in 1.2s ease-out 0.5s forwards;
    position: relative;
  }
  
  @keyframes panel-fade-in {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
  
  /* Video Player Component (9:16 format, floating above simulated webpage as independent plugin) */
  .video-player-widget {
    position: fixed;
    bottom: 20px;
    right: calc(50% + 20px);
    width: 220px;
    aspect-ratio: 9 / 16;
    z-index: 10000;
    overflow: hidden;
    pointer-events: auto;
    opacity: 0;
    transform: translateY(20px) scale(0.95);
    transition: opacity 0.8s ease, transform 0.8s ease, box-shadow 0.3s ease;
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    background: #000;
    border: 2px solid transparent;
  }
  
  .video-player-widget.loaded {
    opacity: 1;
    transform: translateY(0) scale(1);
    border-color: rgba(125, 166, 255, 0.3);
    box-shadow: 0 12px 48px rgba(125, 166, 255, 0.2), 0 8px 32px rgba(0, 0, 0, 0.4);
    animation: videoWidgetPulse 3s ease-in-out infinite;
  }
  
  @keyframes videoWidgetPulse {
    0%, 100% {
      box-shadow: 0 12px 48px rgba(125, 166, 255, 0.2), 0 8px 32px rgba(0, 0, 0, 0.4);
      border-color: rgba(125, 166, 255, 0.3);
    }
    50% {
      box-shadow: 0 16px 56px rgba(125, 166, 255, 0.4), 0 12px 40px rgba(0, 0, 0, 0.5);
      border-color: rgba(125, 166, 255, 0.5);
    }
  }
  
  .video-player-widget.highlight {
    border-color: rgba(0, 255, 136, 0.8) !important;
    box-shadow: 0 20px 60px rgba(0, 255, 136, 0.4), 0 12px 40px rgba(0, 0, 0, 0.5) !important;
    animation: videoWidgetHighlight 1.5s ease-in-out infinite;
    transform: scale(1.05) !important;
  }
  
  @keyframes videoWidgetHighlight {
    0%, 100% {
      box-shadow: 0 20px 60px rgba(0, 255, 136, 0.4), 0 12px 40px rgba(0, 0, 0, 0.5);
    }
    50% {
      box-shadow: 0 24px 70px rgba(0, 255, 136, 0.6), 0 16px 50px rgba(0, 0, 0, 0.6);
    }
  }
  
  .product-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }
  
  .video-controls-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    opacity: 1;
    display: flex;
    flex-direction: column;
  }
  
  .video-controls-top {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    padding: 12px;
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    pointer-events: auto;
    z-index: 20;
  }
  
  .video-controls-top-left {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .video-controls-top-right {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 8px;
  }
  
  /* Top Center Text */
  .video-intro-text {
    position: absolute;
    top: 12px;
    left: 50%;
    transform: translateX(-50%);
    color: white;
    font-size: 13px;
    font-weight: 600;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    pointer-events: none;
    z-index: 5;
    letter-spacing: 0.5px;
  }
  
  /* Right Vertical Labels */
  .video-side-label {
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%) rotate(90deg);
    transform-origin: center;
    background: rgba(0, 0, 0, 0.6);
    color: white;
    font-size: 11px;
    font-weight: 600;
    padding: 6px 12px;
    writing-mode: vertical-rl;
    text-orientation: mixed;
    pointer-events: none;
    z-index: 5;
    letter-spacing: 1px;
  }
  
  /* Video Widget Attention Badge */
  .video-attention-badge {
    position: absolute;
    top: -12px;
    right: -12px;
    background: linear-gradient(135deg, #00ff88 0%, #00cc6f 100%);
    color: #000;
    font-size: 10px;
    font-weight: 700;
    padding: 4px 8px;
    border-radius: 12px;
    z-index: 10001;
    pointer-events: none;
    opacity: 0;
    transform: scale(0);
    transition: opacity 0.3s ease, transform 0.3s ease;
    box-shadow: 0 4px 12px rgba(0, 255, 136, 0.4);
    animation: badgePulse 2s ease-in-out infinite;
  }
  
  .video-player-widget.highlight .video-attention-badge {
    opacity: 1;
    transform: scale(1);
  }
  
  @keyframes badgePulse {
    0%, 100% {
      transform: scale(1);
      box-shadow: 0 4px 12px rgba(0, 255, 136, 0.4);
    }
    50% {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(0, 255, 136, 0.6);
    }
  }
  
  /* Bottom Product Info Overlay */
  .video-product-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: transparent;
    padding: 8px 6px;
    pointer-events: auto;
    z-index: 15;
    overflow: visible;
  }
  
  .video-product-text {
    color: white;
    font-size: 12px;
    line-height: 1.4;
    margin-bottom: 10px;
    opacity: 0.9;
  }
  
  .video-product-card {
    background: #ffffff;
    border-radius: 14px;
    padding: 10px;
    display: flex;
    gap: 10px;
    align-items: flex-start;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12), 0 1px 3px rgba(0, 0, 0, 0.08);
    width: calc(100% - 12px);
    max-width: calc(100% - 12px);
    box-sizing: border-box;
    margin: 0 auto;
    overflow: visible;
  }
  
  .video-product-thumbnail {
    width: 55px;
    height: 55px;
    min-width: 55px;
    max-width: 55px;
    border-radius: 10px;
    background: #e3f2fd;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 18px;
    overflow: hidden;
    position: relative;
    padding: 3px;
    box-sizing: border-box;
  }
  
  .video-product-thumbnail::before {
    content: '';
    position: absolute;
    top: 3px;
    left: 3px;
    right: 3px;
    bottom: 3px;
    background: linear-gradient(135deg, #64b5f6 0%, #42a5f5 100%);
    border-radius: 7px;
    z-index: 0;
  }
  
  .video-product-thumbnail img {
    width: calc(100% - 6px);
    height: calc(100% - 6px);
    object-fit: cover;
    display: block;
    position: relative;
    z-index: 2;
    border-radius: 7px;
    margin: 3px;
  }
  
  .video-product-thumbnail .thumbnail-placeholder {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
    display: block;
  }
  
  .video-product-thumbnail.has-image .thumbnail-placeholder {
    display: none;
  }
  
  .video-product-info {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 4px;
    justify-content: flex-start;
    overflow: visible;
  }
  
  .video-product-name {
    color: #1a1a1a;
    font-size: 11px;
    font-weight: 700;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.3;
    letter-spacing: -0.2px;
    margin: 0;
  }
  
  .video-product-description {
    color: #666;
    font-size: 9px;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
    margin: 0;
  }
  
  .video-product-price-row {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    margin-top: 4px;
    width: 100%;
  }
  
  .video-product-price {
    display: flex;
    align-items: baseline;
    gap: 6px;
    flex: 0 1 auto;
    min-width: 0;
  }
  
  .video-product-original-price {
    color: #999;
    font-size: 5px;
    text-decoration: line-through;
  }
  
  .video-product-discount-price {
    color: #dc2626;
    font-size: 7px;
    font-weight: 700;
    line-height: 1;
    white-space: nowrap;
  }
  
  .video-product-actions {
    display: flex;
    gap: 6px;
    flex-shrink: 0;
    visibility: visible !important;
    opacity: 1 !important;
    flex: 0 0 auto;
  }
  
  .video-btn-add-cart,
  .video-btn-buy-now {
    padding: 2px 7px;
    border: none;
    border-radius: 3px;
    font-size: 6px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    white-space: nowrap;
  }
  
  .video-btn-add-cart {
    display: none;
  }
  
  .video-btn-buy-now {
    background: #dc2626;
    color: #ffffff;
    padding: 2px 7px;
    width: auto;
    min-width: 31px;
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
    position: relative;
    z-index: 10;
    flex-shrink: 0;
  }
  
  .video-btn-buy-now:hover {
    background: #b91c1c;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
  }
  
  .video-btn-buy-now:active {
    transform: translateY(0);
  }
  
  .video-btn-add-cart span:not(:first-child),
  .video-btn-buy-now span:not(:first-child) {
    display: none;
  }
  
  .video-controls-right {
    position: absolute;
    top: 60px;
    right: 12px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    pointer-events: auto;
    z-index: 20;
  }
  
  .video-control-btn {
    width: 24px;
    height: 24px;
    background: rgba(60, 60, 60, 0.9);
    border: none;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    color: white;
    backdrop-filter: blur(10px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
    flex-shrink: 0;
  }
  
  .video-control-btn:hover {
    background: rgba(80, 80, 80, 0.95);
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
  }
  
  .video-control-btn:active {
    transform: scale(0.95);
  }
  
  .video-control-btn svg {
    width: 12px;
    height: 12px;
  }
  
  /* Narration / sound button */
  .video-narration-btn {
    position: absolute;
    right: 12px;
    top: 60px;
    background: rgba(60, 60, 60, 0.9);
    border: none;
    border-radius: 15px;
    padding: 7px 12px;
    display: flex;
    align-items: center;
    gap: 7px;
    cursor: pointer;
    transition: all 0.2s ease;
    color: white;
    font-size: 9px;
    font-weight: 500;
    pointer-events: auto;
    z-index: 20;
    backdrop-filter: blur(10px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
    white-space: nowrap;
  }
  
  .video-narration-btn:hover {
    background: rgba(80, 80, 80, 0.95);
  }
  
  .video-narration-btn svg {
    width: 12px;
    height: 12px;
    flex-shrink: 0;
  }
  
  .video-player-widget.zoomed {
    width: 440px;
  }
  
  .video-player-widget.zoomed-out {
    width: 150px;
  }
  
  /* Intent-based video widget styling */
  .video-player-widget.intent-awareness {
    border: 1px solid rgba(125, 166, 255, 0.3);
  }
  
  .video-player-widget.intent-interest {
    border: 1px solid rgba(125, 166, 255, 0.5);
    box-shadow: 0 8px 32px rgba(125, 166, 255, 0.2);
  }
  
  .video-player-widget.intent-consideration {
    border: 1px solid rgba(255, 193, 7, 0.5);
    box-shadow: 0 8px 32px rgba(255, 193, 7, 0.2);
  }
  
  .video-player-widget.intent-purchase {
    border: 2px solid rgba(0, 255, 136, 0.6);
    box-shadow: 0 8px 32px rgba(0, 255, 136, 0.3);
  }
  
  .video-player-widget.engagement-high {
    opacity: 1;
  }
  
  .video-player-widget.engagement-medium {
    opacity: 0.95;
  }
  
  .video-player-widget.engagement-low {
    opacity: 0.85;
  }
  
  @keyframes pulse {
    0%, 100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.05);
    }
  }
  
  @media (max-width: 1024px) {
    .video-player-widget {
      width: 180px;
    }
    
    .video-player-widget.zoomed {
      width: 360px;
    }
    
    .video-player-widget.zoomed-out {
      width: 120px;
    }
    
    .video-intro-text {
      font-size: 11px;
    }
    
    .video-product-text {
      font-size: 11px;
    }
    
    .video-product-name {
      font-size: 12px;
    }
    
    .video-product-discount-price {
      font-size: 14px;
    }
  }
  
  /* Intent Panel Initial Animation */
  .intent-panel {
    opacity: 0;
    animation: panel-fade-in-right 1.2s ease-out 0.7s forwards;
  }
  
  @keyframes panel-fade-in-right {
    from {
      opacity: 0;
      transform: translateX(20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
  
  
  /* Banner Cards Progressive Appearance */
  .product-banner-card {
    opacity: 0;
    transform: translateY(20px);
    animation: banner-card-appear 0.8s ease-out forwards;
  }
  
  .product-banner-card:nth-child(1) { animation-delay: 1.0s; }
  .product-banner-card:nth-child(2) { animation-delay: 1.2s; }
  
  @keyframes banner-card-appear {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* Hero Banner Initial Animation */
  .shop-banner {
    opacity: 0;
    transform: translateY(30px);
    animation: banner-hero-appear 1s ease-out 0.8s forwards;
  }
  
  @keyframes banner-hero-appear {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* Chart Styles */
  .chart-container {
    margin-top: 16px;
  }
  
  .chart-title {
    font-size: 13px;
    color: var(--text-secondary);
    margin-bottom: 12px;
    font-weight: 500;
  }
  
  /* Bar Chart */
  .bar-chart {
    display: flex;
    align-items: flex-end;
    gap: 8px;
    height: 120px;
    padding: 12px 0;
  }
  
  .bar-item {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
  }
  
  .bar {
    width: 100%;
    background: linear-gradient(180deg, var(--primary), #7da6ff);
    border-radius: 4px 4px 0 0;
    position: relative;
    transition: height 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    min-height: 4px;
    animation: bar-grow 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  @keyframes bar-grow {
    from {
      height: 0;
      opacity: 0.5;
    }
    to {
      opacity: 1;
    }
  }
  
  .bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 100%;
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.3), transparent);
    border-radius: 4px 4px 0 0;
  }
  
  .bar-label {
    font-size: 11px;
    color: var(--text-secondary);
    text-align: center;
    font-weight: 500;
  }
  
  .bar-value {
    font-size: 12px;
    color: var(--primary);
    font-weight: 600;
    margin-top: 4px;
  }
  
  /* Pie Chart */
  .pie-chart {
    position: relative;
    width: 160px;
    height: 160px;
    margin: 0 auto;
  }
  
  .pie-svg {
    width: 100%;
    height: 100%;
    transform: rotate(-90deg);
  }
  
  .pie-segment {
    transition: stroke-dasharray 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    animation: pie-draw 1s ease-out;
  }
  
  @keyframes pie-draw {
    from {
      stroke-dasharray: 0 502;
    }
  }
  
  .pie-center {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
  }
  
  .pie-center-value {
    font-size: 24px;
    font-weight: 700;
    color: var(--primary);
  }
  
  .pie-center-label {
    font-size: 12px;
    color: var(--text-secondary);
  }
  
  /* Dashboard */
  .gauge-container {
    position: relative;
    width: 200px;
    height: 100px;
    margin: 0 auto;
  }
  
  .gauge-svg {
    width: 100%;
    height: 100%;
  }
  
  .gauge-arc {
    fill: none;
    stroke-width: 12;
    stroke-linecap: round;
    transition: stroke-dasharray 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    animation: gauge-fill 1s ease-out;
  }
  
  @keyframes gauge-fill {
    from {
      stroke-dasharray: 0 314;
    }
  }
  
  .gauge-value {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 28px;
    font-weight: 700;
    color: var(--primary);
    text-align: center;
  }
  
  .gauge-label {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    font-size: 12px;
    color: var(--text-secondary);
  }
  
  /* Timeline Chart */
  .timeline-chart {
    position: relative;
    padding: 20px 0;
  }
  
  .timeline-line {
    position: absolute;
    left: 20px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: var(--border);
  }
  
  .timeline-item {
    position: relative;
    padding-left: 50px;
    margin-bottom: 16px;
    opacity: 0;
    animation: timeline-appear 0.5s ease-out forwards;
  }
  
  @keyframes timeline-appear {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
  
  .timeline-dot {
    position: absolute;
    left: 11px;
    top: 4px;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: var(--primary);
    border: 3px solid var(--bg-dark);
    box-shadow: 0 0 12px rgba(0, 255, 136, 0.5);
    animation: dot-pulse 2s ease-in-out infinite;
  }
  
  @keyframes dot-pulse {
    0%, 100% {
      box-shadow: 0 0 12px rgba(0, 255, 136, 0.5);
    }
    50% {
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.8);
    }
  }
  
  .timeline-content {
    font-size: 13px;
    color: var(--text-secondary);
  }
  
  .timeline-time {
    font-size: 11px;
    color: var(--primary);
    font-weight: 600;
    margin-bottom: 4px;
  }
  
  .timeline-text {
    color: var(--text-secondary);
  }
  
  /* Number Animation */
  .animated-number {
    display: inline-block;
    font-weight: 700;
    color: var(--primary);
    animation: number-pop 0.5s ease-out;
  }
  
  @keyframes number-pop {
    0% {
      transform: scale(0.5);
      opacity: 0;
    }
    50% {
      transform: scale(1.2);
    }
    100% {
      transform: scale(1);
      opacity: 1;
    }
  }
  
  /* Completion Effect */
  .completion-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    z-index: 10001;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s;
  }
  
  .completion-overlay.show {
    opacity: 1;
    pointer-events: all;
  }
  
  .completion-modal {
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.95) 0%, rgba(10, 10, 10, 0.95) 100%);
    border: 2px solid var(--primary);
    border-radius: 24px;
    padding: 60px 40px;
    text-align: center;
    max-width: 500px;
    position: relative;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0, 255, 136, 0.3);
    transform: scale(0.8);
    opacity: 0;
    animation: modal-appear 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }
  
  @keyframes modal-appear {
    0% {
      transform: scale(0.8) translateY(50px);
      opacity: 0;
    }
    50% {
      transform: scale(1.05) translateY(-10px);
    }
    100% {
      transform: scale(1) translateY(0);
      opacity: 1;
    }
  }
  
  .completion-modal::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(0, 255, 136, 0.1) 0%, transparent 70%);
    animation: rotate-glow 3s linear infinite;
  }
  
  @keyframes rotate-glow {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }
  
  .completion-icon {
    font-size: 80px;
    margin-bottom: 24px;
    animation: icon-bounce 1s ease-in-out infinite;
    position: relative;
    z-index: 1;
  }
  
  @keyframes icon-bounce {
    0%, 100% {
      transform: translateY(0) scale(1);
    }
    50% {
      transform: translateY(-10px) scale(1.1);
    }
  }
  
  .completion-title {
    font-size: 36px;
    font-weight: 800;
    margin-bottom: 16px;
    background: linear-gradient(135deg, var(--primary) 0%, #7da6ff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    position: relative;
    z-index: 1;
    letter-spacing: -1px;
  }
  
  .completion-message {
    font-size: 16px;
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: 32px;
    position: relative;
    z-index: 1;
  }
  
  .completion-stats {
    display: flex;
    justify-content: space-around;
    margin: 32px 0;
    padding: 24px;
    background: rgba(0, 255, 136, 0.05);
    border-radius: 16px;
    border: 1px solid rgba(0, 255, 136, 0.2);
    position: relative;
    z-index: 1;
  }
  
  .completion-stat {
    text-align: center;
  }
  
  .completion-stat-value {
    font-size: 32px;
    font-weight: 700;
    color: var(--primary);
    display: block;
    margin-bottom: 8px;
  }
  
  .completion-stat-label {
    font-size: 13px;
    color: var(--text-secondary);
  }
  
  .completion-button {
    background: var(--primary);
    color: var(--bg-dark);
    border: none;
    padding: 16px 40px;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    z-index: 1;
    font-family: 'Inter', sans-serif;
  }
  
  .completion-button:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 255, 136, 0.4);
  }
  
  /* Fireworks Effect */
  .firework {
    position: fixed;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    pointer-events: none;
    z-index: 9999;
    box-shadow: 0 0 8px currentColor;
  }
  
  .confetti {
    position: fixed;
    width: 10px;
    height: 10px;
    background: var(--primary);
    pointer-events: none;
    z-index: 9999;
    animation: confetti-fall 3s ease-out forwards;
  }
  
  @keyframes confetti-fall {
    0% {
      transform: translateY(-100vh) rotate(0deg);
      opacity: 1;
    }
    100% {
      transform: translateY(100vh) rotate(720deg);
      opacity: 0;
    }
  }
  
  .sparkle {
    position: absolute;
    width: 6px;
    height: 6px;
    background: var(--primary);
    border-radius: 50%;
    pointer-events: none;
    animation: sparkle-anim 1.5s ease-out infinite;
  }
  
  @keyframes sparkle-anim {
    0%, 100% {
      opacity: 0;
      transform: scale(0);
    }
    50% {
      opacity: 1;
      transform: scale(1);
    }
  }
  
  .intent-card h3 {
    font-size: 16px;
    font-weight: 600;
    color: var(--primary);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .intent-card h3::before {
    content: '●';
    font-size: 8px;
    color: var(--primary);
  }
  
  .intent-content {
    color: var(--text-secondary);
    font-size: 14px;
    line-height: 1.6;
  }
  
  .intent-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 12px;
  }
  
  .intent-tag {
    padding: 6px 12px;
    background: rgba(0, 255, 136, 0.1);
    border: 1px solid rgba(0, 255, 136, 0.2);
    border-radius: 6px;
    font-size: 12px;
    color: var(--primary);
    font-weight: 500;
  }
  
  .intent-json {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid var(--border);
    padding: 16px;
    border-radius: 8px;
    font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
    font-size: 12px;
    color: var(--primary);
    margin-top: 12px;
    white-space: pre-wrap;
    max-height: 200px;
    overflow-y: auto;
  }
  
  .empty-state {
    text-align: center;
    padding: 80px 20px;
    color: var(--text-secondary);
  }
  
  .empty-state-icon {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
  }
  
  .empty-state h3 {
    font-size: 18px;
    margin-bottom: 8px;
    color: var(--text-primary);
  }
  
  .empty-state p {
    font-size: 14px;
    line-height: 1.6;
  }
  
  @media (max-width: 1024px) {
    .content-wrapper {
      flex-direction: column;
    }
    
    .shop-panel,
    .intent-panel {
      width: 100%;
      height: 50vh;
    }
    
    .products-grid {
      grid-template-columns: 1fr;
    }
 }
</style>
</head>
<body>
<div class="page-loading" id="pageLoading">
  <div class="loading-logo">INTENT RECOGNITION</div>
  <div class="loading-text">Loading experience platform...</div>
  <div class="loading-progress">
    <div class="loading-progress-bar"></div>
  </div>
</div>
<nav class="navbar">
  <div class="navbar-brand">INTENT RECOGNITION</div>
  <div class="navbar-links">
    <a href="index.html" class="home-link">Home</a>
    <a href="user_intent_report.html">Intent Recognition Framework</a>
  </div>
</nav>
<div class="content-wrapper">
  <!-- Left: Simulated Independent Store -->
  <div class="shop-panel" id="shopPanel">
    <div class="shop-header">
      <div class="shop-nav">
        <div class="shop-logo">FASHION STORE</div>
        <ul class="shop-menu">
          <li>Home</li>
          <li>New Arrivals</li>
          <li>Clothing</li>
          <li>Accessories</li>
          <li>About</li>
        </ul>
        <div class="shop-actions">
          <div class="shop-search">
            <svg class="shop-search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <input type="text" placeholder="Search products...">
          </div>
          <svg class="shop-cart" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
          </svg>
        </div>
      </div>
</div>

    <div class="shop-banner" data-tracking="banner-view">
      <h2>Fall New Arrivals</h2>
      <p>Explore the perfect blend of comfort and fashion, create your unique style</p>
      <button class="shop-banner-btn" data-tracking="banner-click">Explore Now</button>
    </div>
    
    <!-- Product Banner Area -->
    <div class="product-banners">
      <div class="banner-grid">
        <div class="product-banner-card" data-tracking="banner-hover">
          <div class="banner-image">
            <img src="products/banner-comfort.jpg" alt="Comfort Collection" onerror="this.style.display='none';">
          </div>
          <div class="banner-content">
            <h3>Comfort Collection</h3>
            <p>Carefully selected premium fabrics for all-day comfort. From home to travel, make comfort part of your daily life.</p>
            <a href="#" class="banner-link">View Collection →</a>
          </div>
        </div>
        
        <div class="product-banner-card" data-tracking="banner-hover">
          <div class="banner-image">
            <img src="products/banner-style.jpg" alt="Style Collection" onerror="this.style.display='none';">
          </div>
          <div class="banner-content">
            <h3>Style Collection</h3>
            <p>Following the latest trends, blending classic and modern design to showcase your unique taste and personality.</p>
            <a href="#" class="banner-link">View Collection →</a>
          </div>
        </div>
      </div>
      
      <!-- Category Tags -->
      <div class="category-tags">
        <div class="category-tag active">All</div>
        <div class="category-tag">Tops</div>
        <div class="category-tag">Bottoms</div>
        <div class="category-tag">Outerwear</div>
        <div class="category-tag">Accessories</div>
      </div>
    </div>
    
    <div class="products-section">
      <h2 class="section-title">Popular Products</h2>
      <div class="products-grid">
        <div class="product-card" data-product="hoodie" data-tracking="product-hover">
          <div class="product-image">
            <img src="products/hoodie.jpg" alt="Comfortable Hoodie" onerror="this.onerror=null; this.style.display='none'; this.parentElement.classList.add('fallback'); this.parentElement.textContent='👕';">
          </div>
          <div class="product-info">
            <div class="product-title">Comfortable Hoodie</div>
            <div class="product-price">¥299</div>
            <div class="product-actions">
              <button class="btn-add-cart" data-product="hoodie" data-action="add-cart">Add to Cart</button>
              <button class="btn-view" data-product="hoodie" data-action="view">View</button>
            </div>
          </div>
        </div>
        
        <div class="product-card" data-product="sweater" data-tracking="product-hover">
          <div class="product-image">
            <img src="products/sweater.jpg" alt="Casual Sweater" onerror="this.onerror=null; this.style.display='none'; this.parentElement.classList.add('fallback'); this.parentElement.textContent='🧥';">
          </div>
          <div class="product-info">
            <div class="product-title">Casual Sweater</div>
            <div class="product-price">¥399</div>
            <div class="product-actions">
              <button class="btn-add-cart" data-product="sweater" data-action="add-cart">Add to Cart</button>
              <button class="btn-view" data-product="sweater" data-action="view">View</button>
            </div>
          </div>
        </div>
        
        <div class="product-card" data-product="pants" data-tracking="product-hover">
          <div class="product-image">
            <img src="products/pants.jpg" alt="Athletic Pants" onerror="this.onerror=null; this.style.display='none'; this.parentElement.classList.add('fallback'); this.parentElement.textContent='👖';">
          </div>
          <div class="product-info">
            <div class="product-title">Athletic Pants</div>
            <div class="product-price">¥199</div>
            <div class="product-actions">
              <button class="btn-add-cart" data-product="pants" data-action="add-cart">Add to Cart</button>
              <button class="btn-view" data-product="pants" data-action="view">View</button>
            </div>
          </div>
        </div>
        
        <div class="product-card" data-product="jacket" data-tracking="product-hover">
          <div class="product-image">
            <img src="products/jacket.jpg" alt="Casual Jacket" onerror="this.onerror=null; this.style.display='none'; this.parentElement.classList.add('fallback'); this.parentElement.textContent='🧥';">
          </div>
          <div class="product-info">
            <div class="product-title">Casual Jacket</div>
            <div class="product-price">¥499</div>
            <div class="product-actions">
              <button class="btn-add-cart" data-product="jacket" data-action="add-cart">Add to Cart</button>
              <button class="btn-view" data-product="jacket" data-action="view">View</button>
            </div>
          </div>
        </div>
      </div>
      
      <h2 class="section-title">Recommended Products</h2>
      <div class="products-grid">
        <div class="product-card" data-product="shirt" data-tracking="product-hover">
          <div class="product-image">
            <img src="products/shirt.jpg" alt="Basic T-Shirt" onerror="this.onerror=null; this.style.display='none'; this.parentElement.classList.add('fallback'); this.parentElement.textContent='👔';">
          </div>
          <div class="product-info">
            <div class="product-title">Basic T-Shirt</div>
            <div class="product-price">¥99</div>
            <div class="product-actions">
              <button class="btn-add-cart" data-product="shirt" data-action="add-cart">Add to Cart</button>
              <button class="btn-view" data-product="shirt" data-action="view">View</button>
            </div>
          </div>
        </div>
        
        <div class="product-card" data-product="shoes" data-tracking="product-hover">
          <div class="product-image">
            <img src="products/shoes.jpg" alt="Sneakers" onerror="this.onerror=null; this.style.display='none'; this.parentElement.classList.add('fallback'); this.parentElement.textContent='👟';">
          </div>
          <div class="product-info">
            <div class="product-title">Sneakers</div>
            <div class="product-price">¥599</div>
            <div class="product-actions">
              <button class="btn-add-cart" data-product="shoes" data-action="add-cart">Add to Cart</button>
              <button class="btn-view" data-product="shoes" data-action="view">View</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Right: Intent Recognition Output -->
  <div class="intent-panel" id="intentPanel">
    <div class="intent-header">
      <h2>Real-time Intent Recognition</h2>
      <div class="subtitle">System is analyzing your browsing behavior...</div>
      <div class="intent-status" id="statusIndicator">Waiting for user behavior</div>
    </div>

    <!-- One-sentence Intent -->
    <div id="intentSummary" style="margin-bottom: 24px; padding: 20px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 12px; display: none;">
      <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
        <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px;">
          💭
        </div>
        <h4 style="margin: 0; color: var(--text); font-size: 1rem; font-weight: 600;">One-sentence Intent</h4>
      </div>
      <div id="intentSummaryText" style="min-height: 60px; padding: 1rem; background: var(--bg-dark); border-radius: 8px; border-left: 4px solid #667eea; color: var(--text); line-height: 1.6; font-size: 0.95rem;">
        <div style="color: var(--text-secondary); font-style: italic;">Waiting for user behavior...</div>
      </div>
    </div>

    <div id="intentOutput">
      <div class="empty-state">
        <div class="empty-state-icon">👆</div>
        <h3>Start Browsing the Store</h3>
        <p>Scroll, hover, or click products in the left store<br/>The system will analyze and generate your shopping intent in real-time</p>
      </div>
    </div>
  </div>
</div>

<div class="guide-tooltip" id="guideTooltip"></div>
<div class="guide-overlay" id="guideOverlay"></div>
<div class="guide-steps" id="guideSteps" style="display: none;">
  <h4>Interactive Guide</h4>
  <p class="guide-journey-hint">Awareness → Interest → Consideration → Conversion</p>
  <div class="guide-step" id="step1">1. Browse Page</div>
  <div class="guide-step" id="step2">2. Enter Campaign</div>
  <div class="guide-step" id="step3">3. View Product</div>
  <div class="guide-step" id="step4">4. Watch Video</div>
  <div class="guide-step" id="step5">5. Add to Cart</div>
  <div class="guide-step" id="step6">6. Purchase in Widget</div>
</div>
<div class="guide-notification" id="guideNotification" style="display: none;">
  <button class="guide-notification-close" onclick="this.parentElement.style.display='none'">×</button>
  <h5>🎯 Start Experience</h5>
  <p>Follow the consumer journey: browse → interest → learn more → add to cart / purchase. The system will recognize your shopping intent in real time.</p>
</div>

<div class="completion-overlay" id="completionOverlay">
  <div class="completion-modal">
    <div class="completion-icon">🎉</div>
    <h2 class="completion-title">Experience Complete</h2>
    <p class="completion-message">You have completed all interactions along the consumer journey.<br/>The system has fully recognized your shopping intent and conversion path.</p>
    <div class="completion-stats" id="completionStats">
      <!-- Dynamically filled -->
    </div>
    <button class="completion-button" onclick="closeCompletion()">Continue Exploring</button>
  </div>
</div>

<script>
// Intent Recognition Engine
class IntentRecognition {
  constructor() {
    this.behaviors = [];
    this.intentData = {
      core_interests: [],
      product_focus: {},
      purchase_signals: { stage: 'browsing', concerns: null },
      behavior_summary: { engagement: 'low', browsing_path: [] },
      conversion_stage: 'awareness'
    };
    // Track state before video interaction for comparison analysis
    this.beforeVideoState = null;
    this.videoImpactMetrics = {
      conversionStageBoost: 0,
      engagementBoost: 0,
      interactionIncrease: 0,
      timeSpentIncrease: 0
    };
    // Track video-to-conversion metrics
    this.videoConversionMetrics = {
      firstVideoWatchTime: null,
      conversionActions: [], // Array of {action, timestamp, timeFromVideo}
      conversionRate: 0,
      averageConversionTime: 0
    };
    this.productMap = {
      'hoodie': { category: 'Comfortable Apparel', tags: ['Hoodie', 'Cozy', 'Loungewear', 'Athleisure'] },
      'sweater': { category: 'Casual Wear', tags: ['Sweater', 'Warm', 'Comfort'] },
      'pants': { category: 'Athleisure', tags: ['Pants', 'Active', 'Comfort'] },
      'jacket': { category: 'Outerwear', tags: ['Jacket', 'Style', 'Warm'] },
      'shirt': { category: 'Basics', tags: ['T-Shirt', 'Casual', 'Essential'] },
      'shoes': { category: 'Footwear', tags: ['Sneakers', 'Active', 'Comfort'] },
      'F1 Floating Pillow': { category: 'Home & Bedding', tags: ['Pillow', 'Comfort', 'Sleep', 'Premium', 'Floating'] }
    };
  }
  
  recordBehavior(type, data) {
    const behavior = {
      type,
      data,
      timestamp: Date.now()
    };
    
    // Detect first video interaction, save previous state
    const isVideoInteraction = type === 'video-play' || type === 'video-pause' || 
                               type === 'video-watch' || type === 'video-hover-end' ||
                               (type === 'click' && data.element && data.element.includes('video'));
    
    if (isVideoInteraction && !this.beforeVideoState) {
      this.beforeVideoState = {
        conversionStage: this.intentData.conversion_stage,
        engagement: this.intentData.behavior_summary.engagement,
        behaviorCount: this.behaviors.length,
        timestamp: Date.now()
      };
    }
    
    // Track first video watch time for conversion analysis
    if ((type === 'video-play' || type === 'video-watch') && !this.videoConversionMetrics.firstVideoWatchTime) {
      this.videoConversionMetrics.firstVideoWatchTime = Date.now();
    }
    
    // Track conversion actions after video watch
    const isConversionAction = type === 'click' && (
      data.action === 'add-cart' || 
      data.action === 'buy-now' ||
      data.action === 'view-product-details'
    );
    
    if (isConversionAction && this.videoConversionMetrics.firstVideoWatchTime) {
      const timeFromVideo = (Date.now() - this.videoConversionMetrics.firstVideoWatchTime) / 1000;
      this.videoConversionMetrics.conversionActions.push({
        action: data.action,
        timestamp: Date.now(),
        timeFromVideo: timeFromVideo,
        product: data.product || 'F1 Floating Pillow'
      });
    }
    
    this.behaviors.push(behavior);
    this.updateIntent();
    this.calculateVideoImpact();
    this.updateVideoWidgetByIntent(); // Update video widget based on user intent
    this.displayIntent();
  }
  
  updateVideoWidgetByIntent() {
    // Update video widget content based on user intent
    const videoWidget = document.getElementById('videoPlayerWidget');
    const videoProductCard = document.querySelector('.video-product-card');
    if (!videoWidget || !videoProductCard) return;
    
    const stage = this.intentData.conversion_stage || 'awareness';
    const engagement = this.intentData.behavior_summary.engagement || 'low';
    const coreInterests = this.intentData.core_interests || [];
    
    // Remove existing intent-based classes
    videoWidget.classList.remove('intent-awareness', 'intent-interest', 'intent-consideration', 'intent-purchase');
    videoWidget.classList.remove('engagement-low', 'engagement-medium', 'engagement-high');
    
    // Add stage-based class
    videoWidget.classList.add(`intent-${stage}`);
    
    // Add engagement-based class
    videoWidget.classList.add(`engagement-${engagement}`);
    
    // Update product card visibility/emphasis based on intent
    const productInfo = videoProductCard.querySelector('.video-product-info');
    const productActions = videoProductCard.querySelector('.video-product-actions');
    
    if (productInfo && productActions) {
      // Show/hide actions based on conversion stage
      if (stage === 'purchase' || stage === 'consideration') {
        productActions.style.display = 'flex';
        productActions.style.opacity = '0.85';
        productActions.style.transform = 'translateY(0)';
      } else if (stage === 'interest') {
        productActions.style.display = 'flex';
        productActions.style.opacity = '0.65';
      } else {
        productActions.style.display = 'flex';
        productActions.style.opacity = '0.5';
      }
      
      // Highlight price if user is price-sensitive (based on interests)
      const priceElement = productInfo.querySelector('.video-product-discount-price');
      if (priceElement) {
        if (coreInterests.some(i => i.toLowerCase().includes('price') || i.toLowerCase().includes('value'))) {
          priceElement.style.animation = 'pulse 2s infinite';
        } else {
          priceElement.style.animation = '';
        }
      }
    }
    
    // Add visual indicator for intent change
    if (this.behaviors.length > 0) {
      const lastBehavior = this.behaviors[this.behaviors.length - 1];
      if (lastBehavior.type === 'video-watch' || lastBehavior.type === 'video-play') {
        // Add a subtle glow effect when intent changes
        videoWidget.style.boxShadow = '0 8px 32px rgba(0, 255, 136, 0.3)';
        setTimeout(() => {
          videoWidget.style.boxShadow = '';
        }, 1000);
      }
    }
  }
  
  calculateVideoImpact() {
    if (!this.beforeVideoState) return;
    
    const stages = ['awareness', 'interest', 'consideration', 'purchase'];
    const beforeIndex = stages.indexOf(this.beforeVideoState.conversionStage);
    const currentIndex = stages.indexOf(this.intentData.conversion_stage);
    this.videoImpactMetrics.conversionStageBoost = Math.max(0, currentIndex - beforeIndex);
    
    const engagementLevels = { 'low': 0, 'medium': 1, 'high': 2 };
    const beforeEngagement = engagementLevels[this.beforeVideoState.engagement] || 0;
    const currentEngagement = engagementLevels[this.intentData.behavior_summary.engagement] || 0;
    this.videoImpactMetrics.engagementBoost = Math.max(0, currentEngagement - beforeEngagement);
    
    this.videoImpactMetrics.interactionIncrease = this.behaviors.length - this.beforeVideoState.behaviorCount;
    
    // Calculate video watch duration
    const videoWatchEvents = this.behaviors.filter(b => b.type === 'video-watch');
    if (videoWatchEvents.length > 0) {
      const maxWatchTime = Math.max(...videoWatchEvents.map(e => e.data.watchDuration || 0));
      this.videoImpactMetrics.timeSpentIncrease = maxWatchTime;
    }
  }
  
  updateIntent() {
    // Analyze behavior patterns
    const scrollEvents = this.behaviors.filter(b => b.type === 'scroll');
    const hoverEvents = this.behaviors.filter(b => b.type === 'hover');
    const clickEvents = this.behaviors.filter(b => b.type === 'click');
    const videoEvents = this.behaviors.filter(b => 
      b.type === 'video-play' || b.type === 'video-pause' || 
      b.type === 'video-watch' || b.type === 'video-hover-end'
    );
    const videoWatchEvents = this.behaviors.filter(b => b.type === 'video-watch');
    
    // Update core interests
    const interestSet = new Set();
    hoverEvents.forEach(event => {
      const product = this.productMap[event.data.product];
      if (product) {
        product.tags.forEach(tag => interestSet.add(tag));
      }
    });
    
    // Video watching behavior also reflects interest
    videoEvents.forEach(event => {
      const product = this.productMap[event.data.product];
      if (product) {
        product.tags.forEach(tag => interestSet.add(tag));
      }
    });
    
    this.intentData.core_interests = Array.from(interestSet);
    
    // Update product focus (prioritize products with video interaction)
    const videoProductEvents = this.behaviors.filter(b => 
      b.data && b.data.product === 'F1 Floating Pillow'
    );
    
    if (videoProductEvents.length > 0) {
      const product = this.productMap['F1 Floating Pillow'];
      if (product) {
        this.intentData.product_focus = {
          category: product.category,
          key_attributes: product.tags,
          price_range: 'premium',
          main_appeal: this.getMainAppeal(product.tags),
          source: 'video-interaction'
        };
      }
    } else if (hoverEvents.length > 0) {
      const lastHover = hoverEvents[hoverEvents.length - 1];
      const product = this.productMap[lastHover.data.product];
      if (product) {
        this.intentData.product_focus = {
          category: product.category,
          key_attributes: product.tags,
          price_range: this.estimatePriceRange(lastHover.data.product),
          main_appeal: this.getMainAppeal(product.tags)
        };
      }
    }
    
    // Update purchase signals and conversion stage
    const addCartEvents = this.behaviors.filter(b => b.type === 'click' && b.data.action === 'add-cart');
    const viewEvents = this.behaviors.filter(b => b.type === 'click' && b.data.action === 'view');
    const videoProductClick = this.behaviors.filter(b => 
      b.type === 'click' && b.data.product === 'F1 Floating Pillow'
    );
    
    // Conversion stage judgment: browsing → interest → consideration → purchase
    // Video watch over 10 seconds or clicking video product card indicates high interest
    const hasVideoEngagement = videoWatchEvents.some(e => e.data.watchDuration >= 10) || 
                               videoProductClick.length > 0;
    
    if (addCartEvents.length > 0) {
      this.intentData.purchase_signals.stage = 'purchasing';
      this.intentData.conversion_stage = 'purchase';
    } else if (viewEvents.length > 0 || videoProductClick.length > 0) {
      this.intentData.purchase_signals.stage = 'considering';
      this.intentData.conversion_stage = 'consideration';
    } else if (hasVideoEngagement || hoverEvents.length >= 3) {
      this.intentData.purchase_signals.stage = 'exploring';
      this.intentData.conversion_stage = 'interest';
    } else if (hoverEvents.length > 0 || scrollEvents.length > 2 || videoEvents.length > 0) {
      this.intentData.purchase_signals.stage = 'browsing';
      this.intentData.conversion_stage = 'awareness';
    } else {
      this.intentData.purchase_signals.stage = 'browsing';
      this.intentData.conversion_stage = 'awareness';
    }
    
    // Update behavior summary (video interaction increases engagement)
    const totalInteractions = scrollEvents.length + hoverEvents.length + clickEvents.length + videoEvents.length;
    this.intentData.behavior_summary.engagement = 
      totalInteractions > 8 || videoWatchEvents.some(e => e.data.watchDuration >= 15) ? 'high' : 
      totalInteractions > 4 || videoEvents.length > 0 ? 'medium' : 'low';
    this.intentData.behavior_summary.browsing_path = this.behaviors
      .filter(b => b.type === 'hover' || b.type === 'click' || b.type === 'video-play' || b.type === 'video-watch')
      .map(b => b.data.product || b.data.element);
  }
  
  estimatePriceRange(product) {
    const prices = { hoodie: 'mid-range', sweater: 'mid-range', pants: 'low-range', 
                     jacket: 'high-range', shirt: 'low-range', shoes: 'high-range' };
    return prices[product] || 'mid-range';
  }
  
  getMainAppeal(tags) {
    if (tags.includes('Cozy') || tags.includes('Comfort')) return 'Comfort & Style';
    if (tags.includes('Active') || tags.includes('Athleisure')) return 'Active Lifestyle';
    return 'Style & Quality';
  }
  
  generateIntentSummary() {
    const parts = [];
    
    // Conversion stage
    const stageLabels = {
      'awareness': 'Awareness Stage',
      'interest': 'Interest Stage',
      'consideration': 'Consideration Stage',
      'purchase': 'Purchase Stage'
    };
    const currentStage = stageLabels[this.intentData.conversion_stage] || 'Browsing Stage';
    parts.push(`in ${currentStage}`);
    
    // Engagement
    const engagement = this.intentData.behavior_summary.engagement;
    if (engagement === 'high') {
      parts.push('high engagement');
    } else if (engagement === 'medium') {
      parts.push('medium engagement');
    }
    
    // Product focus
    if (Object.keys(this.intentData.product_focus).length > 0) {
      const pf = this.intentData.product_focus;
      if (pf.category) {
        parts.push(`focusing on ${pf.category}`);
      }
    }
    
    // Core interests
    if (this.intentData.core_interests.length > 0) {
      const topInterests = this.intentData.core_interests.slice(0, 2);
      parts.push(`preferring ${topInterests.join(', ')}`);
    }
    
    // Purchase signals
    const addCartEvents = this.behaviors.filter(b => b.type === 'click' && b.data.action === 'add-cart');
    if (addCartEvents.length > 0) {
      parts.push('showing purchase intent');
    }
    
    // Video interaction
    const videoEvents = this.behaviors.filter(b => 
      b.type === 'video-play' || b.type === 'video-pause' || 
      b.type === 'video-watch' || b.type === 'video-hover-end'
    );
    if (videoEvents.length > 0) {
      parts.push('deep browsing video content');
    }
    
    // Combine into one sentence
    let intentText = '';
    if (parts.length > 0) {
      intentText = `User is currently ${parts.join(', ')}.`;
    } else {
      intentText = 'User is browsing the store, system is analyzing their shopping intent...';
    }
    
    return intentText;
  }
  
  displayIntent() {
    const output = document.getElementById('intentOutput');
    const statusIndicator = document.getElementById('statusIndicator');
    
    if (this.behaviors.length === 0) {
      output.innerHTML = `
        <div class="empty-state">
          <div class="empty-state-icon">👆</div>
          <h3>Start Browsing the Store</h3>
          <p>Scroll, hover, or click products in the left store<br/>The system will analyze and generate your shopping intent in real-time</p>
        </div>
      `;
      statusIndicator.textContent = 'Waiting for user behavior';
      return;
    }
    
    statusIndicator.innerHTML = `Recorded <span class="animated-number">${this.behaviors.length}</span> behavior events`;
    
    // Update one-sentence intent
    const intentSummaryEl = document.getElementById('intentSummary');
    const intentSummaryTextEl = document.getElementById('intentSummaryText');
    if (intentSummaryEl && intentSummaryTextEl) {
      intentSummaryEl.style.display = 'block';
      const summaryText = this.generateIntentSummary();
      intentSummaryTextEl.innerHTML = `<div style="color: var(--text); line-height: 1.6;">${summaryText}</div>`;
    }
    
    let html = '';
    
    // Conversion funnel visualization
    html += this.renderConversionFunnel();
    
    // Behavior statistics chart
    html += this.renderBehaviorChart();
    
    // Video interaction display (if there are video interactions)
    const videoInteractions = this.behaviors.filter(b => 
      b.type === 'video-play' || b.type === 'video-pause' || 
      b.type === 'video-watch' || b.type === 'video-hover-end' ||
      (b.type === 'click' && b.data.element && b.data.element.includes('video'))
    );
    if (videoInteractions.length > 0) {
      html += this.renderVideoInteractions();
    }
    
    // Impact of video interaction on conversion metrics (if there are video interactions and comparison data)
    if (videoInteractions.length > 0 && this.beforeVideoState) {
      html += this.renderVideoImpactOnConversion();
    }
    
    // Video-to-conversion analysis (if user watched video and then converted)
    if (this.videoConversionMetrics.firstVideoWatchTime && this.videoConversionMetrics.conversionActions.length > 0) {
      html += this.renderVideoToConversion();
    }
    
    // Engagement dashboard
    html += this.renderEngagementGauge();
    
    // Core interests (with chart)
    if (this.intentData.core_interests.length > 0) {
      html += this.renderInterestChart();
      html += `
        <div class="intent-card show">
          <h3>Core Interest Tags</h3>
          <div class="intent-tags">
            ${this.intentData.core_interests.map(tag => `<span class="intent-tag">${tag}</span>`).join('')}
          </div>
        </div>
      `;
    }
    
    // Behavior timeline
    if (this.behaviors.length > 0) {
      html += this.renderTimeline();
    }
    
    // Product focus
    if (Object.keys(this.intentData.product_focus).length > 0) {
      const pf = this.intentData.product_focus;
      html += `
        <div class="intent-card show">
          <h3>Product Focus</h3>
          <div class="intent-content">
            <strong>Category:</strong> ${pf.category || 'N/A'}<br/>
            <strong>Price Range:</strong> ${pf.price_range || 'N/A'}<br/>
            <strong>Main Appeal:</strong> ${pf.main_appeal || 'N/A'}
          </div>
          ${pf.key_attributes ? `
            <div class="intent-tags">
              ${pf.key_attributes.map(attr => `<span class="intent-tag">${attr}</span>`).join('')}
            </div>
          ` : ''}
        </div>
      `;
    }
    
    // Purchase signals
    html += `
      <div class="intent-card show">
        <h3>Purchase Signal Analysis</h3>
        <div class="intent-content">
          <strong>Current Stage:</strong> ${this.getStageText(this.intentData.purchase_signals.stage)}<br/>
          <strong>Engagement:</strong> ${this.intentData.behavior_summary.engagement === 'high' ? 'High' : 
                                      this.intentData.behavior_summary.engagement === 'medium' ? 'Medium' : 'Low'}
        </div>
      </div>
    `;
    
    // Behavior summary
    if (this.intentData.behavior_summary.browsing_path.length > 0) {
      html += `
        <div class="intent-card show">
          <h3>Browsing Path</h3>
          <div class="intent-content">
            ${this.intentData.behavior_summary.browsing_path.join(' → ')}
          </div>
        </div>
      `;
    }
    
    // Complete JSON data
    html += `
      <div class="intent-card show">
        <h3>Complete Intent Data (JSON)</h3>
        <div class="intent-json">${JSON.stringify(this.intentData, null, 2)}</div>
      </div>
    `;
    
    output.innerHTML = html;
    
    // Scroll to bottom
    document.getElementById('intentPanel').scrollTo({
      top: document.getElementById('intentPanel').scrollHeight,
      behavior: 'smooth'
    });
  }
  
  getStageText(stage) {
    const stages = {
      'browsing': 'Browsing Stage',
      'exploring': 'Exploring Stage',
      'considering': 'Consideration Stage',
      'purchasing': 'Purchase Stage',
      'deciding': 'Decision Stage'
    };
    return stages[stage] || stage;
  }
  
  renderConversionFunnel() {
    const stages = ['awareness', 'interest', 'consideration', 'purchase'];
    const stageLabels = {
      'awareness': 'Awareness',
      'interest': 'Interest',
      'consideration': 'Consideration',
      'purchase': 'Purchase'
    };
    
    const currentStage = this.intentData.conversion_stage || 'awareness';
    const currentIndex = stages.indexOf(currentStage);
    const progress = ((currentIndex + 1) / stages.length) * 100;
    
    let html = `
      <div class="conversion-funnel">
        <h3>🔄 Conversion Funnel</h3>
        <div class="funnel-steps">
    `;
    
    stages.forEach((stage, index) => {
      const isActive = stage === currentStage;
      const isCompleted = index < currentIndex;
      const classes = isActive ? 'active' : isCompleted ? 'completed' : '';
      
      html += `
        <div class="funnel-step ${classes}">
          <div class="funnel-step-circle">${index + 1}</div>
          <div class="funnel-step-label">${stageLabels[stage]}</div>
        </div>
      `;
    });
    
    html += `
        </div>
        <div class="funnel-progress">
          <div class="funnel-progress-bar" style="width: ${progress}%"></div>
        </div>
      </div>
    `;
    
    return html;
  }
  
  renderBehaviorChart() {
    const scrollCount = this.behaviors.filter(b => b.type === 'scroll').length;
    const hoverCount = this.behaviors.filter(b => b.type === 'hover').length;
    const clickCount = this.behaviors.filter(b => b.type === 'click').length;
    const viewCount = this.behaviors.filter(b => b.type === 'view').length;
    const videoCount = this.behaviors.filter(b => 
      b.type === 'video-play' || b.type === 'video-pause' || 
      b.type === 'video-watch' || b.type === 'video-hover-end'
    ).length;
    
    const maxCount = Math.max(scrollCount, hoverCount, clickCount, viewCount, videoCount, 1);
    
    const scrollHeight = (scrollCount / maxCount) * 100;
    const hoverHeight = (hoverCount / maxCount) * 100;
    const clickHeight = (clickCount / maxCount) * 100;
    const viewHeight = (viewCount / maxCount) * 100;
    const videoHeight = (videoCount / maxCount) * 100;
    
    return `
      <div class="intent-card show">
        <h3>📊 Behavior Statistics</h3>
        <div class="chart-container">
          <div class="bar-chart">
            <div class="bar-item">
              <div class="bar" style="height: ${scrollHeight}%"></div>
              <div class="bar-label">Scroll</div>
              <div class="bar-value"><span class="animated-number">${scrollCount}</span></div>
            </div>
            <div class="bar-item">
              <div class="bar" style="height: ${hoverHeight}%"></div>
              <div class="bar-label">Hover</div>
              <div class="bar-value"><span class="animated-number">${hoverCount}</span></div>
            </div>
            <div class="bar-item">
              <div class="bar" style="height: ${clickHeight}%"></div>
              <div class="bar-label">Click</div>
              <div class="bar-value"><span class="animated-number">${clickCount}</span></div>
            </div>
            <div class="bar-item">
              <div class="bar" style="height: ${viewHeight}%"></div>
              <div class="bar-label">View</div>
              <div class="bar-value"><span class="animated-number">${viewCount}</span></div>
            </div>
            <div class="bar-item">
              <div class="bar" style="height: ${videoHeight}%"></div>
              <div class="bar-label">Video</div>
              <div class="bar-value"><span class="animated-number">${videoCount}</span></div>
            </div>
          </div>
        </div>
      </div>
    `;
  }
  
  renderEngagementGauge() {
    const engagement = this.intentData.behavior_summary.engagement;
    let engagementValue = 0;
    let engagementLabel = 'Low';
    
    if (engagement === 'high') {
      engagementValue = 85;
      engagementLabel = 'High';
    } else if (engagement === 'medium') {
      engagementValue = 50;
      engagementLabel = 'Medium';
    } else {
      engagementValue = 20;
      engagementLabel = 'Low';
    }
    
    // Calculate arc stroke-dasharray
    const circumference = Math.PI * 100; // Semi-circle with radius 100
    const offset = circumference - (engagementValue / 100) * circumference;
    
    return `
      <div class="intent-card show">
        <h3>⚡ Engagement Analysis</h3>
        <div class="chart-container">
          <div class="gauge-container">
            <svg class="gauge-svg" viewBox="0 0 200 100">
              <path d="M 20 100 A 80 80 0 0 1 180 100" 
                    fill="none" 
                    stroke="var(--border)" 
                    stroke-width="12"/>
              <path class="gauge-arc" 
                    d="M 20 100 A 80 80 0 0 1 180 100" 
                    fill="none" 
                    stroke="url(#gaugeGradient)" 
                    stroke-width="12"
                    stroke-dasharray="${circumference}"
                    stroke-dashoffset="${offset}"/>
              <defs>
                <linearGradient id="gaugeGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                  <stop offset="0%" style="stop-color:var(--primary);stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#7da6ff;stop-opacity:1" />
                </linearGradient>
              </defs>
            </svg>
            <div class="gauge-value"><span class="animated-number">${engagementValue}</span>%</div>
            <div class="gauge-label">Engagement: ${engagementLabel}</div>
          </div>
        </div>
      </div>
    `;
  }
  
  renderInterestChart() {
    const interests = this.intentData.core_interests;
    if (interests.length === 0) return '';
    
    // Assign a value to each interest (simulated weight)
    const interestData = interests.map((interest, index) => ({
      label: interest,
      value: 100 - (index * 15) // Decreasing value
    }));
    
    const total = interestData.reduce((sum, item) => sum + item.value, 0);
    let currentAngle = 0;
    
    let segments = '';
    const colors = ['#00ff88', '#7da6ff', '#00cc6f', '#6b95ff', '#00aa5a'];
    
    interestData.forEach((item, index) => {
      const percentage = (item.value / total) * 100;
      const angle = (percentage / 100) * 360;
      const largeArc = angle > 180 ? 1 : 0;
      
      const x1 = 80 + 80 * Math.cos((currentAngle * Math.PI) / 180);
      const y1 = 80 + 80 * Math.sin((currentAngle * Math.PI) / 180);
      const x2 = 80 + 80 * Math.cos(((currentAngle + angle) * Math.PI) / 180);
      const y2 = 80 + 80 * Math.sin(((currentAngle + angle) * Math.PI) / 180);
      
      segments += `
        <path class="pie-segment"
              d="M 80 80 L ${x1} ${y1} A 80 80 0 ${largeArc} 1 ${x2} ${y2} Z"
              fill="${colors[index % colors.length]}"
              opacity="0.8"/>
      `;
      
      currentAngle += angle;
    });
    
    return `
      <div class="intent-card show">
        <h3>🎯 Interest Distribution</h3>
        <div class="chart-container">
          <div class="pie-chart">
            <svg class="pie-svg" viewBox="0 0 160 160">
              ${segments}
            </svg>
            <div class="pie-center">
              <div class="pie-center-value"><span class="animated-number">${interests.length}</span></div>
              <div class="pie-center-label">Interest Tags</div>
            </div>
          </div>
          <div style="margin-top: 16px; display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;">
            ${interestData.map((item, index) => `
              <div style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                <div style="width: 12px; height: 12px; border-radius: 2px; background: ${colors[index % colors.length]}"></div>
                <span style="color: var(--text-secondary);">${item.label}</span>
              </div>
            `).join('')}
          </div>
        </div>
      </div>
    `;
  }
  
  renderVideoInteractions() {
    const videoPlayEvents = this.behaviors.filter(b => b.type === 'video-play');
    const videoPauseEvents = this.behaviors.filter(b => b.type === 'video-pause');
    const videoWatchEvents = this.behaviors.filter(b => b.type === 'video-watch');
    const videoHoverEvents = this.behaviors.filter(b => b.type === 'video-hover-end');
    const videoControlEvents = this.behaviors.filter(b => 
      b.type === 'click' && b.data.element === 'video-control'
    );
    const videoClickEvents = this.behaviors.filter(b => 
      b.type === 'click' && b.data.element === 'product-video'
    );
    const productCardClicks = this.behaviors.filter(b => 
      b.type === 'click' && b.data.element === 'video-product-card'
    );
    
    // Total watch time
    let totalWatchDuration = 0;
    videoWatchEvents.forEach(e => {
      if (e.data.watchDuration) {
        totalWatchDuration = Math.max(totalWatchDuration, e.data.watchDuration);
      }
    });
    videoPauseEvents.forEach(e => {
      if (e.data.watchDuration) {
        totalWatchDuration = Math.max(totalWatchDuration, e.data.watchDuration);
      }
    });
    
    const formatDuration = (seconds) => {
      if (seconds < 60) return `${seconds}s`;
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return secs > 0 ? `${mins}m ${secs}s` : `${mins} min`;
    };
    
    // Get last 5 video interaction events
    const recentVideoBehaviors = this.behaviors
      .filter(b => 
        b.type === 'video-play' || b.type === 'video-pause' || 
        b.type === 'video-watch' || b.type === 'video-hover-end' ||
        (b.type === 'click' && (b.data.element === 'video-control' || 
                                b.data.element === 'product-video' || 
                                b.data.element === 'video-product-card'))
      )
      .slice(-8)
      .reverse();
    
    const actionLabels = {
      'video-play': 'Play Video',
      'video-pause': 'Pause Video',
      'video-watch': 'Watch Video',
      'video-hover-end': 'Hover Video',
      'click': (data) => {
        if (data.element === 'video-control') {
          const actionMap = {
            'zoom-in': 'Zoom in',
            'zoom-out': 'Zoom out',
            'zoom-reset': 'Reset size',
            'mute': 'Mute',
            'unmute': 'Unmute',
            'fullscreen': 'Fullscreen'
          };
          return actionMap[data.action] || 'Video control';
        } else if (data.element === 'product-video') {
          return 'Click video';
        } else if (data.element === 'video-product-card') {
          return 'View product details';
        }
        return 'Click action';
      }
    };
    
    return `
      <div class="intent-card show">
        <h3>🎬 Video Interaction Analysis</h3>
        <div class="chart-container">
          <!-- Video interaction stats -->
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 16px;">
            <div style="background: rgba(125, 166, 255, 0.1); border-radius: 8px; padding: 12px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #7da6ff; margin-bottom: 4px;">
                <span class="animated-number">${videoPlayEvents.length}</span>
              </div>
              <div style="font-size: 12px; color: var(--text-secondary);">Play count</div>
            </div>
            <div style="background: rgba(0, 255, 136, 0.1); border-radius: 8px; padding: 12px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #00ff88; margin-bottom: 4px;">
                ${formatDuration(totalWatchDuration)}
              </div>
              <div style="font-size: 12px; color: var(--text-secondary);">Watch time</div>
            </div>
            <div style="background: rgba(255, 68, 68, 0.1); border-radius: 8px; padding: 12px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #ff4444; margin-bottom: 4px;">
                <span class="animated-number">${videoControlEvents.length}</span>
              </div>
              <div style="font-size: 12px; color: var(--text-secondary);">Controls</div>
            </div>
            <div style="background: rgba(255, 193, 7, 0.1); border-radius: 8px; padding: 12px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #ffc107; margin-bottom: 4px;">
                <span class="animated-number">${productCardClicks.length}</span>
              </div>
              <div style="font-size: 12px; color: var(--text-secondary);">View details</div>
            </div>
          </div>
          
          <!-- Video interaction timeline -->
          ${recentVideoBehaviors.length > 0 ? `
            <div style="margin-top: 16px;">
              <div style="font-size: 13px; font-weight: 600; color: var(--text-primary); margin-bottom: 12px;">
                Recent interactions
              </div>
              <div class="timeline-chart" style="max-height: 200px; overflow-y: auto;">
                <div class="timeline-line"></div>
                ${recentVideoBehaviors.map((behavior, index) => {
                  const time = new Date(behavior.timestamp);
                  const timeStr = time.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                  let label = actionLabels[behavior.type];
                  if (typeof label === 'function') {
                    label = label(behavior.data);
                  } else if (!label) {
                    label = behavior.type;
                  }
                  
                  // Show watch duration for watch events
                  let extraInfo = '';
                  if (behavior.type === 'video-watch' && behavior.data.watchDuration) {
                    extraInfo = ` (${formatDuration(behavior.data.watchDuration)})`;
                  } else if (behavior.type === 'video-hover-end' && behavior.data.hoverDuration) {
                    extraInfo = ` (${behavior.data.hoverDuration}s)`;
                  }
                  
                  return `
                    <div class="timeline-item" style="animation-delay: ${index * 0.1}s">
                      <div class="timeline-dot" style="background: #7da6ff;"></div>
                      <div class="timeline-content">
                        <div class="timeline-time">${timeStr}</div>
                        <div class="timeline-text">${label}${extraInfo}</div>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>
          ` : ''}
          
          <!-- Product info -->
          <div style="margin-top: 16px; padding: 12px; background: rgba(125, 166, 255, 0.05); border-radius: 8px; border-left: 3px solid #7da6ff;">
            <div style="font-size: 13px; font-weight: 600; color: var(--text-primary); margin-bottom: 6px;">
              F1 Floating Pillow
            </div>
            <div style="font-size: 12px; color: var(--text-secondary);">
              Price: <span style="color: #ff4444; font-weight: 600;">USD 139.0</span>
              <span style="text-decoration: line-through; color: #999; margin-left: 8px;">USD 169.0</span>
            </div>
          </div>
        </div>
      </div>
    `;
  }
  
  renderVideoImpactOnConversion() {
    if (!this.beforeVideoState) return '';
    
    const stages = ['awareness', 'interest', 'consideration', 'purchase'];
    const stageLabels = {
      'awareness': 'Awareness',
      'interest': 'Interest',
      'consideration': 'Consideration',
      'purchase': 'Purchase'
    };
    
    const engagementLabels = {
      'low': 'Low',
      'medium': 'Medium',
      'high': 'High'
    };
    
    const beforeStageIndex = stages.indexOf(this.beforeVideoState.conversionStage);
    const currentStageIndex = stages.indexOf(this.intentData.conversion_stage);
    const stageBoost = this.videoImpactMetrics.conversionStageBoost;
    
    const engagementLevels = { 'low': 0, 'medium': 1, 'high': 2 };
    const beforeEngagementLevel = engagementLevels[this.beforeVideoState.engagement] || 0;
    const currentEngagementLevel = engagementLevels[this.intentData.behavior_summary.engagement] || 0;
    const engagementBoost = this.videoImpactMetrics.engagementBoost;
    
    // Conversion rate lift %
    const conversionRateBefore = ((beforeStageIndex + 1) / stages.length) * 100;
    const conversionRateAfter = ((currentStageIndex + 1) / stages.length) * 100;
    const conversionRateIncrease = conversionRateAfter - conversionRateBefore;
    
    // Engagement lift %
    const engagementBefore = (beforeEngagementLevel / 2) * 100;
    const engagementAfter = (currentEngagementLevel / 2) * 100;
    const engagementIncrease = engagementAfter - engagementBefore;
    
    const formatDuration = (seconds) => {
      if (seconds < 60) return `${seconds}s`;
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return secs > 0 ? `${mins}m ${secs}s` : `${mins} min`;
    };
    
    return `
      <div class="intent-card show" style="border: 2px solid #7da6ff; background: linear-gradient(135deg, rgba(125, 166, 255, 0.05) 0%, rgba(0, 255, 136, 0.05) 100%);">
        <h3 style="color: #7da6ff; display: flex; align-items: center; gap: 8px;">
          <span>📈</span>
          <span>Video interaction impact on conversion</span>
        </h3>
        <div class="chart-container">
          <!-- Conversion stage comparison -->
          <div style="margin-bottom: 20px;">
            <div style="font-size: 13px; font-weight: 600; color: var(--text-primary); margin-bottom: 12px;">
              Conversion stage lift
            </div>
            <div style="display: flex; align-items: center; gap: 12px; padding: 16px; background: rgba(125, 166, 255, 0.1); border-radius: 8px;">
              <div style="flex: 1; text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">Before</div>
                <div style="font-size: 18px; font-weight: 700; color: var(--text-secondary);">
                  ${stageLabels[this.beforeVideoState.conversionStage]}
                </div>
                <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">
                  ${Math.round(conversionRateBefore)}%
                </div>
              </div>
              <div style="font-size: 24px; color: #7da6ff;">→</div>
              <div style="flex: 1; text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">After</div>
                <div style="font-size: 18px; font-weight: 700; color: #7da6ff;">
                  ${stageLabels[this.intentData.conversion_stage]}
                </div>
                <div style="font-size: 11px; color: #7da6ff; margin-top: 4px;">
                  ${Math.round(conversionRateAfter)}%
                </div>
              </div>
              ${stageBoost > 0 ? `
                <div style="flex: 1; text-align: center; padding-left: 12px; border-left: 1px solid rgba(125, 166, 255, 0.3);">
                  <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">Lift</div>
                  <div style="font-size: 20px; font-weight: 700; color: #00ff88;">
                    +${stageBoost} stage
                  </div>
                  <div style="font-size: 11px; color: #00ff88; margin-top: 4px;">
                    +${Math.round(conversionRateIncrease)}%
                  </div>
                </div>
              ` : ''}
            </div>
          </div>
          
          <!-- Engagement comparison -->
          <div style="margin-bottom: 20px;">
            <div style="font-size: 13px; font-weight: 600; color: var(--text-primary); margin-bottom: 12px;">
              Engagement lift
            </div>
            <div style="display: flex; align-items: center; gap: 12px; padding: 16px; background: rgba(0, 255, 136, 0.1); border-radius: 8px;">
              <div style="flex: 1; text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">Before</div>
                <div style="font-size: 18px; font-weight: 700; color: var(--text-secondary);">
                  ${engagementLabels[this.beforeVideoState.engagement]}
                </div>
                <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">
                  ${Math.round(engagementBefore)}%
                </div>
              </div>
              <div style="font-size: 24px; color: #00ff88;">→</div>
              <div style="flex: 1; text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">After</div>
                <div style="font-size: 18px; font-weight: 700; color: #00ff88;">
                  ${engagementLabels[this.intentData.behavior_summary.engagement]}
                </div>
                <div style="font-size: 11px; color: #00ff88; margin-top: 4px;">
                  ${Math.round(engagementAfter)}%
                </div>
              </div>
              ${engagementBoost > 0 ? `
                <div style="flex: 1; text-align: center; padding-left: 12px; border-left: 1px solid rgba(0, 255, 136, 0.3);">
                  <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">Lift</div>
                  <div style="font-size: 20px; font-weight: 700; color: #00ff88;">
                    +${engagementBoost} level
                  </div>
                  <div style="font-size: 11px; color: #00ff88; margin-top: 4px;">
                    +${Math.round(engagementIncrease)}%
                  </div>
                </div>
              ` : ''}
            </div>
          </div>
          
          <!-- Key metrics -->
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 16px;">
            <div style="background: rgba(255, 68, 68, 0.1); border-radius: 8px; padding: 12px; text-align: center; border: 1px solid rgba(255, 68, 68, 0.2);">
              <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">New interactions</div>
              <div style="font-size: 20px; font-weight: 700; color: #ff4444;">
                +<span class="animated-number">${this.videoImpactMetrics.interactionIncrease}</span>
              </div>
              <div style="font-size: 10px; color: var(--text-secondary); margin-top: 4px;">
                behavior events
              </div>
            </div>
            <div style="background: rgba(255, 193, 7, 0.1); border-radius: 8px; padding: 12px; text-align: center; border: 1px solid rgba(255, 193, 7, 0.2);">
              <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">Watch time</div>
              <div style="font-size: 20px; font-weight: 700; color: #ffc107;">
                ${formatDuration(this.videoImpactMetrics.timeSpentIncrease)}
              </div>
              <div style="font-size: 10px; color: var(--text-secondary); margin-top: 4px;">
                Video dwell time
              </div>
            </div>
          </div>
          
          <!-- Conversion funnel -->
          <div style="margin-top: 16px;">
            <div style="font-size: 13px; font-weight: 600; color: var(--text-primary); margin-bottom: 12px;">
              Conversion progress
            </div>
            <div style="position: relative; height: 40px; background: rgba(0, 0, 0, 0.1); border-radius: 20px; overflow: hidden;">
              <div style="position: absolute; top: 0; left: 0; height: 100%; width: ${conversionRateBefore}%; background: rgba(125, 166, 255, 0.3); border-radius: 20px 0 0 20px; transition: width 0.5s ease;"></div>
              <div style="position: absolute; top: 0; left: 0; height: 100%; width: ${conversionRateAfter}%; background: linear-gradient(90deg, rgba(125, 166, 255, 0.6) 0%, rgba(0, 255, 136, 0.6) 100%); border-radius: 20px; transition: width 0.5s ease; box-shadow: 0 0 10px rgba(0, 255, 136, 0.3);"></div>
              <div style="position: absolute; top: 50%; left: ${conversionRateBefore}%; transform: translate(-50%, -50%); width: 4px; height: 60%; background: rgba(125, 166, 255, 0.8); border-radius: 2px; z-index: 2;"></div>
              <div style="position: absolute; top: 50%; left: ${conversionRateAfter}%; transform: translate(-50%, -50%); width: 4px; height: 60%; background: rgba(0, 255, 136, 0.8); border-radius: 2px; z-index: 2;"></div>
              <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 11px; font-weight: 600; color: white; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3); z-index: 3;">
                ${Math.round(conversionRateAfter)}%
              </div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 11px; color: var(--text-secondary);">
              <span>Before: ${Math.round(conversionRateBefore)}%</span>
              <span style="color: #00ff88; font-weight: 600;">+${Math.round(conversionRateIncrease)}%</span>
              <span>After: ${Math.round(conversionRateAfter)}%</span>
            </div>
          </div>
          
          <!-- Impact summary -->
          <div style="margin-top: 16px; padding: 12px; background: linear-gradient(135deg, rgba(125, 166, 255, 0.1) 0%, rgba(0, 255, 136, 0.1) 100%); border-radius: 8px; border-left: 3px solid #7da6ff;">
            <div style="font-size: 12px; font-weight: 600; color: var(--text-primary); margin-bottom: 6px;">
              💡 Video interaction impact summary
            </div>
            <div style="font-size: 11px; color: var(--text-secondary); line-height: 1.6;">
              ${stageBoost > 0 ? `• Conversion stage: "${stageLabels[this.beforeVideoState.conversionStage]}" → "${stageLabels[this.intentData.conversion_stage]}"<br/>` : ''}
              ${engagementBoost > 0 ? `• Engagement: "${engagementLabels[this.beforeVideoState.engagement]}" → "${engagementLabels[this.intentData.behavior_summary.engagement]}"<br/>` : ''}
              • Added ${this.videoImpactMetrics.interactionIncrease} interaction behaviors<br/>
              ${this.videoImpactMetrics.timeSpentIncrease > 0 ? `• Video watch duration: ${formatDuration(this.videoImpactMetrics.timeSpentIncrease)}<br/>` : ''}
              • Conversion rate increased by ${Math.round(conversionRateIncrease)} percentage points
            </div>
          </div>
        </div>
      </div>
    `;
  }
  
  renderVideoToConversion() {
    const metrics = this.videoConversionMetrics;
    if (!metrics.firstVideoWatchTime || metrics.conversionActions.length === 0) return '';
    
    const formatTime = (seconds) => {
      if (seconds < 60) return `${Math.round(seconds)}s`;
      const mins = Math.floor(seconds / 60);
      const secs = Math.round(seconds % 60);
      return secs > 0 ? `${mins}m ${secs}s` : `${mins} min`;
    };
    
    const formatTimestamp = (timestamp) => {
      const date = new Date(timestamp);
      return date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
    };
    
    const actionLabels = {
      'add-cart': 'Add to Cart',
      'buy-now': 'Buy Now',
      'view-product-details': 'View Details'
    };
    
    // Calculate conversion rate (conversion actions / video watches)
    const videoWatchCount = this.behaviors.filter(b => 
      b.type === 'video-play' || b.type === 'video-watch'
    ).length;
    const conversionRate = videoWatchCount > 0 
      ? (metrics.conversionActions.length / videoWatchCount * 100).toFixed(1)
      : 0;
    
    // Calculate average conversion time
    const conversionTimes = metrics.conversionActions
      .map(a => a.timeFromVideo)
      .filter(t => t > 0);
    const avgConversionTime = conversionTimes.length > 0
      ? conversionTimes.reduce((a, b) => a + b, 0) / conversionTimes.length
      : 0;
    
    return `
      <div class="intent-card show" style="border: 2px solid #00ff88; background: linear-gradient(135deg, rgba(0, 255, 136, 0.05) 0%, rgba(125, 166, 255, 0.05) 100%);">
        <h3 style="color: #00ff88; display: flex; align-items: center; gap: 8px;">
          <span>🎯</span>
          <span>Video-to-Conversion Analysis</span>
        </h3>
        <div class="chart-container">
          <!-- Conversion metrics overview -->
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px;">
            <div style="background: rgba(0, 255, 136, 0.1); border-radius: 8px; padding: 12px; text-align: center; border: 1px solid rgba(0, 255, 136, 0.2);">
              <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">Conversion Rate</div>
              <div style="font-size: 20px; font-weight: 700; color: #00ff88;">
                ${conversionRate}%
              </div>
              <div style="font-size: 10px; color: var(--text-secondary); margin-top: 4px;">
                ${metrics.conversionActions.length}/${videoWatchCount} views
              </div>
            </div>
            <div style="background: rgba(125, 166, 255, 0.1); border-radius: 8px; padding: 12px; text-align: center; border: 1px solid rgba(125, 166, 255, 0.2);">
              <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">Conversions</div>
              <div style="font-size: 20px; font-weight: 700; color: #7da6ff;">
                <span class="animated-number">${metrics.conversionActions.length}</span>
              </div>
              <div style="font-size: 10px; color: var(--text-secondary); margin-top: 4px;">
                conversion actions
              </div>
            </div>
            <div style="background: rgba(255, 193, 7, 0.1); border-radius: 8px; padding: 12px; text-align: center; border: 1px solid rgba(255, 193, 7, 0.2);">
              <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">Avg Conversion Time</div>
              <div style="font-size: 20px; font-weight: 700; color: #ffc107;">
                ${formatTime(avgConversionTime)}
              </div>
              <div style="font-size: 10px; color: var(--text-secondary); margin-top: 4px;">
                from video to conversion
              </div>
            </div>
          </div>
          
          <!-- Conversion timeline -->
          <div style="margin-top: 16px;">
            <div style="font-size: 13px; font-weight: 600; color: var(--text-primary); margin-bottom: 12px;">
              Conversion Timeline
            </div>
            <div class="timeline-chart" style="max-height: 250px; overflow-y: auto;">
              <div class="timeline-line"></div>
              <!-- First video watch marker -->
              <div class="timeline-item" style="animation-delay: 0s">
                <div class="timeline-dot" style="background: #7da6ff; border: 2px solid #00ff88;"></div>
                <div class="timeline-content">
                  <div class="timeline-time">${formatTimestamp(metrics.firstVideoWatchTime)}</div>
                  <div class="timeline-text" style="color: #7da6ff; font-weight: 600;">🎬 First Video Watch</div>
                </div>
              </div>
              ${metrics.conversionActions.map((action, index) => {
                const timeFromVideo = action.timeFromVideo;
                return `
                  <div class="timeline-item" style="animation-delay: ${(index + 1) * 0.1}s">
                    <div class="timeline-dot" style="background: #00ff88;"></div>
                    <div class="timeline-content">
                      <div class="timeline-time">${formatTimestamp(action.timestamp)}</div>
                      <div class="timeline-text">
                        <span style="color: #00ff88; font-weight: 600;">✓ ${actionLabels[action.action] || action.action}</span>
                        <span style="color: var(--text-secondary); margin-left: 8px; font-size: 11px;">
                          (${formatTime(timeFromVideo)} after watch)
                        </span>
                      </div>
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
          
          <!-- Conversion path analysis -->
          <div style="margin-top: 16px; padding: 12px; background: linear-gradient(135deg, rgba(0, 255, 136, 0.1) 0%, rgba(125, 166, 255, 0.1) 100%); border-radius: 8px; border-left: 3px solid #00ff88;">
            <div style="font-size: 12px; font-weight: 600; color: var(--text-primary); margin-bottom: 6px;">
              💡 Conversion Path Analysis
            </div>
            <div style="font-size: 11px; color: var(--text-secondary); line-height: 1.6;">
              • User first watched video at ${formatTimestamp(metrics.firstVideoWatchTime)}<br/>
              • Generated ${metrics.conversionActions.length} conversion actions after watching<br/>
              • Average conversion time: ${formatTime(avgConversionTime)}<br/>
              • Conversion Rate: ${conversionRate}% (${metrics.conversionActions.length}/${videoWatchCount} views)<br/>
              ${metrics.conversionActions.some(a => a.action === 'buy-now') 
                ? '• ✅ Contains buy now action, strong conversion intent' 
                : metrics.conversionActions.some(a => a.action === 'add-cart')
                ? '• 🛒 Contains add to cart action, in consideration stage'
                : '• 👀 Contains view details action, exploring product'}
            </div>
          </div>
        </div>
      </div>
    `;
  }
  
  renderTimeline() {
    const recentBehaviors = this.behaviors.slice(-5).reverse();
    if (recentBehaviors.length === 0) return '';
    
    const behaviorLabels = {
      'scroll': 'Scroll Page',
      'hover': 'Hover Product',
      'click': 'Click Action',
      'view': 'View Content'
    };
    
    return `
      <div class="intent-card show">
        <h3>⏱️ Behavior Timeline</h3>
        <div class="chart-container">
          <div class="timeline-chart">
            <div class="timeline-line"></div>
            ${recentBehaviors.map((behavior, index) => {
              const time = new Date(behavior.timestamp);
              const timeStr = time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
              const label = behaviorLabels[behavior.type] || behavior.type;
              
              return `
                <div class="timeline-item" style="animation-delay: ${index * 0.1}s">
                  <div class="timeline-dot"></div>
                  <div class="timeline-content">
                    <div class="timeline-time">${timeStr}</div>
                    <div class="timeline-text">${label}</div>
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        </div>
      </div>
    `;
  }
}

// Init
const intentEngine = new IntentRecognition();
let scrollTimeout;
let lastScrollTop = 0;

// Scroll listener
const shopPanel = document.getElementById('shopPanel');
shopPanel.addEventListener('scroll', () => {
  clearTimeout(scrollTimeout);
  scrollTimeout = setTimeout(() => {
    const scrollTop = shopPanel.scrollTop;
    if (Math.abs(scrollTop - lastScrollTop) > 100) {
      intentEngine.recordBehavior('scroll', {
        position: scrollTop,
        direction: scrollTop > lastScrollTop ? 'down' : 'up'
      });
      lastScrollTop = scrollTop;
    }
  }, 300);
});

// Product hover listener
document.querySelectorAll('[data-tracking="product-hover"]').forEach(card => {
  card.addEventListener('mouseenter', () => {
    const product = card.getAttribute('data-product');
    intentEngine.recordBehavior('hover', { product, element: 'product-card' });
    
    // Show guide hint
    showTooltip(card, 'Analyzing your interests...');
  });
  
  card.addEventListener('click', () => {
    const product = card.getAttribute('data-product');
    intentEngine.recordBehavior('click', { product, element: 'product-card' });
    
    showTooltip(card, 'Click behavior recorded');
  });
});

// Banner view listener
const banner = document.querySelector('[data-tracking="banner-view"]');
let bannerViewed = false;
shopPanel.addEventListener('scroll', () => {
  const bannerRect = banner.getBoundingClientRect();
  if (bannerRect.top < window.innerHeight && bannerRect.bottom > 0 && !bannerViewed) {
    intentEngine.recordBehavior('view', { element: 'hero-banner', content: 'Fall New Arrivals' });
    bannerViewed = true;
  }
}, { passive: true });

// Banner button click listener
const bannerBtn = document.querySelector('[data-tracking="banner-click"]');
if (bannerBtn) {
  bannerBtn.addEventListener('click', () => {
    intentEngine.recordBehavior('click', { element: 'banner-button', action: 'explore' });
  });
}

// Product banner hover listener
document.querySelectorAll('[data-tracking="banner-hover"]').forEach(bannerCard => {
  bannerCard.addEventListener('mouseenter', () => {
    const title = bannerCard.querySelector('h3')?.textContent || 'Product Collection';
    intentEngine.recordBehavior('hover', { element: 'product-banner', content: title });
    showTooltip(bannerCard, 'Analyzing your interests...');
  });
  
  bannerCard.addEventListener('click', () => {
    const title = bannerCard.querySelector('h3')?.textContent || 'Product Collection';
    intentEngine.recordBehavior('click', { element: 'product-banner', content: title });
    showTooltip(bannerCard, 'Click behavior recorded');
  });
});

// Category tag click listener
document.querySelectorAll('.category-tag').forEach(tag => {
  tag.addEventListener('click', () => {
    // Toggle active state
    document.querySelectorAll('.category-tag').forEach(t => t.classList.remove('active'));
    tag.classList.add('active');
    
    const category = tag.textContent.trim();
    intentEngine.recordBehavior('click', { element: 'category-filter', category });
  });
});

// Add-to-cart button listener
document.querySelectorAll('.btn-add-cart').forEach(btn => {
  btn.addEventListener('click', (e) => {
    e.stopPropagation();
    const product = btn.getAttribute('data-product');
    intentEngine.recordBehavior('click', { product, action: 'add-cart', element: 'add-to-cart-button' });
    
    // Visual feedback
      btn.textContent = '✓ Added';
    btn.style.background = '#7da6ff';
    setTimeout(() => {
      btn.textContent = 'Add to Cart';
      btn.style.background = '';
    }, 2000);
    
    showTooltip(btn, 'Added to cart! Conversion stage advanced');
  });
});

// View button click listener
document.querySelectorAll('.btn-view').forEach(btn => {
  btn.addEventListener('click', (e) => {
    e.stopPropagation();
    const product = btn.getAttribute('data-product');
    intentEngine.recordBehavior('click', { product, action: 'view', element: 'view-button' });
    
    showTooltip(btn, 'View product details');
  });
});

// Show guide hint
function showTooltip(element, text) {
  const tooltip = document.getElementById('guideTooltip');
  const rect = element.getBoundingClientRect();
  tooltip.textContent = text;
  tooltip.style.left = rect.left + rect.width / 2 + 'px';
  tooltip.style.top = rect.top - 50 + 'px';
  tooltip.classList.add('show');
  
  setTimeout(() => {
    tooltip.classList.remove('show');
  }, 2000);
}

// Initial display
intentEngine.displayIntent();

// Page load animation
window.addEventListener('load', () => {
  setTimeout(() => {
    const loading = document.getElementById('pageLoading');
    if (loading) {
      loading.classList.add('hide');
      setTimeout(() => {
        loading.style.display = 'none';
      }, 1000);
    }
    
    // Show video player after page load
    setTimeout(() => {
      const videoWidget = document.getElementById('videoPlayerWidget');
      if (videoWidget) {
        videoWidget.classList.add('loaded');
        // Initial attention animation
        setTimeout(() => {
          videoWidget.style.transform = 'translateY(0) scale(1.05)';
          setTimeout(() => {
            videoWidget.style.transform = 'translateY(0) scale(1)';
          }, 500);
        }, 300);
      }
    }, 2000);
  }, 2000);
  
  // Ensure product cards visible after animation
  const productCards = document.querySelectorAll('.product-card');
  productCards.forEach((card, index) => {
    const delay = 1200 + (index * 200);
    const animationDuration = 800;
    
    // Listen for animation end
    const handleAnimationEnd = () => {
      card.style.opacity = '1';
      card.style.visibility = 'visible';
      card.style.transform = 'translateY(0) scale(1)';
      card.classList.add('animation-complete');
    };
    
    card.addEventListener('animationend', handleAnimationEnd, { once: true });
    card.addEventListener('webkitAnimationEnd', handleAnimationEnd, { once: true });
    
    // Fallback: force show after delay if animation event not fired
    setTimeout(() => {
      if (!card.classList.contains('animation-complete')) {
        card.style.opacity = '1';
        card.style.visibility = 'visible';
        card.style.transform = 'translateY(0) scale(1)';
        card.classList.add('animation-complete');
      }
    }, delay + animationDuration + 200);
  });
});

// Guide system
class GuideSystem {
  constructor() {
    this.currentStep = 0;
    // Consumer journey: Awareness → Interest → Consideration → Conversion
    this.steps = [
      { 
        id: 'step1', 
        element: null, 
        hint: 'Scroll down the page to get an overview of the store (Awareness)',
        action: 'scroll',
        completed: false 
      },
      { 
        id: 'step2', 
        element: '.shop-banner-btn', 
        hint: 'Click "Explore Now" to enter the campaign (Interest)',
        action: 'click',
        completed: false 
      },
      { 
        id: 'step3', 
        element: '[data-tracking="product-hover"]', 
        hint: 'Hover over any product card to view details (Interest)',
        action: 'hover',
        completed: false 
      },
      { 
        id: 'step4', 
        element: '#videoPlayerWidget', 
        hint: 'Watch the video widget on the right for personalized content (Consideration)',
        action: 'video-watch',
        completed: false 
      },
      { 
        id: 'step5', 
        element: '.btn-add-cart', 
        hint: 'Click Add to Cart on a product card (Conversion)',
        action: 'click',
        completed: false 
      },
      { 
        id: 'step6', 
        element: '#videoAddCartBtn, #videoBuyNowBtn', 
        hint: 'Click Buy now or Add to Cart in the video widget (Conversion)',
        action: 'click',
        completed: false 
      }
    ];
    this.guideActive = false;
    this.startDelay = 6000;
  }
  
  init() {
    setTimeout(() => {
      this.startGuide();
    }, this.startDelay);
  }
  
  startGuide() {
    this.guideActive = true;
    
    // Show initial notification after delay
    const notification = document.getElementById('guideNotification');
    if (notification) {
      setTimeout(() => {
        notification.style.display = 'block';
        setTimeout(() => {
          notification.style.opacity = '0';
          setTimeout(() => {
            notification.style.display = 'none';
          }, 500);
        }, 6000);
      }, 1000);
    }
    
    // Show step indicator (delayed)
    const stepsEl = document.getElementById('guideSteps');
    if (stepsEl) {
      setTimeout(() => {
        stepsEl.style.display = 'block';
        stepsEl.style.animation = 'slide-in-right 0.8s ease-out';
      }, 2000);
    }
    
    // Delay first step
    setTimeout(() => {
      this.showStep(0);
    }, 3000);
  }
  
  showStep(stepIndex) {
    if (stepIndex >= this.steps.length) {
      this.completeGuide();
      return;
    }
    
    this.currentStep = stepIndex;
    const step = this.steps[stepIndex];
    
    // Update step indicator
    this.steps.forEach((s, i) => {
      const stepEl = document.getElementById(s.id);
      if (stepEl) {
        stepEl.classList.remove('active', 'completed');
        if (i < stepIndex) {
          stepEl.classList.add('completed');
        } else if (i === stepIndex) {
          stepEl.classList.add('active');
        }
      }
    });
    
    // No highlight for scroll step
    if (step.action === 'scroll') {
      this.showScrollHint();
      return;
    }
    
    // Find target element
    let targetElement = null;
    let highlightElement = null;
    
    if (step.element === '.btn-add-cart') {
      // Add-cart: pick second product button (avoid overlap with hover step)
      const buttons = document.querySelectorAll(step.element);
      if (buttons.length > 0) {
        const targetIndex = buttons.length > 1 ? 1 : 0;
        targetElement = buttons[targetIndex];
        highlightElement = targetElement.closest('.product-card');
        
        // If second button not in viewport, try third
        if (targetElement) {
          const rect = targetElement.getBoundingClientRect();
          if (rect.top >= window.innerHeight || rect.bottom <= 0) {
            // Try third if second not in viewport
            if (buttons.length > 2) {
              targetElement = buttons[2];
              highlightElement = targetElement.closest('.product-card');
            }
          }
        }
      }
    } else if (step.element === '[data-tracking="product-hover"]') {
      // Hover step: first product card
      const cards = document.querySelectorAll(step.element);
      if (cards.length > 0) {
        targetElement = cards[0];
        highlightElement = cards[0];
      }
    } else if (step.element === '.category-tag') {
      // Category: first inactive tag
      const tags = document.querySelectorAll(step.element);
      for (let tag of tags) {
        if (!tag.classList.contains('active')) {
          targetElement = tag;
          highlightElement = tag;
          break;
        }
      }
      if (!targetElement && tags.length > 0) {
        targetElement = tags[0];
        highlightElement = tags[0];
      }
    } else if (step.element === '#videoPlayerWidget') {
      // Video watch step: highlight whole widget
      const videoWidget = document.getElementById('videoPlayerWidget');
      if (videoWidget) {
        targetElement = videoWidget;
        highlightElement = videoWidget;
        // Add highlight style
        videoWidget.classList.add('highlight');
      }
    } else if (step.element === '#videoAddCartBtn, #videoBuyNowBtn') {
      // Video widget buttons: prefer add-cart, else buy-now
      const addCartBtn = document.getElementById('videoAddCartBtn');
      const buyNowBtn = document.getElementById('videoBuyNowBtn');
      if (addCartBtn) {
        targetElement = addCartBtn;
        highlightElement = document.getElementById('videoPlayerWidget');
      } else if (buyNowBtn) {
        targetElement = buyNowBtn;
        highlightElement = document.getElementById('videoPlayerWidget');
      }
    } else {
      // Default logic
      const elements = document.querySelectorAll(step.element);
      if (elements.length > 0) {
        targetElement = elements[0];
        highlightElement = elements[0];
      }
    }
    
    if (!targetElement) {
      this.completeStep();
      return;
    }
    
    // Highlight element and show arrow
    this.highlightElement(targetElement, highlightElement || targetElement, step.hint);
    
    // Listen for completion
    this.setupStepListener(step, targetElement);
  }
  
  highlightElement(targetElement, highlightElement, hint) {
    // Current step info
    const step = this.steps[this.currentStep];
    const isVideoWidget = step && (
      step.element === '#videoAddCartBtn, #videoBuyNowBtn' || 
      step.element === '#videoPlayerWidget'
    );
    
    // Remove previous highlight
    document.querySelectorAll('.guide-highlight').forEach(el => {
      el.classList.remove('guide-highlight');
    });
    document.querySelectorAll('.guide-arrow').forEach(el => el.remove());
    document.querySelectorAll('.guide-hint').forEach(el => el.remove());
    
    // Add highlight to container if any
    if (highlightElement && highlightElement !== targetElement) {
      highlightElement.classList.add('guide-highlight');
    } else {
      targetElement.classList.add('guide-highlight');
    }
    
    // Position arrow after scroll
    
    setTimeout(() => {
      // Get target position
      const rect = targetElement.getBoundingClientRect();
      
      // Video widget: viewport coords; others: page coords
      let centerX, centerY;
      if (isVideoWidget) {
        // Fixed: use viewport coords
        centerX = rect.left + rect.width / 2;
        centerY = rect.top;
      } else {
        // Normal element: account for scroll
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;
        centerX = rect.left + scrollLeft + rect.width / 2;
        centerY = rect.top + scrollTop;
      }
      
      // Add arrow above element
      const arrow = document.createElement('div');
      arrow.className = 'guide-arrow';
      arrow.style.position = isVideoWidget ? 'fixed' : 'absolute';
      arrow.style.left = centerX - 16 + 'px';
      arrow.style.top = (centerY - 50) + 'px';
      arrow.style.transform = 'translateX(-50%)';
      arrow.innerHTML = `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 5v14M5 12l7-7 7 7"/>
        </svg>
      `;
      document.body.appendChild(arrow);
      
      // Add hint text
      const hintEl = document.createElement('div');
      hintEl.className = 'guide-hint';
      hintEl.textContent = hint;
      hintEl.style.position = isVideoWidget ? 'fixed' : 'absolute';
      hintEl.style.left = centerX + 'px';
      hintEl.style.top = (centerY - 80) + 'px';
      hintEl.style.transform = 'translateX(-50%)';
      document.body.appendChild(hintEl);
      
      // Update arrow on scroll (skip for video widget)
      if (!isVideoWidget) {
        const updatePosition = () => {
          const newRect = targetElement.getBoundingClientRect();
          const newScrollTop = window.pageYOffset || document.documentElement.scrollTop;
          const newScrollLeft = window.pageXOffset || document.documentElement.scrollLeft;
          const newCenterX = newRect.left + newScrollLeft + newRect.width / 2;
          const newCenterY = newRect.top + newScrollTop;
          
          arrow.style.left = newCenterX - 16 + 'px';
          arrow.style.top = (newCenterY - 50) + 'px';
          hintEl.style.left = newCenterX + 'px';
          hintEl.style.top = (newCenterY - 80) + 'px';
        };
        
        // Only when guide active
        if (this.guideActive) {
          window.addEventListener('scroll', updatePosition, { passive: true });
          // Store cleanup
          arrow._cleanup = () => {
            window.removeEventListener('scroll', updatePosition);
          };
        }
      }
    }, 500);
    
    // Scroll to element (video widget is fixed)
    if (!isVideoWidget) {
      targetElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }
  
  showScrollHint() {
    const hintEl = document.createElement('div');
    hintEl.className = 'guide-hint';
    hintEl.textContent = this.steps[this.currentStep].hint;
    hintEl.style.left = '50%';
    hintEl.style.top = '200px';
    hintEl.style.transform = 'translateX(-50%)';
    document.body.appendChild(hintEl);
    
    // Extend hint display time
    setTimeout(() => {
      hintEl.style.opacity = '0';
      hintEl.style.transform = 'translateX(-50%) translateY(-10px)';
      setTimeout(() => {
        hintEl.remove();
      }, 500);
    }, 8000);
  }
  
  setupStepListener(step, element) {
    const handler = (e) => {
      if (step.action === 'click' && e.type === 'click') {
        // For add-cart: check if first button
        if (step.element === '.btn-add-cart') {
          // Check if first add-cart button
          const firstCartBtn = document.querySelector('.btn-add-cart');
          if (e.target === firstCartBtn || e.target.closest('.btn-add-cart') === firstCartBtn) {
            this.completeStep();
          }
        } else if (step.element === '#videoAddCartBtn, #videoBuyNowBtn') {
          // Video widget: check cart or buy click
          const videoAddCartBtn = document.getElementById('videoAddCartBtn');
          const videoBuyNowBtn = document.getElementById('videoBuyNowBtn');
          if (e.target === videoAddCartBtn || e.target === videoBuyNowBtn || 
              e.target.closest('#videoAddCartBtn') === videoAddCartBtn ||
              e.target.closest('#videoBuyNowBtn') === videoBuyNowBtn) {
            this.completeStep();
          }
        } else {
          this.completeStep();
        }
      } else if (step.action === 'hover' && e.type === 'mouseenter') {
        this.completeStep();
      } else if (step.action === 'video-watch') {
        // Video watch step: detect play/watch
        this.completeStep();
      }
    };
    
    if (step.action === 'click') {
      // Add-cart: listen all buttons
      if (step.element === '.btn-add-cart') {
        document.querySelectorAll('.btn-add-cart').forEach(btn => {
          btn.addEventListener('click', handler, { once: true });
        });
      } else if (step.element === '#videoAddCartBtn, #videoBuyNowBtn') {
        // Video widget: listen both buttons
        const videoAddCartBtn = document.getElementById('videoAddCartBtn');
        const videoBuyNowBtn = document.getElementById('videoBuyNowBtn');
        if (videoAddCartBtn) {
          videoAddCartBtn.addEventListener('click', handler, { once: true });
        }
        if (videoBuyNowBtn) {
          videoBuyNowBtn.addEventListener('click', handler, { once: true });
        }
      } else {
        element.addEventListener('click', handler, { once: true });
      }
    } else if (step.action === 'hover') {
      element.addEventListener('mouseenter', handler, { once: true });
    } else if (step.action === 'video-watch') {
      // Listen video play
      const videoPlayer = document.getElementById('productVideo');
      if (videoPlayer) {
        // Listen play
        const playHandler = () => {
          handler({ type: 'play' });
          videoPlayer.removeEventListener('play', playHandler);
        };
        videoPlayer.addEventListener('play', playHandler, { once: true });
        
        // If already playing, complete step
        if (!videoPlayer.paused) {
          setTimeout(() => {
            handler({ type: 'play' });
          }, 500);
        }
      }
      
      // Also listen via intentEngine
      const originalRecordBehavior = intentEngine.recordBehavior.bind(intentEngine);
      intentEngine.recordBehavior = function(type, data) {
        if (type === 'video-play' || type === 'video-watch') {
          handler({ type: 'video-watch' });
          intentEngine.recordBehavior = originalRecordBehavior;
        }
        return originalRecordBehavior(type, data);
      };
    }
    
    // Scroll listener
    if (step.action === 'scroll') {
      let scrollCount = 0;
      const scrollHandler = () => {
        scrollCount++;
        if (scrollCount >= 2) {
          shopPanel.removeEventListener('scroll', scrollHandler);
          this.completeStep();
        }
      };
      shopPanel.addEventListener('scroll', scrollHandler);
    }
  }
  
  completeStep() {
    this.steps[this.currentStep].completed = true;
    const stepEl = document.getElementById(this.steps[this.currentStep].id);
    if (stepEl) {
      stepEl.classList.remove('active');
      stepEl.classList.add('completed');
    }
    
    // Clear highlight (including video widget)
    document.querySelectorAll('.guide-highlight').forEach(el => {
      el.classList.remove('guide-highlight');
    });
    const videoWidget = document.getElementById('videoPlayerWidget');
    if (videoWidget) {
      videoWidget.classList.remove('highlight');
    }
    document.querySelectorAll('.guide-arrow').forEach(el => {
      // Cleanup scroll listener
      if (el._cleanup) el._cleanup();
      el.remove();
    });
    document.querySelectorAll('.guide-hint').forEach(el => el.remove());
    
    // Delay next step
    setTimeout(() => {
      this.showStep(this.currentStep + 1);
    }, 2000);
  }
  
  completeGuide() {
    this.guideActive = false;
    document.getElementById('guideSteps').style.display = 'none';
    document.querySelectorAll('.guide-highlight').forEach(el => {
      el.classList.remove('guide-highlight');
    });
    document.querySelectorAll('.guide-arrow').forEach(el => {
      // Cleanup scroll listener
      if (el._cleanup) el._cleanup();
      el.remove();
    });
    document.querySelectorAll('.guide-hint').forEach(el => el.remove());
    
    // Don't trigger completion effect here
  }
}

// Init guide system
const guideSystem = new GuideSystem();
guideSystem.init();

// Scroll listener for step 1
let scrollStepCompleted = false;
shopPanel.addEventListener('scroll', () => {
  if (!scrollStepCompleted && guideSystem.guideActive && guideSystem.currentStep === 0) {
    scrollStepCompleted = true;
    setTimeout(() => {
      if (guideSystem.currentStep === 0) {
        guideSystem.completeStep();
      }
    }, 2000);
  }
});

// Completion check and effects
let completionShown = false;

function checkAndShowCompletion() {
  if (completionShown) return;
  
  // Check if all key behaviors done
  const behaviors = intentEngine.behaviors;
  const hasScroll = behaviors.some(b => b.type === 'scroll');
  const hasHover = behaviors.some(b => b.type === 'hover');
  const hasClick = behaviors.some(b => b.type === 'click');
  const hasAddCart = behaviors.some(b => b.type === 'click' && b.data.action === 'add-cart');
  const hasView = behaviors.some(b => b.type === 'view');
  const hasBannerClick = behaviors.some(b => b.type === 'click' && b.data.element === 'banner-button');
  const hasCategoryClick = behaviors.some(b => b.type === 'click' && b.data.element === 'category-filter');
  
  // Required: 12+ events, scroll, 2+ hover, 2+ click, add-cart, banner or category click
  
  const hoverCount = behaviors.filter(b => b.type === 'hover').length;
  const clickCount = behaviors.filter(b => b.type === 'click').length;
  
  const allRequirementsMet = 
    behaviors.length >= 12 &&
    hasScroll &&
    hoverCount >= 2 &&
    clickCount >= 2 &&
    hasAddCart &&
    (hasBannerClick || hasCategoryClick || hasView);
  
  if (allRequirementsMet) {
    showCompletion();
    completionShown = true;
  }
}

function showCompletion() {
  const overlay = document.getElementById('completionOverlay');
  const statsContainer = document.getElementById('completionStats');
  
  // Compute stats
  const behaviors = intentEngine.behaviors;
  const scrollCount = behaviors.filter(b => b.type === 'scroll').length;
  const hoverCount = behaviors.filter(b => b.type === 'hover').length;
  const clickCount = behaviors.filter(b => b.type === 'click').length;
  const addCartCount = behaviors.filter(b => b.type === 'click' && b.data.action === 'add-cart').length;
  const conversionStage = intentEngine.intentData.conversion_stage || 'awareness';
  
  // Fill stats
  statsContainer.innerHTML = `
    <div class="completion-stat">
      <span class="completion-stat-value">${behaviors.length}</span>
      <span class="completion-stat-label">Behavior Events</span>
    </div>
    <div class="completion-stat">
      <span class="completion-stat-value">${intentEngine.intentData.core_interests.length}</span>
      <span class="completion-stat-label">Interest Tags</span>
    </div>
    <div class="completion-stat">
      <span class="completion-stat-value">${addCartCount}</span>
      <span class="completion-stat-label">Add to Cart</span>
    </div>
  `;
  
  // Show overlay
  overlay.classList.add('show');
  
  // Fireworks and confetti
  createFireworks();
  createConfetti();
  
  // Sparkles
  addSparkles();
}

function createFireworks() {
  const colors = ['#00ff88', '#7da6ff', '#00cc6f', '#6b95ff'];
  const centerX = window.innerWidth / 2;
  const centerY = window.innerHeight / 2;
  
  for (let i = 0; i < 8; i++) {
    setTimeout(() => {
      const angle = (Math.PI * 2 * i) / 8;
      const distance = 150 + Math.random() * 100;
      
      for (let j = 0; j < 12; j++) {
        const particleAngle = (Math.PI * 2 * j) / 12;
        const particleDistance = 50 + Math.random() * 50;
        const x = Math.cos(particleAngle) * particleDistance;
        const y = Math.sin(particleAngle) * particleDistance;
        
        const firework = document.createElement('div');
        firework.className = 'firework';
        const color = colors[Math.floor(Math.random() * colors.length)];
        firework.style.background = color;
        firework.style.color = color;
        firework.style.left = centerX + 'px';
        firework.style.top = centerY + 'px';
        
        // Transform animation
        const startX = 0;
        const startY = 0;
        firework.style.transform = `translate(${startX}px, ${startY}px) scale(1)`;
        firework.style.opacity = '1';
        
        // Trigger animation
        requestAnimationFrame(() => {
          firework.style.transition = 'all 0.8s ease-out';
          firework.style.transform = `translate(${x}px, ${y}px) scale(0)`;
          firework.style.opacity = '0';
        });
        
        document.body.appendChild(firework);
        
        setTimeout(() => firework.remove(), 800);
      }
    }, i * 100);
  }
}

function createConfetti() {
  const colors = ['#00ff88', '#7da6ff', '#00cc6f', '#6b95ff', '#ffffff'];
  
  for (let i = 0; i < 50; i++) {
    setTimeout(() => {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.left = Math.random() * 100 + '%';
      confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
      confetti.style.animationDelay = Math.random() * 0.5 + 's';
      confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
      document.body.appendChild(confetti);
      
      setTimeout(() => confetti.remove(), 3000);
    }, i * 30);
  }
}

function addSparkles() {
  const modal = document.querySelector('.completion-modal');
  const sparklePositions = [
    { top: '20%', left: '15%' },
    { top: '30%', right: '20%' },
    { top: '60%', left: '10%' },
    { top: '70%', right: '15%' },
    { top: '50%', left: '50%' }
  ];
  
  sparklePositions.forEach((pos, index) => {
    setTimeout(() => {
      const sparkle = document.createElement('div');
      sparkle.className = 'sparkle';
      Object.assign(sparkle.style, pos);
      sparkle.style.animationDelay = index * 0.2 + 's';
      modal.appendChild(sparkle);
      
      setTimeout(() => sparkle.remove(), 2000);
    }, index * 200);
  });
}

function closeCompletion() {
  const overlay = document.getElementById('completionOverlay');
  overlay.classList.remove('show');
  
  setTimeout(() => {
    overlay.style.display = 'none';
  }, 500);
}

// Listen behavior changes for completion
let lastBehaviorCount = 0;
setInterval(() => {
  if (intentEngine.behaviors.length !== lastBehaviorCount) {
    lastBehaviorCount = intentEngine.behaviors.length;
    // Only check after threshold (avoid early trigger)
    if (!completionShown && intentEngine.behaviors.length >= 10) {
      checkAndShowCompletion();
    }
  }
}, 1000);

// Video player controls
const videoPlayer = document.getElementById('productVideo');
const videoWidget = document.getElementById('videoPlayerWidget');
const zoomToggleBtn = document.getElementById('zoomToggleBtn');
const narrationBtn = document.getElementById('narrationBtn');
const narrationIcon = document.getElementById('narrationIcon');
const narrationText = narrationBtn ? narrationBtn.querySelector('span') : null;
const fullscreenBtn = document.getElementById('fullscreenBtn');
const closeBtn = document.getElementById('closeBtn');
const videoProductCard = document.querySelector('.video-product-card');

let isMuted = true;
let currentZoom = 'normal'; // normal, zoomed, zoomed-out
let videoWatchStartTime = null;
let videoWatchDuration = 0;
let videoHoverStartTime = null;
let isVideoHovered = false;

// Video watch time tracking
if (videoPlayer) {
  videoPlayer.addEventListener('play', () => {
    videoWatchStartTime = Date.now();
    intentEngine.recordBehavior('video-play', {
      element: 'product-video',
      product: 'F1 Floating Pillow',
      action: 'play'
    });
  });

  videoPlayer.addEventListener('pause', () => {
    if (videoWatchStartTime) {
      videoWatchDuration += Date.now() - videoWatchStartTime;
      intentEngine.recordBehavior('video-pause', {
        element: 'product-video',
        product: 'F1 Floating Pillow',
        action: 'pause',
        watchDuration: Math.round((Date.now() - videoWatchStartTime) / 1000)
      });
      videoWatchStartTime = null;
    }
  });
}

// Log watch time every 5s
if (videoPlayer) {
  setInterval(() => {
    if (videoWatchStartTime && !videoPlayer.paused) {
      const currentWatchTime = Math.round((Date.now() - videoWatchStartTime + videoWatchDuration) / 1000);
      if (currentWatchTime % 5 === 0) {
        intentEngine.recordBehavior('video-watch', {
          element: 'product-video',
          product: 'F1 Floating Pillow',
          action: 'watching',
          watchDuration: currentWatchTime
        });
      }
    }
  }, 1000);
}

// Video hover
if (videoWidget) {
  videoWidget.addEventListener('mouseenter', () => {
    if (!isVideoHovered) {
      isVideoHovered = true;
      videoHoverStartTime = Date.now();
      intentEngine.recordBehavior('hover', {
        element: 'product-video-widget',
        product: 'F1 Floating Pillow',
        type: 'video-hover'
      });
    }
  });

  videoWidget.addEventListener('mouseleave', () => {
    if (isVideoHovered && videoHoverStartTime) {
      const hoverDuration = Math.round((Date.now() - videoHoverStartTime) / 1000);
      intentEngine.recordBehavior('video-hover-end', {
        element: 'product-video-widget',
        product: 'F1 Floating Pillow',
        hoverDuration: hoverDuration
      });
      isVideoHovered = false;
      videoHoverStartTime = null;
    }
  });
}

// Video click
if (videoPlayer) {
  videoPlayer.addEventListener('click', (e) => {
    if (e.target === videoPlayer) {
      intentEngine.recordBehavior('click', {
        element: 'product-video',
        product: 'F1 Floating Pillow',
        action: 'video-click'
      });
    }
  });
}

// Zoom toggle: normal -> zoomed -> zoomed-out -> normal
if (zoomToggleBtn && videoWidget) {
  zoomToggleBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    
    if (currentZoom === 'normal') {
      // Normal -> zoomed
      videoWidget.classList.remove('zoomed-out');
      videoWidget.classList.add('zoomed');
      currentZoom = 'zoomed';
      intentEngine.recordBehavior('click', {
        element: 'video-control',
        action: 'zoom-in',
        product: 'F1 Floating Pillow',
        zoomLevel: 'zoomed'
      });
    } else if (currentZoom === 'zoomed') {
      // Zoomed -> zoomed-out
      videoWidget.classList.remove('zoomed');
      videoWidget.classList.add('zoomed-out');
      currentZoom = 'zoomed-out';
      intentEngine.recordBehavior('click', {
        element: 'video-control',
        action: 'zoom-out',
        product: 'F1 Floating Pillow',
        zoomLevel: 'zoomed-out'
      });
    } else if (currentZoom === 'zoomed-out') {
      // Zoomed-out -> normal
      videoWidget.classList.remove('zoomed-out');
      currentZoom = 'normal';
      intentEngine.recordBehavior('click', {
        element: 'video-control',
        action: 'zoom-reset',
        product: 'F1 Floating Pillow',
        zoomLevel: 'normal'
      });
    }
  });
}

// Mute / unmute (narration button)
if (narrationBtn && videoPlayer) {
  narrationBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    if (videoPlayer.muted) {
      // Unmute: show speaker icon (no slash)
      videoPlayer.muted = false;
      if (narrationIcon) {
        narrationIcon.innerHTML = `
          <path d="M11 5L6 9H2v6h4l5 4V5zM19.07 4.93a10 10 0 010 14.14M15.54 8.46a5 5 0 010 7.07"/>
        `;
      }
      if (narrationText) {
        narrationText.textContent = 'Close narration';
      }
      isMuted = false;
      intentEngine.recordBehavior('click', {
        element: 'video-control',
        action: 'unmute',
        product: 'F1 Floating Pillow'
      });
    } else {
      // Mute: show speaker with slash
      videoPlayer.muted = true;
      if (narrationIcon) {
        narrationIcon.innerHTML = `
          <path d="M11 5L6 9H2v6h4l5 4V5zM19.07 4.93a10 10 0 010 14.14M15.54 8.46a5 5 0 010 7.07"/>
          <line x1="2" y1="2" x2="22" y2="22" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
        `;
      }
      if (narrationText) {
        narrationText.textContent = 'Open narration';
      }
      isMuted = true;
      intentEngine.recordBehavior('click', {
        element: 'video-control',
        action: 'mute',
        product: 'F1 Floating Pillow'
      });
    }
  });
}

// Fullscreen
if (fullscreenBtn && videoPlayer) {
  fullscreenBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    if (videoPlayer.requestFullscreen) {
      videoPlayer.requestFullscreen();
    } else if (videoPlayer.webkitRequestFullscreen) {
      videoPlayer.webkitRequestFullscreen();
    } else if (videoPlayer.mozRequestFullScreen) {
      videoPlayer.mozRequestFullScreen();
    } else if (videoPlayer.msRequestFullscreen) {
      videoPlayer.msRequestFullscreen();
    }
    intentEngine.recordBehavior('click', {
      element: 'video-control',
      action: 'fullscreen',
      product: 'F1 Floating Pillow'
    });
  });
}

// Product card click
if (videoProductCard) {
  videoProductCard.addEventListener('click', (e) => {
    // If button clicked, don't trigger card click
    if (e.target.closest('.video-btn-add-cart') || e.target.closest('.video-btn-buy-now')) {
      return;
    }
    e.stopPropagation();
    intentEngine.recordBehavior('click', {
      element: 'video-product-card',
      product: 'F1 Floating Pillow',
      action: 'view-product-details',
      price: 'USD 139.0'
    });
  });
  
  videoProductCard.style.cursor = 'pointer';
}

// Video widget add-to-cart button
const videoAddCartBtn = document.getElementById('videoAddCartBtn');
if (videoAddCartBtn) {
  videoAddCartBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    const btn = e.currentTarget;
    const product = btn.getAttribute('data-product');
    const action = btn.getAttribute('data-action');
    
    intentEngine.recordBehavior('click', {
      element: 'video-widget-button',
      product: product,
      action: action,
      price: 'USD 139.0'
    });
    
    // Update button state
    btn.classList.add('added');
    btn.innerHTML = '<span>✓</span>';
    
    // Show tooltip
    showTooltip(btn, 'Added to cart! Conversion stage advanced');
    
    // Restore button after 3s
    setTimeout(() => {
      btn.classList.remove('added');
      btn.innerHTML = '<span>🛒</span>';
    }, 3000);
  });
}

// Video widget buy-now button
const videoBuyNowBtn = document.getElementById('videoBuyNowBtn');
if (videoBuyNowBtn) {
  videoBuyNowBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    const btn = e.currentTarget;
    const product = btn.getAttribute('data-product');
    const action = btn.getAttribute('data-action');
    
    intentEngine.recordBehavior('click', {
      element: 'video-widget-button',
      product: product,
      action: action,
      price: 'USD 139.0'
    });
    
    // Show tooltip
    showTooltip(btn, 'Purchase complete!');
    
    // Success animation
    btn.style.transform = 'scale(0.95)';
    setTimeout(() => {
      btn.style.transform = '';
    }, 200);
  });
}

// Update mute icon state
if (videoPlayer) {
  videoPlayer.addEventListener('volumechange', () => {
    if (videoPlayer.muted) {
      if (narrationIcon) {
        narrationIcon.innerHTML = `
          <path d="M11 5L6 9H2v6h4l5 4V5zM19.07 4.93a10 10 0 010 14.14M15.54 8.46a5 5 0 010 7.07"/>
        `;
      }
      if (narrationText) {
        narrationText.textContent = 'Open narration';
      }
    } else {
      if (narrationIcon) {
        narrationIcon.innerHTML = `
          <path d="M11 5L6 9H2v6h4l5 4V5zM15.54 8.46a5 5 0 010 7.07M19.07 4.93a10 10 0 010 14.14"/>
        `;
      }
      if (narrationText) {
        narrationText.textContent = 'Close narration';
      }
    }
  });

  // Video load error
  videoPlayer.addEventListener('error', () => {
    console.warn('Video failed to load. Ensure products/product-video.mp4 exists.');
  });

  // Ensure video loops
  videoPlayer.addEventListener('ended', () => {
    videoPlayer.currentTime = 0;
    videoPlayer.play();
  });
}
</script>

<!-- Video player widget (floats above the page) -->
<div class="video-player-widget" id="videoPlayerWidget">
  <div class="video-attention-badge">🎬 Watch Video</div>
  <video id="productVideo" class="product-video" autoplay loop muted playsinline>
    <source src="products/product-video.mp4" type="video/mp4">
    <source src="products/product-video.webm" type="video/webm">
    Your browser does not support video playback.
  </video>
  <div class="video-controls-overlay">
    <!-- Top controls -->
    <div class="video-controls-top">
      <!-- Close button -->
      <div class="video-controls-top-left">
        <button class="video-control-btn" id="closeBtn" title="Close">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <!-- Zoom toggle -->
      <div class="video-controls-top-right">
        <button class="video-control-btn" id="zoomToggleBtn" title="Zoom">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="6" y="6" width="12" height="12" rx="1"/>
            <path d="M6 2v4M18 2v4M6 22v-4M18 22v-4M2 6h4M22 6h4M2 18h4M22 18h4"/>
          </svg>
        </button>
      </div>
      
      <!-- Narration button -->
      <button class="video-narration-btn" id="narrationBtn" title="Open narration">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" id="narrationIcon">
          <path d="M11 5L6 9H2v6h4l5 4V5zM19.07 4.93a10 10 0 010 14.14M15.54 8.46a5 5 0 010 7.07"/>
          <line x1="2" y1="2" x2="22" y2="22"/>
        </svg>
        <span>Open narration</span>
      </button>
    </div>
    
    <!-- Side label: Reviews -->
    <div class="video-side-label">Reviews</div>
    
    <!-- Product card overlay -->
    <div class="video-product-overlay">
      <div class="video-product-card">
        <div class="video-product-thumbnail">
          <img src="products/product-preview.png" alt="Product Preview" 
               onerror="this.onerror=null; this.style.display='none'; this.parentElement.querySelector('.thumbnail-placeholder').style.display='block';"
               onload="this.parentElement.classList.add('has-image'); this.parentElement.querySelector('.thumbnail-placeholder').style.display='none';">
          <svg width="55" height="55" viewBox="0 0 55 55" class="thumbnail-placeholder" style="position: absolute; top: 0; left: 0; z-index: 1;">
            <defs>
              <linearGradient id="pillowGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#64b5f6;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#42a5f5;stop-opacity:1" />
              </linearGradient>
            </defs>
            <rect width="55" height="55" rx="10" fill="#e3f2fd"/>
            <rect x="3" y="3" width="49" height="49" rx="7" fill="url(#pillowGradient)"/>
            <rect x="9" y="12" width="37" height="31" rx="4" fill="rgba(255,255,255,0.3)"/>
            <rect x="12" y="16" width="31" height="23" rx="3" fill="rgba(255,255,255,0.2)"/>
          </svg>
        </div>
        <div class="video-product-info">
          <div class="video-product-name">Ikarao Shell S1 Karaoke Mac...</div>
          <div class="video-product-description">Immersive High-Fidelity Sound The Ikarao Shell S1 delivers impressive...</div>
          <div class="video-product-price-row">
            <div class="video-product-price">
              <span class="video-product-discount-price">$279.99</span>
              <span class="video-product-original-price">$399.99</span>
            </div>
            <div class="video-product-actions">
              <button class="video-btn-buy-now" id="videoBuyNowBtn" data-product="F1 Floating Pillow" data-action="buy-now" title="Buy now">
                <span>Buy now</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
  </div>
</div>
</body>
</html>
