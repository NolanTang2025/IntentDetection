<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>å®æ—¶æ„å›¾ä½“éªŒ | Intent Recognition Demo</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
  
  :root {
    --primary: #00ff88;
    --primary-dark: #00cc6f;
    --bg-dark: #000000;
    --bg-secondary: #0a0a0a;
    --text-primary: #ffffff;
    --text-secondary: #a0a0a0;
    --border: rgba(255, 255, 255, 0.08);
    --glass: rgba(255, 255, 255, 0.03);
    --shop-bg: #ffffff;
    --shop-text: #1a1a1a;
    --shop-border: #e5e5e5;
  }
  
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  
 body {
    margin: 0;
    padding: 0;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg-dark);
    color: var(--text-primary);
    display: flex;
    flex-direction: column;
    height: 100vh;
    position: relative;
    overflow: hidden;
  }
  
  /* Grain texture */
  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.4'/%3E%3C/svg%3E");
    opacity: 0.1;
    pointer-events: none;
    z-index: 1;
  }
  
  .navbar {
    background: rgba(10, 10, 10, 0.8);
    border-bottom: 1px solid var(--border);
    padding: 16px 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    backdrop-filter: blur(20px);
    z-index: 1000;
    position: relative;
  }
  
  .navbar-brand {
    font-weight: 700;
    font-size: 16px;
    letter-spacing: -0.5px;
    color: var(--text-primary);
  }
  
  .navbar-links {
    display: flex;
    gap: 12px;
    align-items: center;
  }
  
  .navbar a {
    color: var(--text-primary);
    text-decoration: none;
    padding: 10px 20px;
    border-radius: 8px;
    font-size: 14px;
    transition: all 0.2s;
    font-weight: 500;
    opacity: 0.8;
  }
  
  .navbar a:hover {
    background: var(--glass);
    opacity: 1;
  }
  
  .navbar .home-link {
    background: rgba(0, 255, 136, 0.1);
    color: var(--primary);
    border: 1px solid rgba(0, 255, 136, 0.2);
  }
  
  .navbar .home-link:hover {
    background: rgba(0, 255, 136, 0.15);
    border-color: rgba(0, 255, 136, 0.3);
  }
  
  .content-wrapper {
    display: flex;
    flex: 1;
    overflow: hidden;
    position: relative;
    z-index: 2;
  }
  
  /* å·¦ä¾§ï¼šæ¨¡æ‹Ÿç‹¬ç«‹ç«™ */
  .shop-panel {
    width: 50%;
    background: var(--shop-bg);
    border-right: 1px solid var(--border);
    position: relative;
    overflow-y: auto;
    color: var(--shop-text);
  }
  
  .shop-panel::-webkit-scrollbar {
    width: 8px;
  }
  
  .shop-panel::-webkit-scrollbar-thumb {
    background: var(--shop-border);
    border-radius: 4px;
  }
  
  /* å•†åº—å¯¼èˆªæ  */
  .shop-header {
    background: var(--shop-bg);
    border-bottom: 1px solid var(--shop-border);
    padding: 16px 40px;
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(10px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
  }
  
  .shop-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .shop-logo {
    font-size: 22px;
    font-weight: 700;
    color: var(--shop-text);
    letter-spacing: -0.5px;
  }
  
  .shop-menu {
    display: flex;
    gap: 40px;
    list-style: none;
    align-items: center;
  }
  
  .shop-menu li {
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: color 0.2s;
    position: relative;
  }
  
  .shop-menu li:hover {
    color: #333;
  }
  
  .shop-menu li::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 0;
    height: 2px;
    background: #333;
    transition: width 0.3s;
  }
  
  .shop-menu li:hover::after {
    width: 100%;
  }
  
  .shop-actions {
    display: flex;
    gap: 20px;
    align-items: center;
  }
  
  .shop-search {
    display: flex;
    align-items: center;
    background: #f5f5f5;
    border-radius: 20px;
    padding: 8px 16px;
    gap: 8px;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .shop-search:hover {
    background: #e8e8e8;
  }
  
  .shop-search-icon {
    width: 16px;
    height: 16px;
    opacity: 0.5;
  }
  
  .shop-search input {
    border: none;
    background: transparent;
    outline: none;
    font-size: 14px;
    width: 120px;
  }
  
  .shop-cart {
    width: 24px;
    height: 24px;
    cursor: pointer;
    opacity: 0.7;
    transition: opacity 0.2s;
  }
  
  .shop-cart:hover {
    opacity: 1;
  }
  
  /* Hero Banner */
  .shop-banner {
    background: linear-gradient(135deg, #00ff88 0%, #7da6ff 100%);
    color: white;
    padding: 100px 40px;
    text-align: center;
    margin: 0;
    position: relative;
    overflow: hidden;
  }
  
  .shop-banner::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    opacity: 0.3;
  }
  
  .shop-banner h2 {
    font-size: 52px;
    font-weight: 800;
    margin-bottom: 16px;
    position: relative;
    z-index: 1;
    letter-spacing: -1px;
  }
  
  .shop-banner p {
    font-size: 20px;
    opacity: 0.95;
    position: relative;
    z-index: 1;
    margin-bottom: 32px;
  }
  
  .shop-banner-btn {
    background: white;
    color: #00ff88;
    padding: 14px 32px;
    border-radius: 30px;
    font-weight: 600;
    font-size: 16px;
    border: none;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    z-index: 1;
  }
  
  .shop-banner-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
  }
  
  /* äº§å“BanneråŒºåŸŸ */
  .product-banners {
    padding: 60px 40px;
    background: #fafafa;
  }
  
  .banner-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 24px;
    margin-bottom: 60px;
  }
  
  .product-banner-card {
    background: white;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
  }
  
  .product-banner-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
  }
  
  .banner-image {
    width: 100%;
    height: 280px;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    position: relative;
    overflow: hidden;
  }
  
  .banner-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .banner-content {
    padding: 32px;
  }
  
  .banner-content h3 {
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 12px;
    color: var(--shop-text);
  }
  
  .banner-content p {
    font-size: 15px;
    color: #666;
    line-height: 1.6;
    margin-bottom: 20px;
  }
  
  .banner-link {
    color: #00ff88;
    font-weight: 600;
    font-size: 14px;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: gap 0.2s;
  }
  
  .banner-link:hover {
    gap: 12px;
  }
  
  /* åˆ†ç±»æ ‡ç­¾ */
  .category-tags {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: 40px;
    padding: 0 40px;
  }
  
  .category-tag {
    padding: 10px 24px;
    background: white;
    border: 2px solid var(--shop-border);
    border-radius: 30px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .category-tag:hover,
  .category-tag.active {
    background: #333;
    color: white;
    border-color: #333;
  }
  
  /* äº§å“ç½‘æ ¼ */
  .products-section {
    padding: 60px 40px;
  }
  
  .section-title {
    font-size: 32px;
    font-weight: 700;
    margin-bottom: 40px;
    text-align: center;
  }
  
  .products-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 32px;
    margin-bottom: 60px;
  }
  
  .product-card {
    background: var(--shop-bg);
    border: 1px solid var(--shop-border);
    border-radius: 12px;
    overflow: hidden;
    cursor: pointer;
    opacity: 0;
    transform: translateY(20px) scale(0.95);
    transition: box-shadow 0.3s, border-color 0.3s, transform 0.3s;
    animation: product-card-appear 0.8s ease-out forwards;
    visibility: hidden;
  }
  
  /* ç¡®ä¿åŠ¨ç”»å®Œæˆåå¡ç‰‡å¯è§ */
  .product-card[style*="opacity: 1"],
  .product-card:not([style*="opacity: 0"]) {
    visibility: visible !important;
  }
  
  /* åŠ¨ç”»å®Œæˆåçš„çŠ¶æ€ */
  .product-card.animation-complete {
    opacity: 1 !important;
    visibility: visible !important;
    transform: translateY(0) scale(1) !important;
  }
  
  /* ä½¿ç”¨æ›´ç²¾ç¡®çš„é€‰æ‹©å™¨ï¼Œé’ˆå¯¹æ¯ä¸ªç½‘æ ¼ä¸­çš„å¡ç‰‡ */
  .products-grid .product-card:nth-child(1) { animation-delay: 1.2s; }
  .products-grid .product-card:nth-child(2) { animation-delay: 1.4s; }
  .products-grid .product-card:nth-child(3) { animation-delay: 1.6s; }
  .products-grid .product-card:nth-child(4) { animation-delay: 1.8s; }
  .products-grid .product-card:nth-child(5) { animation-delay: 2.0s; }
  .products-grid .product-card:nth-child(6) { animation-delay: 2.2s; }
  
  @keyframes product-card-appear {
    0% {
      opacity: 0;
      visibility: hidden;
      transform: translateY(20px) scale(0.95);
    }
    100% {
      opacity: 1;
      visibility: visible;
      transform: translateY(0) scale(1);
    }
  }
  
  /* ç¡®ä¿åŠ¨ç”»å®Œæˆåæ‰åº”ç”¨æ‚¬åœæ•ˆæœ */
  .product-card:hover {
    transform: translateY(-4px) scale(1) !important;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    border-color: #999;
  }
  
  .product-image {
    width: 100%;
    height: 300px;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 48px;
    color: #999;
    position: relative;
    overflow: hidden;
  }
  
  .product-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s;
    display: block;
  }
  
  .product-image img[src=""],
  .product-image img:not([src]) {
    display: none;
  }
  
  .product-card:hover .product-image img {
    transform: scale(1.05);
  }
  
  .product-image.fallback {
    font-size: 48px;
    color: #999;
  }
  
  .product-image.fallback img {
    display: none;
  }
  
  .product-info {
    padding: 24px;
  }
  
  .product-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 8px;
  }
  
  .product-price {
    font-size: 20px;
    font-weight: 700;
    color: #333;
    margin-bottom: 16px;
  }
  
  .product-actions {
    display: flex;
    gap: 12px;
  }
  
  .btn-add-cart {
    flex: 1;
    padding: 12px 20px;
    background: var(--primary);
    color: var(--bg-dark);
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    font-family: 'Inter', sans-serif;
  }
  
  .btn-add-cart:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 255, 136, 0.3);
  }
  
  .btn-add-cart:active {
    transform: translateY(0);
  }
  
  .btn-view {
    padding: 12px 20px;
    background: transparent;
    color: #333;
    border: 2px solid var(--shop-border);
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    font-family: 'Inter', sans-serif;
  }
  
  .btn-view:hover {
    border-color: #999;
    background: #f5f5f5;
  }
  
  /* å¼•å¯¼æç¤º */
  .guide-tooltip {
    position: absolute;
    background: var(--primary);
    color: var(--bg-dark);
    padding: 12px 20px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    z-index: 1000;
    pointer-events: none;
    opacity: 0;
    transform: translateY(-10px);
    transition: all 0.3s;
  }
  
  .guide-tooltip.show {
    opacity: 1;
    transform: translateY(0);
  }
  
  .guide-tooltip::after {
    content: '';
    position: absolute;
    bottom: -6px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-top: 6px solid var(--primary);
  }
  
  /* å¼•å¯¼åŠ¨ç”» */
  .guide-highlight {
    position: relative;
    z-index: 10;
    animation: pulse-glow 2s ease-in-out infinite;
  }
  
  /* ç¡®ä¿é«˜äº®ä¸ä¼šå½±å“å•†å“å¡ç‰‡çš„æ˜¾ç¤º */
  .product-card.guide-highlight {
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
  }
  
  @keyframes pulse-glow {
    0%, 100% {
      box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.4);
    }
    50% {
      box-shadow: 0 0 0 8px rgba(0, 255, 136, 0);
    }
  }
  
  .guide-arrow {
    position: absolute;
    z-index: 999;
    pointer-events: none;
    animation: bounce-arrow 1.5s ease-in-out infinite;
  }
  
  @keyframes bounce-arrow {
    0%, 100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-10px);
    }
  }
  
  .guide-arrow svg {
    width: 32px;
    height: 32px;
    fill: var(--primary);
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
  }
  
  .guide-hint {
    position: absolute;
    background: linear-gradient(135deg, var(--primary) 0%, #7da6ff 100%);
    color: var(--bg-dark);
    padding: 14px 20px;
    border-radius: 12px;
    font-size: 15px;
    font-weight: 600;
    white-space: nowrap;
    z-index: 1001;
    pointer-events: none;
    animation: fade-in-out 4s ease-in-out infinite, hint-bounce 2.5s ease-in-out infinite;
    box-shadow: 0 4px 20px rgba(0, 255, 136, 0.4);
    border: 2px solid rgba(255, 255, 255, 0.3);
    transition: opacity 0.5s, transform 0.5s;
  }
  
  @keyframes hint-bounce {
    0%, 100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-8px);
    }
  }
  
  @keyframes fade-in-out {
    0%, 100% {
      opacity: 0;
      transform: translateY(-5px);
    }
    15%, 85% {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .guide-hint::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 8px solid transparent;
    border-right: 8px solid transparent;
    border-top: 8px solid var(--primary);
    filter: drop-shadow(0 2px 4px rgba(0, 255, 136, 0.3));
  }
  
  /* å¼•å¯¼è¦†ç›–å±‚ */
  .guide-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.3);
    z-index: 998;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
  }
  
  .guide-overlay.active {
    opacity: 1;
    pointer-events: all;
  }
  
  /* å¼•å¯¼æ­¥éª¤æŒ‡ç¤ºå™¨ */
  .guide-steps {
    position: fixed;
    bottom: 40px;
    right: 40px;
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.95) 0%, rgba(10, 10, 10, 0.95) 100%);
    color: white;
    padding: 24px 28px;
    border-radius: 16px;
    z-index: 1002;
    min-width: 280px;
    border: 2px solid var(--primary);
    box-shadow: 0 8px 32px rgba(0, 255, 136, 0.3), 0 0 0 4px rgba(0, 255, 136, 0.1);
    animation: guide-pulse 2s ease-in-out infinite;
    backdrop-filter: blur(10px);
  }
  
  @keyframes guide-pulse {
    0%, 100% {
      box-shadow: 0 8px 32px rgba(0, 255, 136, 0.3), 0 0 0 4px rgba(0, 255, 136, 0.1);
      transform: scale(1);
    }
    50% {
      box-shadow: 0 8px 40px rgba(0, 255, 136, 0.5), 0 0 0 8px rgba(0, 255, 136, 0.2);
      transform: scale(1.02);
    }
  }
  
  .guide-steps h4 {
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 16px;
    color: var(--primary);
    display: flex;
    align-items: center;
    gap: 8px;
    letter-spacing: 0.5px;
  }
  
  .guide-steps h4::before {
    content: 'âœ¨';
    font-size: 18px;
    animation: sparkle 2s ease-in-out infinite;
  }
  
  @keyframes sparkle {
    0%, 100% { transform: scale(1) rotate(0deg); }
    50% { transform: scale(1.2) rotate(180deg); }
  }
  
  .guide-step {
    font-size: 14px;
    padding: 10px 0;
    opacity: 0.5;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 500;
  }
  
  .guide-step.active {
    opacity: 1;
    color: var(--primary);
    font-weight: 600;
    transform: translateX(4px);
    text-shadow: 0 0 8px rgba(0, 255, 136, 0.5);
  }
  
  .guide-step.completed {
    opacity: 0.8;
    color: rgba(255, 255, 255, 0.7);
  }
  
  .guide-step::before {
    content: 'â—‹';
    font-size: 12px;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    transition: all 0.3s;
  }
  
  .guide-step.active::before {
    content: 'â—';
    color: var(--primary);
    background: rgba(0, 255, 136, 0.2);
    box-shadow: 0 0 12px rgba(0, 255, 136, 0.6);
    animation: active-dot 1.5s ease-in-out infinite;
  }
  
  @keyframes active-dot {
    0%, 100% {
      box-shadow: 0 0 12px rgba(0, 255, 136, 0.6);
      transform: scale(1);
    }
    50% {
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.9);
      transform: scale(1.1);
    }
  }
  
  .guide-step.completed::before {
    content: 'âœ“';
    color: var(--primary);
    background: rgba(0, 255, 136, 0.15);
    font-size: 14px;
    font-weight: bold;
  }
  
  /* å¼•å¯¼æç¤ºå¼¹çª— */
  .guide-notification {
    position: fixed;
    top: 80px;
    right: 40px;
    background: linear-gradient(135deg, var(--primary) 0%, #7da6ff 100%);
    color: var(--bg-dark);
    padding: 20px 24px;
    border-radius: 16px;
    z-index: 1003;
    min-width: 320px;
    box-shadow: 0 8px 32px rgba(0, 255, 136, 0.4);
    animation: slide-in-right 0.5s ease-out, notification-pulse 2s ease-in-out infinite 0.5s;
    transform: translateX(0);
  }
  
  @keyframes slide-in-right {
    from {
      transform: translateX(400px);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  @keyframes notification-pulse {
    0%, 100% {
      box-shadow: 0 8px 32px rgba(0, 255, 136, 0.4);
    }
    50% {
      box-shadow: 0 8px 40px rgba(0, 255, 136, 0.6);
    }
  }
  
  .guide-notification h5 {
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .guide-notification p {
    font-size: 14px;
    line-height: 1.5;
    opacity: 0.9;
  }
  
  .guide-notification-close {
    position: absolute;
    top: 12px;
    right: 12px;
    width: 24px;
    height: 24px;
    border: none;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 50%;
    color: var(--bg-dark);
    cursor: pointer;
    font-size: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }
  
  .guide-notification-close:hover {
    background: rgba(0, 0, 0, 0.3);
    transform: scale(1.1);
  }
  
  /* å³ä¾§ï¼šæ„å›¾è¯†åˆ«è¾“å‡º */
  .intent-panel {
    width: 50%;
    padding: 40px;
    overflow-y: auto;
    background: var(--bg-dark);
    position: relative;
  }
  
  .intent-panel::-webkit-scrollbar {
    width: 6px;
  }
  
  .intent-panel::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 3px;
  }
  
  .intent-header {
    margin-bottom: 32px;
  }
  
  .intent-header h2 {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 8px;
    letter-spacing: -0.5px;
  }
  
  .intent-header .subtitle {
    font-size: 14px;
    color: var(--text-secondary);
  }
  
  .intent-status {
    display: inline-block;
    padding: 6px 12px;
    background: rgba(0, 255, 136, 0.1);
    border: 1px solid rgba(0, 255, 136, 0.2);
    border-radius: 6px;
    font-size: 12px;
    color: var(--primary);
    font-weight: 600;
    margin-bottom: 24px;
  }
  
  /* è½¬åŒ–é“¾è·¯å¯è§†åŒ– */
  .conversion-funnel {
    background: var(--glass);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 24px;
  }
  
  .conversion-funnel h3 {
    font-size: 16px;
    font-weight: 600;
    color: var(--primary);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .funnel-steps {
    display: flex;
    justify-content: space-between;
    gap: 12px;
    position: relative;
  }
  
  .funnel-steps::before {
    content: '';
    position: absolute;
    top: 20px;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--border);
    z-index: 0;
  }
  
  .funnel-step {
    flex: 1;
    text-align: center;
    position: relative;
    z-index: 1;
  }
  
  .funnel-step-circle {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--border);
    border: 2px solid var(--border);
    margin: 0 auto 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    font-weight: 700;
    color: var(--text-secondary);
    transition: all 0.5s;
    position: relative;
  }
  
  .funnel-step.active .funnel-step-circle {
    background: var(--primary);
    border-color: var(--primary);
    color: var(--bg-dark);
    box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
    transform: scale(1.1);
  }
  
  .funnel-step.completed .funnel-step-circle {
    background: rgba(0, 255, 136, 0.3);
    border-color: var(--primary);
    color: var(--primary);
  }
  
  .funnel-step.completed .funnel-step-circle::after {
    content: 'âœ“';
    position: absolute;
    font-size: 16px;
  }
  
  .funnel-step-label {
    font-size: 12px;
    color: var(--text-secondary);
    font-weight: 500;
    transition: color 0.3s;
  }
  
  .funnel-step.active .funnel-step-label {
    color: var(--primary);
    font-weight: 600;
  }
  
  .funnel-step.completed .funnel-step-label {
    color: var(--text-secondary);
    opacity: 0.8;
  }
  
  .funnel-progress {
    height: 4px;
    background: var(--border);
    border-radius: 2px;
    margin-top: 16px;
    overflow: hidden;
    position: relative;
  }
  
  .funnel-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), #7da6ff);
    border-radius: 2px;
    transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
  }
  
  .funnel-progress-bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    animation: shimmer 2s infinite;
  }
  
  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }
  
  .intent-card {
    background: var(--glass);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 20px;
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .intent-card.show {
    opacity: 1;
    transform: translateY(0);
    animation: card-appear 1s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  @keyframes card-appear {
    0% {
      opacity: 0;
      transform: translateY(30px) scale(0.96);
    }
    60% {
      transform: translateY(-3px) scale(1.01);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
  
  /* é¡µé¢åŠ è½½åŠ¨ç”» */
  .page-loading {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--bg-dark);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 24px;
    opacity: 1;
    transition: opacity 1s ease-out;
  }
  
  .page-loading.hide {
    opacity: 0;
    pointer-events: none;
  }
  
  .loading-logo {
    font-size: 48px;
    font-weight: 800;
    background: linear-gradient(135deg, var(--primary) 0%, #7da6ff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: logo-fade-in 1.2s ease-out;
  }
  
  @keyframes logo-fade-in {
    0% {
      opacity: 0;
      transform: translateY(20px) scale(0.9);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
  
  .loading-text {
    font-size: 16px;
    color: var(--text-secondary);
    animation: text-fade-in 1.5s ease-out;
  }
  
  @keyframes text-fade-in {
    0%, 50% {
      opacity: 0;
    }
    100% {
      opacity: 1;
    }
  }
  
  .loading-progress {
    width: 200px;
    height: 2px;
    background: var(--border);
    border-radius: 1px;
    overflow: hidden;
    margin-top: 8px;
  }
  
  .loading-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), #7da6ff);
    border-radius: 1px;
    width: 0%;
    animation: progress-load 2s ease-out forwards;
  }
  
  @keyframes progress-load {
    0% {
      width: 0%;
    }
    100% {
      width: 100%;
    }
  }
  
  /* å•†åº—é¢æ¿åˆå§‹åŠ¨ç”» */
  .shop-panel {
    opacity: 0;
    animation: panel-fade-in 1.2s ease-out 0.5s forwards;
    position: relative;
  }
  
  @keyframes panel-fade-in {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
  
  /* è§†é¢‘æ’­æ”¾å™¨ç»„ä»¶ï¼ˆ9:16æ ¼å¼ï¼Œä½œä¸ºç‹¬ç«‹æ’ä»¶æ‚¬æµ®åœ¨æ¨¡æ‹Ÿç½‘é¡µä¸Šæ–¹ï¼‰ */
  .video-player-widget {
    position: fixed;
    bottom: 20px;
    right: calc(50% + 20px);
    width: 180px;
    aspect-ratio: 9 / 16;
    z-index: 10000;
    overflow: hidden;
    pointer-events: auto;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.5s ease, transform 0.5s ease;
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    background: #000;
  }
  
  .video-player-widget.loaded {
    opacity: 1;
    transform: translateY(0);
  }
  
  .product-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }
  
  .video-controls-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    opacity: 1;
    display: flex;
    flex-direction: column;
  }
  
  .video-controls-top {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    padding: 12px;
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    pointer-events: auto;
    z-index: 10;
  }
  
  .video-controls-top-left {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .video-controls-top-right {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 8px;
  }
  
  /* é¡¶éƒ¨ä¸­å¤®æ–‡æœ¬ */
  .video-intro-text {
    position: absolute;
    top: 12px;
    left: 50%;
    transform: translateX(-50%);
    color: white;
    font-size: 13px;
    font-weight: 600;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    pointer-events: none;
    z-index: 5;
    letter-spacing: 0.5px;
  }
  
  /* å³ä¾§å‚ç›´æ ‡ç­¾ */
  .video-side-label {
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%) rotate(90deg);
    transform-origin: center;
    background: rgba(0, 0, 0, 0.6);
    color: white;
    font-size: 11px;
    font-weight: 600;
    padding: 6px 12px;
    writing-mode: vertical-rl;
    text-orientation: mixed;
    pointer-events: none;
    z-index: 5;
    letter-spacing: 1px;
  }
  
  /* åº•éƒ¨äº§å“ä¿¡æ¯è¦†ç›–å±‚ */
  .video-product-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.85) 0%, rgba(0, 0, 0, 0.6) 50%, transparent 100%);
    padding: 16px 12px 12px;
    pointer-events: auto;
    z-index: 10;
  }
  
  .video-product-text {
    color: white;
    font-size: 12px;
    line-height: 1.4;
    margin-bottom: 10px;
    opacity: 0.9;
  }
  
  .video-product-card {
    background: rgba(60, 60, 60, 0.95);
    border-radius: 8px;
    padding: 10px;
    display: flex;
    gap: 10px;
    align-items: center;
  }
  
  .video-product-thumbnail {
    width: 50px;
    height: 50px;
    border-radius: 6px;
    background: linear-gradient(135deg, #7da6ff 0%, #60a5fa 100%);
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 20px;
    overflow: hidden;
    position: relative;
  }
  
  .video-product-thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    position: relative;
    z-index: 2;
  }
  
  .video-product-thumbnail .thumbnail-placeholder {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
    display: block;
  }
  
  .video-product-thumbnail.has-image .thumbnail-placeholder {
    display: none;
  }
  
  .video-product-info {
    flex: 1;
    min-width: 0;
  }
  
  .video-product-name {
    color: #fff;
    font-size: 13px;
    font-weight: 700;
    margin-bottom: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  .video-product-price {
    display: flex;
    align-items: baseline;
    gap: 6px;
  }
  
  .video-product-original-price {
    color: #999;
    font-size: 11px;
    text-decoration: line-through;
  }
  
  .video-product-discount-price {
    color: #ff4444;
    font-size: 16px;
    font-weight: 700;
  }
  
  .video-controls-right {
    position: absolute;
    top: 60px;
    right: 12px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    pointer-events: auto;
    z-index: 10;
  }
  
  .video-control-btn {
    width: 32px;
    height: 32px;
    background: rgba(0, 0, 0, 0.75);
    border: none;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    color: white;
    backdrop-filter: blur(10px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
    flex-shrink: 0;
  }
  
  .video-control-btn:hover {
    background: rgba(0, 0, 0, 0.9);
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
  }
  
  .video-control-btn:active {
    transform: scale(0.95);
  }
  
  .video-control-btn svg {
    width: 16px;
    height: 16px;
  }
  
  .video-player-widget.zoomed {
    width: 360px;
  }
  
  .video-player-widget.zoomed-out {
    width: 120px;
  }
  
  @media (max-width: 1024px) {
    .video-player-widget {
      width: 150px;
    }
    
    .video-player-widget.zoomed {
      width: 300px;
    }
    
    .video-player-widget.zoomed-out {
      width: 100px;
    }
    
    .video-intro-text {
      font-size: 11px;
    }
    
    .video-product-text {
      font-size: 11px;
    }
    
    .video-product-name {
      font-size: 12px;
    }
    
    .video-product-discount-price {
      font-size: 14px;
    }
  }
  
  /* æ„å›¾é¢æ¿åˆå§‹åŠ¨ç”» */
  .intent-panel {
    opacity: 0;
    animation: panel-fade-in-right 1.2s ease-out 0.7s forwards;
  }
  
  @keyframes panel-fade-in-right {
    from {
      opacity: 0;
      transform: translateX(20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
  
  
  /* Bannerå¡ç‰‡æ¸è¿›å‡ºç° */
  .product-banner-card {
    opacity: 0;
    transform: translateY(20px);
    animation: banner-card-appear 0.8s ease-out forwards;
  }
  
  .product-banner-card:nth-child(1) { animation-delay: 1.0s; }
  .product-banner-card:nth-child(2) { animation-delay: 1.2s; }
  
  @keyframes banner-card-appear {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* Hero Banneråˆå§‹åŠ¨ç”» */
  .shop-banner {
    opacity: 0;
    transform: translateY(30px);
    animation: banner-hero-appear 1s ease-out 0.8s forwards;
  }
  
  @keyframes banner-hero-appear {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* å›¾è¡¨æ ·å¼ */
  .chart-container {
    margin-top: 16px;
  }
  
  .chart-title {
    font-size: 13px;
    color: var(--text-secondary);
    margin-bottom: 12px;
    font-weight: 500;
  }
  
  /* æŸ±çŠ¶å›¾ */
  .bar-chart {
    display: flex;
    align-items: flex-end;
    gap: 8px;
    height: 120px;
    padding: 12px 0;
  }
  
  .bar-item {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
  }
  
  .bar {
    width: 100%;
    background: linear-gradient(180deg, var(--primary), #7da6ff);
    border-radius: 4px 4px 0 0;
    position: relative;
    transition: height 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    min-height: 4px;
    animation: bar-grow 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  @keyframes bar-grow {
    from {
      height: 0;
      opacity: 0.5;
    }
    to {
      opacity: 1;
    }
  }
  
  .bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 100%;
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.3), transparent);
    border-radius: 4px 4px 0 0;
  }
  
  .bar-label {
    font-size: 11px;
    color: var(--text-secondary);
    text-align: center;
    font-weight: 500;
  }
  
  .bar-value {
    font-size: 12px;
    color: var(--primary);
    font-weight: 600;
    margin-top: 4px;
  }
  
  /* é¥¼å›¾ */
  .pie-chart {
    position: relative;
    width: 160px;
    height: 160px;
    margin: 0 auto;
  }
  
  .pie-svg {
    width: 100%;
    height: 100%;
    transform: rotate(-90deg);
  }
  
  .pie-segment {
    transition: stroke-dasharray 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    animation: pie-draw 1s ease-out;
  }
  
  @keyframes pie-draw {
    from {
      stroke-dasharray: 0 502;
    }
  }
  
  .pie-center {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
  }
  
  .pie-center-value {
    font-size: 24px;
    font-weight: 700;
    color: var(--primary);
  }
  
  .pie-center-label {
    font-size: 12px;
    color: var(--text-secondary);
  }
  
  /* ä»ªè¡¨ç›˜ */
  .gauge-container {
    position: relative;
    width: 200px;
    height: 100px;
    margin: 0 auto;
  }
  
  .gauge-svg {
    width: 100%;
    height: 100%;
  }
  
  .gauge-arc {
    fill: none;
    stroke-width: 12;
    stroke-linecap: round;
    transition: stroke-dasharray 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    animation: gauge-fill 1s ease-out;
  }
  
  @keyframes gauge-fill {
    from {
      stroke-dasharray: 0 314;
    }
  }
  
  .gauge-value {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 28px;
    font-weight: 700;
    color: var(--primary);
    text-align: center;
  }
  
  .gauge-label {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    font-size: 12px;
    color: var(--text-secondary);
  }
  
  /* æ—¶é—´çº¿å›¾è¡¨ */
  .timeline-chart {
    position: relative;
    padding: 20px 0;
  }
  
  .timeline-line {
    position: absolute;
    left: 20px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: var(--border);
  }
  
  .timeline-item {
    position: relative;
    padding-left: 50px;
    margin-bottom: 16px;
    opacity: 0;
    animation: timeline-appear 0.5s ease-out forwards;
  }
  
  @keyframes timeline-appear {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
  
  .timeline-dot {
    position: absolute;
    left: 11px;
    top: 4px;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: var(--primary);
    border: 3px solid var(--bg-dark);
    box-shadow: 0 0 12px rgba(0, 255, 136, 0.5);
    animation: dot-pulse 2s ease-in-out infinite;
  }
  
  @keyframes dot-pulse {
    0%, 100% {
      box-shadow: 0 0 12px rgba(0, 255, 136, 0.5);
    }
    50% {
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.8);
    }
  }
  
  .timeline-content {
    font-size: 13px;
    color: var(--text-secondary);
  }
  
  .timeline-time {
    font-size: 11px;
    color: var(--primary);
    font-weight: 600;
    margin-bottom: 4px;
  }
  
  .timeline-text {
    color: var(--text-secondary);
  }
  
  /* æ•°å­—åŠ¨ç”» */
  .animated-number {
    display: inline-block;
    font-weight: 700;
    color: var(--primary);
    animation: number-pop 0.5s ease-out;
  }
  
  @keyframes number-pop {
    0% {
      transform: scale(0.5);
      opacity: 0;
    }
    50% {
      transform: scale(1.2);
    }
    100% {
      transform: scale(1);
      opacity: 1;
    }
  }
  
  /* å®Œæˆç‰¹æ•ˆ */
  .completion-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    z-index: 10001;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s;
  }
  
  .completion-overlay.show {
    opacity: 1;
    pointer-events: all;
  }
  
  .completion-modal {
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.95) 0%, rgba(10, 10, 10, 0.95) 100%);
    border: 2px solid var(--primary);
    border-radius: 24px;
    padding: 60px 40px;
    text-align: center;
    max-width: 500px;
    position: relative;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0, 255, 136, 0.3);
    transform: scale(0.8);
    opacity: 0;
    animation: modal-appear 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }
  
  @keyframes modal-appear {
    0% {
      transform: scale(0.8) translateY(50px);
      opacity: 0;
    }
    50% {
      transform: scale(1.05) translateY(-10px);
    }
    100% {
      transform: scale(1) translateY(0);
      opacity: 1;
    }
  }
  
  .completion-modal::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(0, 255, 136, 0.1) 0%, transparent 70%);
    animation: rotate-glow 3s linear infinite;
  }
  
  @keyframes rotate-glow {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }
  
  .completion-icon {
    font-size: 80px;
    margin-bottom: 24px;
    animation: icon-bounce 1s ease-in-out infinite;
    position: relative;
    z-index: 1;
  }
  
  @keyframes icon-bounce {
    0%, 100% {
      transform: translateY(0) scale(1);
    }
    50% {
      transform: translateY(-10px) scale(1.1);
    }
  }
  
  .completion-title {
    font-size: 36px;
    font-weight: 800;
    margin-bottom: 16px;
    background: linear-gradient(135deg, var(--primary) 0%, #7da6ff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    position: relative;
    z-index: 1;
    letter-spacing: -1px;
  }
  
  .completion-message {
    font-size: 16px;
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: 32px;
    position: relative;
    z-index: 1;
  }
  
  .completion-stats {
    display: flex;
    justify-content: space-around;
    margin: 32px 0;
    padding: 24px;
    background: rgba(0, 255, 136, 0.05);
    border-radius: 16px;
    border: 1px solid rgba(0, 255, 136, 0.2);
    position: relative;
    z-index: 1;
  }
  
  .completion-stat {
    text-align: center;
  }
  
  .completion-stat-value {
    font-size: 32px;
    font-weight: 700;
    color: var(--primary);
    display: block;
    margin-bottom: 8px;
  }
  
  .completion-stat-label {
    font-size: 13px;
    color: var(--text-secondary);
  }
  
  .completion-button {
    background: var(--primary);
    color: var(--bg-dark);
    border: none;
    padding: 16px 40px;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    z-index: 1;
    font-family: 'Inter', sans-serif;
  }
  
  .completion-button:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 255, 136, 0.4);
  }
  
  /* çƒŸèŠ±ç‰¹æ•ˆ */
  .firework {
    position: fixed;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    pointer-events: none;
    z-index: 9999;
    box-shadow: 0 0 8px currentColor;
  }
  
  .confetti {
    position: fixed;
    width: 10px;
    height: 10px;
    background: var(--primary);
    pointer-events: none;
    z-index: 9999;
    animation: confetti-fall 3s ease-out forwards;
  }
  
  @keyframes confetti-fall {
    0% {
      transform: translateY(-100vh) rotate(0deg);
      opacity: 1;
    }
    100% {
      transform: translateY(100vh) rotate(720deg);
      opacity: 0;
    }
  }
  
  .sparkle {
    position: absolute;
    width: 6px;
    height: 6px;
    background: var(--primary);
    border-radius: 50%;
    pointer-events: none;
    animation: sparkle-anim 1.5s ease-out infinite;
  }
  
  @keyframes sparkle-anim {
    0%, 100% {
      opacity: 0;
      transform: scale(0);
    }
    50% {
      opacity: 1;
      transform: scale(1);
    }
  }
  
  .intent-card h3 {
    font-size: 16px;
    font-weight: 600;
    color: var(--primary);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .intent-card h3::before {
    content: 'â—';
    font-size: 8px;
    color: var(--primary);
  }
  
  .intent-content {
    color: var(--text-secondary);
    font-size: 14px;
    line-height: 1.6;
  }
  
  .intent-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 12px;
  }
  
  .intent-tag {
    padding: 6px 12px;
    background: rgba(0, 255, 136, 0.1);
    border: 1px solid rgba(0, 255, 136, 0.2);
    border-radius: 6px;
    font-size: 12px;
    color: var(--primary);
    font-weight: 500;
  }
  
  .intent-json {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid var(--border);
    padding: 16px;
    border-radius: 8px;
    font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
    font-size: 12px;
    color: var(--primary);
    margin-top: 12px;
    white-space: pre-wrap;
    max-height: 200px;
    overflow-y: auto;
  }
  
  .empty-state {
    text-align: center;
    padding: 80px 20px;
    color: var(--text-secondary);
  }
  
  .empty-state-icon {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
  }
  
  .empty-state h3 {
    font-size: 18px;
    margin-bottom: 8px;
    color: var(--text-primary);
  }
  
  .empty-state p {
    font-size: 14px;
    line-height: 1.6;
  }
  
  @media (max-width: 1024px) {
    .content-wrapper {
      flex-direction: column;
    }
    
    .shop-panel,
    .intent-panel {
      width: 100%;
      height: 50vh;
    }
    
    .products-grid {
      grid-template-columns: 1fr;
    }
 }
</style>
</head>
<body>
<div class="page-loading" id="pageLoading">
  <div class="loading-logo">INTENT RECOGNITION</div>
  <div class="loading-text">æ­£åœ¨åŠ è½½ä½“éªŒå¹³å°...</div>
  <div class="loading-progress">
    <div class="loading-progress-bar"></div>
  </div>
</div>
<nav class="navbar">
  <div class="navbar-brand">INTENT RECOGNITION</div>
  <div class="navbar-links">
    <a href="index.html" class="home-link">é¦–é¡µ</a>
    <a href="user_intent_report.html">æ„å›¾è¯†åˆ«æ¡†æ¶</a>
  </div>
</nav>
<div class="content-wrapper">
  <!-- å·¦ä¾§ï¼šæ¨¡æ‹Ÿç‹¬ç«‹ç«™ -->
  <div class="shop-panel" id="shopPanel">
    <div class="shop-header">
      <div class="shop-nav">
        <div class="shop-logo">FASHION STORE</div>
        <ul class="shop-menu">
          <li>é¦–é¡µ</li>
          <li>æ–°å“</li>
          <li>æœè£…</li>
          <li>é…é¥°</li>
          <li>å…³äº</li>
        </ul>
        <div class="shop-actions">
          <div class="shop-search">
            <svg class="shop-search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <input type="text" placeholder="æœç´¢å•†å“...">
          </div>
          <svg class="shop-cart" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
          </svg>
        </div>
      </div>
</div>

    <div class="shop-banner" data-tracking="banner-view">
      <h2>ç§‹å­£æ–°å“ä¸Šå¸‚</h2>
      <p>æ¢ç´¢èˆ’é€‚ä¸æ—¶å°šçš„å®Œç¾ç»“åˆï¼Œæ‰“é€ ä½ çš„ä¸“å±é£æ ¼</p>
      <button class="shop-banner-btn" data-tracking="banner-click">ç«‹å³æ¢ç´¢</button>
    </div>
    
    <!-- äº§å“BanneråŒºåŸŸ -->
    <div class="product-banners">
      <div class="banner-grid">
        <div class="product-banner-card" data-tracking="banner-hover">
          <div class="banner-image">
            <img src="products/banner-comfort.jpg" alt="èˆ’é€‚ç³»åˆ—" onerror="this.style.display='none';">
          </div>
          <div class="banner-content">
            <h3>èˆ’é€‚ç³»åˆ—</h3>
            <p>ç²¾é€‰ä¼˜è´¨é¢æ–™ï¼Œæ‰“é€ å…¨å¤©å€™èˆ’é€‚ä½“éªŒã€‚ä»å±…å®¶åˆ°å‡ºè¡Œï¼Œè®©èˆ’é€‚æˆä¸ºä½ çš„æ—¥å¸¸ã€‚</p>
            <a href="#" class="banner-link">æŸ¥çœ‹ç³»åˆ— â†’</a>
          </div>
        </div>
        
        <div class="product-banner-card" data-tracking="banner-hover">
          <div class="banner-image">
            <img src="products/banner-style.jpg" alt="æ—¶å°šç³»åˆ—" onerror="this.style.display='none';">
          </div>
          <div class="banner-content">
            <h3>æ—¶å°šç³»åˆ—</h3>
            <p>ç´§è·Ÿæ½®æµè¶‹åŠ¿ï¼Œèåˆç»å…¸ä¸ç°ä»£è®¾è®¡ï¼Œå±•ç°ä½ çš„ç‹¬ç‰¹å“å‘³ä¸ä¸ªæ€§é­…åŠ›ã€‚</p>
            <a href="#" class="banner-link">æŸ¥çœ‹ç³»åˆ— â†’</a>
          </div>
        </div>
      </div>
      
      <!-- åˆ†ç±»æ ‡ç­¾ -->
      <div class="category-tags">
        <div class="category-tag active">å…¨éƒ¨</div>
        <div class="category-tag">ä¸Šè£…</div>
        <div class="category-tag">ä¸‹è£…</div>
        <div class="category-tag">å¤–å¥—</div>
        <div class="category-tag">é…é¥°</div>
      </div>
    </div>
    
    <div class="products-section">
      <h2 class="section-title">çƒ­é—¨å•†å“</h2>
      <div class="products-grid">
        <div class="product-card" data-product="hoodie" data-tracking="product-hover">
          <div class="product-image">
            <img src="products/hoodie.jpg" alt="èˆ’é€‚è¿å¸½è¡«" onerror="this.onerror=null; this.style.display='none'; this.parentElement.classList.add('fallback'); this.parentElement.textContent='ğŸ‘•';">
          </div>
          <div class="product-info">
            <div class="product-title">èˆ’é€‚è¿å¸½è¡«</div>
            <div class="product-price">Â¥299</div>
            <div class="product-actions">
              <button class="btn-add-cart" data-product="hoodie" data-action="add-cart">åŠ å…¥è´­ç‰©è½¦</button>
              <button class="btn-view" data-product="hoodie" data-action="view">æŸ¥çœ‹</button>
            </div>
          </div>
        </div>
        
        <div class="product-card" data-product="sweater" data-tracking="product-hover">
          <div class="product-image">
            <img src="products/sweater.jpg" alt="ä¼‘é—²æ¯›è¡£" onerror="this.onerror=null; this.style.display='none'; this.parentElement.classList.add('fallback'); this.parentElement.textContent='ğŸ§¥';">
          </div>
          <div class="product-info">
            <div class="product-title">ä¼‘é—²æ¯›è¡£</div>
            <div class="product-price">Â¥399</div>
            <div class="product-actions">
              <button class="btn-add-cart" data-product="sweater" data-action="add-cart">åŠ å…¥è´­ç‰©è½¦</button>
              <button class="btn-view" data-product="sweater" data-action="view">æŸ¥çœ‹</button>
            </div>
          </div>
        </div>
        
        <div class="product-card" data-product="pants" data-tracking="product-hover">
          <div class="product-image">
            <img src="products/pants.jpg" alt="è¿åŠ¨é•¿è£¤" onerror="this.onerror=null; this.style.display='none'; this.parentElement.classList.add('fallback'); this.parentElement.textContent='ğŸ‘–';">
          </div>
          <div class="product-info">
            <div class="product-title">è¿åŠ¨é•¿è£¤</div>
            <div class="product-price">Â¥199</div>
            <div class="product-actions">
              <button class="btn-add-cart" data-product="pants" data-action="add-cart">åŠ å…¥è´­ç‰©è½¦</button>
              <button class="btn-view" data-product="pants" data-action="view">æŸ¥çœ‹</button>
            </div>
          </div>
        </div>
        
        <div class="product-card" data-product="jacket" data-tracking="product-hover">
          <div class="product-image">
            <img src="products/jacket.jpg" alt="ä¼‘é—²å¤¹å…‹" onerror="this.onerror=null; this.style.display='none'; this.parentElement.classList.add('fallback'); this.parentElement.textContent='ğŸ§¥';">
          </div>
          <div class="product-info">
            <div class="product-title">ä¼‘é—²å¤¹å…‹</div>
            <div class="product-price">Â¥499</div>
            <div class="product-actions">
              <button class="btn-add-cart" data-product="jacket" data-action="add-cart">åŠ å…¥è´­ç‰©è½¦</button>
              <button class="btn-view" data-product="jacket" data-action="view">æŸ¥çœ‹</button>
            </div>
          </div>
        </div>
      </div>
      
      <h2 class="section-title">æ¨èå•†å“</h2>
      <div class="products-grid">
        <div class="product-card" data-product="shirt" data-tracking="product-hover">
          <div class="product-image">
            <img src="products/shirt.jpg" alt="åŸºç¡€Tæ¤" onerror="this.onerror=null; this.style.display='none'; this.parentElement.classList.add('fallback'); this.parentElement.textContent='ğŸ‘”';">
          </div>
          <div class="product-info">
            <div class="product-title">åŸºç¡€Tæ¤</div>
            <div class="product-price">Â¥99</div>
            <div class="product-actions">
              <button class="btn-add-cart" data-product="shirt" data-action="add-cart">åŠ å…¥è´­ç‰©è½¦</button>
              <button class="btn-view" data-product="shirt" data-action="view">æŸ¥çœ‹</button>
            </div>
          </div>
        </div>
        
        <div class="product-card" data-product="shoes" data-tracking="product-hover">
          <div class="product-image">
            <img src="products/shoes.jpg" alt="è¿åŠ¨é‹" onerror="this.onerror=null; this.style.display='none'; this.parentElement.classList.add('fallback'); this.parentElement.textContent='ğŸ‘Ÿ';">
          </div>
          <div class="product-info">
            <div class="product-title">è¿åŠ¨é‹</div>
            <div class="product-price">Â¥599</div>
            <div class="product-actions">
              <button class="btn-add-cart" data-product="shoes" data-action="add-cart">åŠ å…¥è´­ç‰©è½¦</button>
              <button class="btn-view" data-product="shoes" data-action="view">æŸ¥çœ‹</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- å³ä¾§ï¼šæ„å›¾è¯†åˆ«è¾“å‡º -->
  <div class="intent-panel" id="intentPanel">
    <div class="intent-header">
      <h2>å®æ—¶æ„å›¾è¯†åˆ«</h2>
      <div class="subtitle">ç³»ç»Ÿæ­£åœ¨åˆ†ææ‚¨çš„æµè§ˆè¡Œä¸º...</div>
      <div class="intent-status" id="statusIndicator">ç­‰å¾…ç”¨æˆ·è¡Œä¸º</div>
</div>

    <div id="intentOutput">
      <div class="empty-state">
        <div class="empty-state-icon">ğŸ‘†</div>
        <h3>å¼€å§‹æµè§ˆå•†åº—</h3>
        <p>åœ¨å·¦ä¾§å•†åº—ä¸­æ»šåŠ¨é¡µé¢ã€æ‚¬åœæˆ–ç‚¹å‡»å•†å“<br/>ç³»ç»Ÿå°†å®æ—¶åˆ†æå¹¶ç”Ÿæˆæ‚¨çš„è´­ç‰©æ„å›¾</p>
      </div>
    </div>
  </div>
</div>

<div class="guide-tooltip" id="guideTooltip"></div>
<div class="guide-overlay" id="guideOverlay"></div>
<div class="guide-steps" id="guideSteps" style="display: none;">
  <h4>äº¤äº’å¼•å¯¼</h4>
  <div class="guide-step" id="step1">æ»šåŠ¨é¡µé¢</div>
  <div class="guide-step" id="step2">ç‚¹å‡»BanneræŒ‰é’®</div>
  <div class="guide-step" id="step3">æ‚¬åœäº§å“å¡ç‰‡</div>
  <div class="guide-step" id="step4">åŠ å…¥è´­ç‰©è½¦</div>
  <div class="guide-step" id="step5">ç‚¹å‡»åˆ†ç±»æ ‡ç­¾</div>
</div>
<div class="guide-notification" id="guideNotification" style="display: none;">
  <button class="guide-notification-close" onclick="this.parentElement.style.display='none'">Ã—</button>
  <h5>ğŸ¯ å¼€å§‹ä½“éªŒ</h5>
  <p>è·Ÿéšå¼•å¯¼å°è¯•ä¸åŒçš„äº¤äº’ï¼Œç³»ç»Ÿå°†å®æ—¶åˆ†ææ‚¨çš„è´­ç‰©æ„å›¾</p>
</div>

<div class="completion-overlay" id="completionOverlay">
  <div class="completion-modal">
    <div class="completion-icon">ğŸ‰</div>
    <h2 class="completion-title">ä½“éªŒå®Œæˆï¼</h2>
    <p class="completion-message">æ‚¨å·²æˆåŠŸå®Œæˆæ‰€æœ‰äº¤äº’ä½“éªŒ<br/>ç³»ç»Ÿå·²å®Œæ•´åˆ†ææ‚¨çš„è´­ç‰©æ„å›¾å’Œè½¬åŒ–è·¯å¾„</p>
    <div class="completion-stats" id="completionStats">
      <!-- åŠ¨æ€å¡«å…… -->
    </div>
    <button class="completion-button" onclick="closeCompletion()">ç»§ç»­æ¢ç´¢</button>
  </div>
</div>

<script>
// æ„å›¾è¯†åˆ«å¼•æ“
class IntentRecognition {
  constructor() {
    this.behaviors = [];
    this.intentData = {
      core_interests: [],
      product_focus: {},
      purchase_signals: { stage: 'browsing', concerns: null },
      behavior_summary: { engagement: 'low', browsing_path: [] },
      conversion_stage: 'awareness'
    };
    this.productMap = {
      'hoodie': { category: 'Comfortable Apparel', tags: ['Hoodie', 'Cozy', 'Loungewear', 'Athleisure'] },
      'sweater': { category: 'Casual Wear', tags: ['Sweater', 'Warm', 'Comfort'] },
      'pants': { category: 'Athleisure', tags: ['Pants', 'Active', 'Comfort'] },
      'jacket': { category: 'Outerwear', tags: ['Jacket', 'Style', 'Warm'] },
      'shirt': { category: 'Basics', tags: ['T-Shirt', 'Casual', 'Essential'] },
      'shoes': { category: 'Footwear', tags: ['Sneakers', 'Active', 'Comfort'] },
      'F1 Floating Pillow': { category: 'Home & Bedding', tags: ['Pillow', 'Comfort', 'Sleep', 'Premium', 'Floating'] }
    };
  }
  
  recordBehavior(type, data) {
    const behavior = {
      type,
      data,
      timestamp: Date.now()
    };
    this.behaviors.push(behavior);
    this.updateIntent();
    this.displayIntent();
  }
  
  updateIntent() {
    // åˆ†æè¡Œä¸ºæ¨¡å¼
    const scrollEvents = this.behaviors.filter(b => b.type === 'scroll');
    const hoverEvents = this.behaviors.filter(b => b.type === 'hover');
    const clickEvents = this.behaviors.filter(b => b.type === 'click');
    const videoEvents = this.behaviors.filter(b => 
      b.type === 'video-play' || b.type === 'video-pause' || 
      b.type === 'video-watch' || b.type === 'video-hover-end'
    );
    const videoWatchEvents = this.behaviors.filter(b => b.type === 'video-watch');
    
    // æ›´æ–°æ ¸å¿ƒå…´è¶£
    const interestSet = new Set();
    hoverEvents.forEach(event => {
      const product = this.productMap[event.data.product];
      if (product) {
        product.tags.forEach(tag => interestSet.add(tag));
      }
    });
    
    // è§†é¢‘è§‚çœ‹è¡Œä¸ºä¹Ÿåæ˜ å…´è¶£
    videoEvents.forEach(event => {
      const product = this.productMap[event.data.product];
      if (product) {
        product.tags.forEach(tag => interestSet.add(tag));
      }
    });
    
    this.intentData.core_interests = Array.from(interestSet);
    
    // æ›´æ–°äº§å“ä¾§é‡ç‚¹ï¼ˆä¼˜å…ˆè€ƒè™‘è§†é¢‘äº¤äº’çš„äº§å“ï¼‰
    const videoProductEvents = this.behaviors.filter(b => 
      b.data && b.data.product === 'F1 Floating Pillow'
    );
    
    if (videoProductEvents.length > 0) {
      const product = this.productMap['F1 Floating Pillow'];
      if (product) {
        this.intentData.product_focus = {
          category: product.category,
          key_attributes: product.tags,
          price_range: 'premium',
          main_appeal: this.getMainAppeal(product.tags),
          source: 'video-interaction'
        };
      }
    } else if (hoverEvents.length > 0) {
      const lastHover = hoverEvents[hoverEvents.length - 1];
      const product = this.productMap[lastHover.data.product];
      if (product) {
        this.intentData.product_focus = {
          category: product.category,
          key_attributes: product.tags,
          price_range: this.estimatePriceRange(lastHover.data.product),
          main_appeal: this.getMainAppeal(product.tags)
        };
      }
    }
    
    // æ›´æ–°è´­ä¹°ä¿¡å·å’Œè½¬åŒ–é˜¶æ®µ
    const addCartEvents = this.behaviors.filter(b => b.type === 'click' && b.data.action === 'add-cart');
    const viewEvents = this.behaviors.filter(b => b.type === 'click' && b.data.action === 'view');
    const videoProductClick = this.behaviors.filter(b => 
      b.type === 'click' && b.data.product === 'F1 Floating Pillow'
    );
    
    // è½¬åŒ–é˜¶æ®µåˆ¤æ–­ï¼šæµè§ˆ â†’ å…´è¶£ â†’ è€ƒè™‘ â†’ è´­ä¹°
    // è§†é¢‘è§‚çœ‹è¶…è¿‡10ç§’æˆ–ç‚¹å‡»è§†é¢‘äº§å“å¡ç‰‡è¡¨ç¤ºé«˜å…´è¶£
    const hasVideoEngagement = videoWatchEvents.some(e => e.data.watchDuration >= 10) || 
                               videoProductClick.length > 0;
    
    if (addCartEvents.length > 0) {
      this.intentData.purchase_signals.stage = 'purchasing';
      this.intentData.conversion_stage = 'purchase';
    } else if (viewEvents.length > 0 || videoProductClick.length > 0) {
      this.intentData.purchase_signals.stage = 'considering';
      this.intentData.conversion_stage = 'consideration';
    } else if (hasVideoEngagement || hoverEvents.length >= 3) {
      this.intentData.purchase_signals.stage = 'exploring';
      this.intentData.conversion_stage = 'interest';
    } else if (hoverEvents.length > 0 || scrollEvents.length > 2 || videoEvents.length > 0) {
      this.intentData.purchase_signals.stage = 'browsing';
      this.intentData.conversion_stage = 'awareness';
    } else {
      this.intentData.purchase_signals.stage = 'browsing';
      this.intentData.conversion_stage = 'awareness';
    }
    
    // æ›´æ–°è¡Œä¸ºæ‘˜è¦ï¼ˆè§†é¢‘äº¤äº’å¢åŠ å‚ä¸åº¦ï¼‰
    const totalInteractions = scrollEvents.length + hoverEvents.length + clickEvents.length + videoEvents.length;
    this.intentData.behavior_summary.engagement = 
      totalInteractions > 8 || videoWatchEvents.some(e => e.data.watchDuration >= 15) ? 'high' : 
      totalInteractions > 4 || videoEvents.length > 0 ? 'medium' : 'low';
    this.intentData.behavior_summary.browsing_path = this.behaviors
      .filter(b => b.type === 'hover' || b.type === 'click' || b.type === 'video-play' || b.type === 'video-watch')
      .map(b => b.data.product || b.data.element);
  }
  
  estimatePriceRange(product) {
    const prices = { hoodie: 'mid-range', sweater: 'mid-range', pants: 'low-range', 
                     jacket: 'high-range', shirt: 'low-range', shoes: 'high-range' };
    return prices[product] || 'mid-range';
  }
  
  getMainAppeal(tags) {
    if (tags.includes('Cozy') || tags.includes('Comfort')) return 'Comfort & Style';
    if (tags.includes('Active') || tags.includes('Athleisure')) return 'Active Lifestyle';
    return 'Style & Quality';
  }
  
  displayIntent() {
    const output = document.getElementById('intentOutput');
    const statusIndicator = document.getElementById('statusIndicator');
    
    if (this.behaviors.length === 0) {
      output.innerHTML = `
        <div class="empty-state">
          <div class="empty-state-icon">ğŸ‘†</div>
          <h3>å¼€å§‹æµè§ˆå•†åº—</h3>
          <p>åœ¨å·¦ä¾§å•†åº—ä¸­æ»šåŠ¨é¡µé¢ã€æ‚¬åœæˆ–ç‚¹å‡»å•†å“<br/>ç³»ç»Ÿå°†å®æ—¶åˆ†æå¹¶ç”Ÿæˆæ‚¨çš„è´­ç‰©æ„å›¾</p>
        </div>
      `;
      statusIndicator.textContent = 'ç­‰å¾…ç”¨æˆ·è¡Œä¸º';
      return;
    }
    
    statusIndicator.innerHTML = `å·²è®°å½• <span class="animated-number">${this.behaviors.length}</span> ä¸ªè¡Œä¸ºäº‹ä»¶`;
    
    let html = '';
    
    // è½¬åŒ–é“¾è·¯å¯è§†åŒ–
    html += this.renderConversionFunnel();
    
    // è¡Œä¸ºç»Ÿè®¡å›¾è¡¨
    html += this.renderBehaviorChart();
    
    // è§†é¢‘äº¤äº’å±•ç¤ºï¼ˆå¦‚æœæœ‰è§†é¢‘äº¤äº’ï¼‰
    const videoInteractions = this.behaviors.filter(b => 
      b.type === 'video-play' || b.type === 'video-pause' || 
      b.type === 'video-watch' || b.type === 'video-hover-end' ||
      (b.type === 'click' && b.data.element && b.data.element.includes('video'))
    );
    if (videoInteractions.length > 0) {
      html += this.renderVideoInteractions();
    }
    
    // å‚ä¸åº¦ä»ªè¡¨ç›˜
    html += this.renderEngagementGauge();
    
    // æ ¸å¿ƒå…´è¶£ï¼ˆå¸¦å›¾è¡¨ï¼‰
    if (this.intentData.core_interests.length > 0) {
      html += this.renderInterestChart();
      html += `
        <div class="intent-card show">
          <h3>æ ¸å¿ƒå…´è¶£æ ‡ç­¾</h3>
          <div class="intent-tags">
            ${this.intentData.core_interests.map(tag => `<span class="intent-tag">${tag}</span>`).join('')}
          </div>
        </div>
      `;
    }
    
    // è¡Œä¸ºæ—¶é—´çº¿
    if (this.behaviors.length > 0) {
      html += this.renderTimeline();
    }
    
    // äº§å“ä¾§é‡ç‚¹
    if (Object.keys(this.intentData.product_focus).length > 0) {
      const pf = this.intentData.product_focus;
      html += `
        <div class="intent-card show">
          <h3>äº§å“ä¾§é‡ç‚¹</h3>
          <div class="intent-content">
            <strong>ç±»åˆ«ï¼š</strong>${pf.category || 'N/A'}<br/>
            <strong>ä»·æ ¼åŒºé—´ï¼š</strong>${pf.price_range || 'N/A'}<br/>
            <strong>ä¸»è¦å¸å¼•åŠ›ï¼š</strong>${pf.main_appeal || 'N/A'}
          </div>
          ${pf.key_attributes ? `
            <div class="intent-tags">
              ${pf.key_attributes.map(attr => `<span class="intent-tag">${attr}</span>`).join('')}
            </div>
          ` : ''}
        </div>
      `;
    }
    
    // è´­ä¹°ä¿¡å·
    html += `
      <div class="intent-card show">
        <h3>è´­ä¹°ä¿¡å·åˆ†æ</h3>
        <div class="intent-content">
          <strong>å½“å‰é˜¶æ®µï¼š</strong>${this.getStageText(this.intentData.purchase_signals.stage)}<br/>
          <strong>å‚ä¸åº¦ï¼š</strong>${this.intentData.behavior_summary.engagement === 'high' ? 'é«˜' : 
                                      this.intentData.behavior_summary.engagement === 'medium' ? 'ä¸­' : 'ä½'}
        </div>
      </div>
    `;
    
    // è¡Œä¸ºæ‘˜è¦
    if (this.intentData.behavior_summary.browsing_path.length > 0) {
      html += `
        <div class="intent-card show">
          <h3>æµè§ˆè·¯å¾„</h3>
          <div class="intent-content">
            ${this.intentData.behavior_summary.browsing_path.join(' â†’ ')}
          </div>
        </div>
      `;
    }
    
    // å®Œæ•´JSONæ•°æ®
    html += `
      <div class="intent-card show">
        <h3>å®Œæ•´æ„å›¾æ•°æ® (JSON)</h3>
        <div class="intent-json">${JSON.stringify(this.intentData, null, 2)}</div>
      </div>
    `;
    
    output.innerHTML = html;
    
    // æ»šåŠ¨åˆ°åº•éƒ¨
    document.getElementById('intentPanel').scrollTo({
      top: document.getElementById('intentPanel').scrollHeight,
      behavior: 'smooth'
    });
  }
  
  getStageText(stage) {
    const stages = {
      'browsing': 'æµè§ˆé˜¶æ®µ',
      'exploring': 'æ¢ç´¢é˜¶æ®µ',
      'considering': 'è€ƒè™‘é˜¶æ®µ',
      'purchasing': 'è´­ä¹°é˜¶æ®µ',
      'deciding': 'å†³ç­–é˜¶æ®µ'
    };
    return stages[stage] || stage;
  }
  
  renderConversionFunnel() {
    const stages = ['awareness', 'interest', 'consideration', 'purchase'];
    const stageLabels = {
      'awareness': 'è®¤çŸ¥',
      'interest': 'å…´è¶£',
      'consideration': 'è€ƒè™‘',
      'purchase': 'è´­ä¹°'
    };
    
    const currentStage = this.intentData.conversion_stage || 'awareness';
    const currentIndex = stages.indexOf(currentStage);
    const progress = ((currentIndex + 1) / stages.length) * 100;
    
    let html = `
      <div class="conversion-funnel">
        <h3>ğŸ”„ è½¬åŒ–é“¾è·¯</h3>
        <div class="funnel-steps">
    `;
    
    stages.forEach((stage, index) => {
      const isActive = stage === currentStage;
      const isCompleted = index < currentIndex;
      const classes = isActive ? 'active' : isCompleted ? 'completed' : '';
      
      html += `
        <div class="funnel-step ${classes}">
          <div class="funnel-step-circle">${index + 1}</div>
          <div class="funnel-step-label">${stageLabels[stage]}</div>
        </div>
      `;
    });
    
    html += `
        </div>
        <div class="funnel-progress">
          <div class="funnel-progress-bar" style="width: ${progress}%"></div>
        </div>
      </div>
    `;
    
    return html;
  }
  
  renderBehaviorChart() {
    const scrollCount = this.behaviors.filter(b => b.type === 'scroll').length;
    const hoverCount = this.behaviors.filter(b => b.type === 'hover').length;
    const clickCount = this.behaviors.filter(b => b.type === 'click').length;
    const viewCount = this.behaviors.filter(b => b.type === 'view').length;
    const videoCount = this.behaviors.filter(b => 
      b.type === 'video-play' || b.type === 'video-pause' || 
      b.type === 'video-watch' || b.type === 'video-hover-end'
    ).length;
    
    const maxCount = Math.max(scrollCount, hoverCount, clickCount, viewCount, videoCount, 1);
    
    const scrollHeight = (scrollCount / maxCount) * 100;
    const hoverHeight = (hoverCount / maxCount) * 100;
    const clickHeight = (clickCount / maxCount) * 100;
    const viewHeight = (viewCount / maxCount) * 100;
    const videoHeight = (videoCount / maxCount) * 100;
    
    return `
      <div class="intent-card show">
        <h3>ğŸ“Š è¡Œä¸ºç»Ÿè®¡</h3>
        <div class="chart-container">
          <div class="bar-chart">
            <div class="bar-item">
              <div class="bar" style="height: ${scrollHeight}%"></div>
              <div class="bar-label">æ»šåŠ¨</div>
              <div class="bar-value"><span class="animated-number">${scrollCount}</span></div>
            </div>
            <div class="bar-item">
              <div class="bar" style="height: ${hoverHeight}%"></div>
              <div class="bar-label">æ‚¬åœ</div>
              <div class="bar-value"><span class="animated-number">${hoverCount}</span></div>
            </div>
            <div class="bar-item">
              <div class="bar" style="height: ${clickHeight}%"></div>
              <div class="bar-label">ç‚¹å‡»</div>
              <div class="bar-value"><span class="animated-number">${clickCount}</span></div>
            </div>
            <div class="bar-item">
              <div class="bar" style="height: ${viewHeight}%"></div>
              <div class="bar-label">æŸ¥çœ‹</div>
              <div class="bar-value"><span class="animated-number">${viewCount}</span></div>
            </div>
            <div class="bar-item">
              <div class="bar" style="height: ${videoHeight}%"></div>
              <div class="bar-label">è§†é¢‘</div>
              <div class="bar-value"><span class="animated-number">${videoCount}</span></div>
            </div>
          </div>
        </div>
      </div>
    `;
  }
  
  renderEngagementGauge() {
    const engagement = this.intentData.behavior_summary.engagement;
    let engagementValue = 0;
    let engagementLabel = 'ä½';
    
    if (engagement === 'high') {
      engagementValue = 85;
      engagementLabel = 'é«˜';
    } else if (engagement === 'medium') {
      engagementValue = 50;
      engagementLabel = 'ä¸­';
    } else {
      engagementValue = 20;
      engagementLabel = 'ä½';
    }
    
    // è®¡ç®—åœ†å¼§çš„ stroke-dasharray
    const circumference = Math.PI * 100; // åŠå¾„100çš„åŠåœ†
    const offset = circumference - (engagementValue / 100) * circumference;
    
    return `
      <div class="intent-card show">
        <h3>âš¡ å‚ä¸åº¦åˆ†æ</h3>
        <div class="chart-container">
          <div class="gauge-container">
            <svg class="gauge-svg" viewBox="0 0 200 100">
              <path d="M 20 100 A 80 80 0 0 1 180 100" 
                    fill="none" 
                    stroke="var(--border)" 
                    stroke-width="12"/>
              <path class="gauge-arc" 
                    d="M 20 100 A 80 80 0 0 1 180 100" 
                    fill="none" 
                    stroke="url(#gaugeGradient)" 
                    stroke-width="12"
                    stroke-dasharray="${circumference}"
                    stroke-dashoffset="${offset}"/>
              <defs>
                <linearGradient id="gaugeGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                  <stop offset="0%" style="stop-color:var(--primary);stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#7da6ff;stop-opacity:1" />
                </linearGradient>
              </defs>
            </svg>
            <div class="gauge-value"><span class="animated-number">${engagementValue}</span>%</div>
            <div class="gauge-label">å‚ä¸åº¦: ${engagementLabel}</div>
          </div>
        </div>
      </div>
    `;
  }
  
  renderInterestChart() {
    const interests = this.intentData.core_interests;
    if (interests.length === 0) return '';
    
    // ä¸ºæ¯ä¸ªå…´è¶£åˆ†é…ä¸€ä¸ªå€¼ï¼ˆæ¨¡æ‹Ÿæƒé‡ï¼‰
    const interestData = interests.map((interest, index) => ({
      label: interest,
      value: 100 - (index * 15) // é€’å‡çš„å€¼
    }));
    
    const total = interestData.reduce((sum, item) => sum + item.value, 0);
    let currentAngle = 0;
    
    let segments = '';
    const colors = ['#00ff88', '#7da6ff', '#00cc6f', '#6b95ff', '#00aa5a'];
    
    interestData.forEach((item, index) => {
      const percentage = (item.value / total) * 100;
      const angle = (percentage / 100) * 360;
      const largeArc = angle > 180 ? 1 : 0;
      
      const x1 = 80 + 80 * Math.cos((currentAngle * Math.PI) / 180);
      const y1 = 80 + 80 * Math.sin((currentAngle * Math.PI) / 180);
      const x2 = 80 + 80 * Math.cos(((currentAngle + angle) * Math.PI) / 180);
      const y2 = 80 + 80 * Math.sin(((currentAngle + angle) * Math.PI) / 180);
      
      segments += `
        <path class="pie-segment"
              d="M 80 80 L ${x1} ${y1} A 80 80 0 ${largeArc} 1 ${x2} ${y2} Z"
              fill="${colors[index % colors.length]}"
              opacity="0.8"/>
      `;
      
      currentAngle += angle;
    });
    
    return `
      <div class="intent-card show">
        <h3>ğŸ¯ å…´è¶£åˆ†å¸ƒ</h3>
        <div class="chart-container">
          <div class="pie-chart">
            <svg class="pie-svg" viewBox="0 0 160 160">
              ${segments}
            </svg>
            <div class="pie-center">
              <div class="pie-center-value"><span class="animated-number">${interests.length}</span></div>
              <div class="pie-center-label">å…´è¶£æ ‡ç­¾</div>
            </div>
          </div>
          <div style="margin-top: 16px; display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;">
            ${interestData.map((item, index) => `
              <div style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                <div style="width: 12px; height: 12px; border-radius: 2px; background: ${colors[index % colors.length]}"></div>
                <span style="color: var(--text-secondary);">${item.label}</span>
              </div>
            `).join('')}
          </div>
        </div>
      </div>
    `;
  }
  
  renderVideoInteractions() {
    const videoPlayEvents = this.behaviors.filter(b => b.type === 'video-play');
    const videoPauseEvents = this.behaviors.filter(b => b.type === 'video-pause');
    const videoWatchEvents = this.behaviors.filter(b => b.type === 'video-watch');
    const videoHoverEvents = this.behaviors.filter(b => b.type === 'video-hover-end');
    const videoControlEvents = this.behaviors.filter(b => 
      b.type === 'click' && b.data.element === 'video-control'
    );
    const videoClickEvents = this.behaviors.filter(b => 
      b.type === 'click' && b.data.element === 'product-video'
    );
    const productCardClicks = this.behaviors.filter(b => 
      b.type === 'click' && b.data.element === 'video-product-card'
    );
    
    // è®¡ç®—æ€»è§‚çœ‹æ—¶é•¿
    let totalWatchDuration = 0;
    videoWatchEvents.forEach(e => {
      if (e.data.watchDuration) {
        totalWatchDuration = Math.max(totalWatchDuration, e.data.watchDuration);
      }
    });
    videoPauseEvents.forEach(e => {
      if (e.data.watchDuration) {
        totalWatchDuration = Math.max(totalWatchDuration, e.data.watchDuration);
      }
    });
    
    const formatDuration = (seconds) => {
      if (seconds < 60) return `${seconds}ç§’`;
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return secs > 0 ? `${mins}åˆ†${secs}ç§’` : `${mins}åˆ†é’Ÿ`;
    };
    
    // è·å–æœ€è¿‘5ä¸ªè§†é¢‘äº¤äº’äº‹ä»¶
    const recentVideoBehaviors = this.behaviors
      .filter(b => 
        b.type === 'video-play' || b.type === 'video-pause' || 
        b.type === 'video-watch' || b.type === 'video-hover-end' ||
        (b.type === 'click' && (b.data.element === 'video-control' || 
                                b.data.element === 'product-video' || 
                                b.data.element === 'video-product-card'))
      )
      .slice(-8)
      .reverse();
    
    const actionLabels = {
      'video-play': 'æ’­æ”¾è§†é¢‘',
      'video-pause': 'æš‚åœè§†é¢‘',
      'video-watch': 'è§‚çœ‹è§†é¢‘',
      'video-hover-end': 'æ‚¬åœè§†é¢‘',
      'click': (data) => {
        if (data.element === 'video-control') {
          const actionMap = {
            'zoom-in': 'æ”¾å¤§è§†é¢‘',
            'zoom-out': 'ç¼©å°è§†é¢‘',
            'zoom-reset': 'é‡ç½®å¤§å°',
            'mute': 'é™éŸ³',
            'unmute': 'å–æ¶ˆé™éŸ³',
            'fullscreen': 'å…¨å±'
          };
          return actionMap[data.action] || 'æ§åˆ¶è§†é¢‘';
        } else if (data.element === 'product-video') {
          return 'ç‚¹å‡»è§†é¢‘';
        } else if (data.element === 'video-product-card') {
          return 'æŸ¥çœ‹äº§å“è¯¦æƒ…';
        }
        return 'ç‚¹å‡»æ“ä½œ';
      }
    };
    
    return `
      <div class="intent-card show">
        <h3>ğŸ¬ è§†é¢‘äº¤äº’åˆ†æ</h3>
        <div class="chart-container">
          <!-- è§†é¢‘äº¤äº’ç»Ÿè®¡ -->
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 16px;">
            <div style="background: rgba(125, 166, 255, 0.1); border-radius: 8px; padding: 12px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #7da6ff; margin-bottom: 4px;">
                <span class="animated-number">${videoPlayEvents.length}</span>
              </div>
              <div style="font-size: 12px; color: var(--text-secondary);">æ’­æ”¾æ¬¡æ•°</div>
            </div>
            <div style="background: rgba(0, 255, 136, 0.1); border-radius: 8px; padding: 12px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #00ff88; margin-bottom: 4px;">
                ${formatDuration(totalWatchDuration)}
              </div>
              <div style="font-size: 12px; color: var(--text-secondary);">è§‚çœ‹æ—¶é•¿</div>
            </div>
            <div style="background: rgba(255, 68, 68, 0.1); border-radius: 8px; padding: 12px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #ff4444; margin-bottom: 4px;">
                <span class="animated-number">${videoControlEvents.length}</span>
              </div>
              <div style="font-size: 12px; color: var(--text-secondary);">æ§åˆ¶æ“ä½œ</div>
            </div>
            <div style="background: rgba(255, 193, 7, 0.1); border-radius: 8px; padding: 12px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #ffc107; margin-bottom: 4px;">
                <span class="animated-number">${productCardClicks.length}</span>
              </div>
              <div style="font-size: 12px; color: var(--text-secondary);">æŸ¥çœ‹è¯¦æƒ…</div>
            </div>
          </div>
          
          <!-- è§†é¢‘äº¤äº’æ—¶é—´çº¿ -->
          ${recentVideoBehaviors.length > 0 ? `
            <div style="margin-top: 16px;">
              <div style="font-size: 13px; font-weight: 600; color: var(--text-primary); margin-bottom: 12px;">
                æœ€è¿‘äº¤äº’è®°å½•
              </div>
              <div class="timeline-chart" style="max-height: 200px; overflow-y: auto;">
                <div class="timeline-line"></div>
                ${recentVideoBehaviors.map((behavior, index) => {
                  const time = new Date(behavior.timestamp);
                  const timeStr = time.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                  let label = actionLabels[behavior.type];
                  if (typeof label === 'function') {
                    label = label(behavior.data);
                  } else if (!label) {
                    label = behavior.type;
                  }
                  
                  // å¦‚æœæ˜¯è§‚çœ‹äº‹ä»¶ï¼Œæ˜¾ç¤ºè§‚çœ‹æ—¶é•¿
                  let extraInfo = '';
                  if (behavior.type === 'video-watch' && behavior.data.watchDuration) {
                    extraInfo = ` (${formatDuration(behavior.data.watchDuration)})`;
                  } else if (behavior.type === 'video-hover-end' && behavior.data.hoverDuration) {
                    extraInfo = ` (${behavior.data.hoverDuration}ç§’)`;
                  }
                  
                  return `
                    <div class="timeline-item" style="animation-delay: ${index * 0.1}s">
                      <div class="timeline-dot" style="background: #7da6ff;"></div>
                      <div class="timeline-content">
                        <div class="timeline-time">${timeStr}</div>
                        <div class="timeline-text">${label}${extraInfo}</div>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>
          ` : ''}
          
          <!-- äº§å“ä¿¡æ¯ -->
          <div style="margin-top: 16px; padding: 12px; background: rgba(125, 166, 255, 0.05); border-radius: 8px; border-left: 3px solid #7da6ff;">
            <div style="font-size: 13px; font-weight: 600; color: var(--text-primary); margin-bottom: 6px;">
              F1 Floating Pillow
            </div>
            <div style="font-size: 12px; color: var(--text-secondary);">
              ä»·æ ¼: <span style="color: #ff4444; font-weight: 600;">USD 139.0</span>
              <span style="text-decoration: line-through; color: #999; margin-left: 8px;">USD 169.0</span>
            </div>
          </div>
        </div>
      </div>
    `;
  }
  
  renderTimeline() {
    const recentBehaviors = this.behaviors.slice(-5).reverse();
    if (recentBehaviors.length === 0) return '';
    
    const behaviorLabels = {
      'scroll': 'æ»šåŠ¨é¡µé¢',
      'hover': 'æ‚¬åœå•†å“',
      'click': 'ç‚¹å‡»æ“ä½œ',
      'view': 'æŸ¥çœ‹å†…å®¹'
    };
    
    return `
      <div class="intent-card show">
        <h3>â±ï¸ è¡Œä¸ºæ—¶é—´çº¿</h3>
        <div class="chart-container">
          <div class="timeline-chart">
            <div class="timeline-line"></div>
            ${recentBehaviors.map((behavior, index) => {
              const time = new Date(behavior.timestamp);
              const timeStr = time.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
              const label = behaviorLabels[behavior.type] || behavior.type;
              
              return `
                <div class="timeline-item" style="animation-delay: ${index * 0.1}s">
                  <div class="timeline-dot"></div>
                  <div class="timeline-content">
                    <div class="timeline-time">${timeStr}</div>
                    <div class="timeline-text">${label}</div>
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        </div>
      </div>
    `;
  }
}

// åˆå§‹åŒ–
const intentEngine = new IntentRecognition();
let scrollTimeout;
let lastScrollTop = 0;

// ç›‘å¬æ»šåŠ¨
const shopPanel = document.getElementById('shopPanel');
shopPanel.addEventListener('scroll', () => {
  clearTimeout(scrollTimeout);
  scrollTimeout = setTimeout(() => {
    const scrollTop = shopPanel.scrollTop;
    if (Math.abs(scrollTop - lastScrollTop) > 100) {
      intentEngine.recordBehavior('scroll', {
        position: scrollTop,
        direction: scrollTop > lastScrollTop ? 'down' : 'up'
      });
      lastScrollTop = scrollTop;
    }
  }, 300);
});

// ç›‘å¬äº§å“æ‚¬åœ
document.querySelectorAll('[data-tracking="product-hover"]').forEach(card => {
  card.addEventListener('mouseenter', () => {
    const product = card.getAttribute('data-product');
    intentEngine.recordBehavior('hover', { product, element: 'product-card' });
    
    // æ˜¾ç¤ºå¼•å¯¼æç¤º
    showTooltip(card, 'æ­£åœ¨åˆ†ææ‚¨çš„å…´è¶£...');
  });
  
  card.addEventListener('click', () => {
    const product = card.getAttribute('data-product');
    intentEngine.recordBehavior('click', { product, element: 'product-card' });
    
    showTooltip(card, 'å·²è®°å½•ç‚¹å‡»è¡Œä¸º');
  });
});

// ç›‘å¬BanneræŸ¥çœ‹
const banner = document.querySelector('[data-tracking="banner-view"]');
let bannerViewed = false;
shopPanel.addEventListener('scroll', () => {
  const bannerRect = banner.getBoundingClientRect();
  if (bannerRect.top < window.innerHeight && bannerRect.bottom > 0 && !bannerViewed) {
    intentEngine.recordBehavior('view', { element: 'hero-banner', content: 'ç§‹å­£æ–°å“' });
    bannerViewed = true;
  }
}, { passive: true });

// ç›‘å¬BanneræŒ‰é’®ç‚¹å‡»
const bannerBtn = document.querySelector('[data-tracking="banner-click"]');
if (bannerBtn) {
  bannerBtn.addEventListener('click', () => {
    intentEngine.recordBehavior('click', { element: 'banner-button', action: 'explore' });
  });
}

// ç›‘å¬äº§å“Banneræ‚¬åœ
document.querySelectorAll('[data-tracking="banner-hover"]').forEach(bannerCard => {
  bannerCard.addEventListener('mouseenter', () => {
    const title = bannerCard.querySelector('h3')?.textContent || 'äº§å“ç³»åˆ—';
    intentEngine.recordBehavior('hover', { element: 'product-banner', content: title });
    showTooltip(bannerCard, 'æ­£åœ¨åˆ†ææ‚¨çš„å…´è¶£...');
  });
  
  bannerCard.addEventListener('click', () => {
    const title = bannerCard.querySelector('h3')?.textContent || 'äº§å“ç³»åˆ—';
    intentEngine.recordBehavior('click', { element: 'product-banner', content: title });
    showTooltip(bannerCard, 'å·²è®°å½•ç‚¹å‡»è¡Œä¸º');
  });
});

// ç›‘å¬åˆ†ç±»æ ‡ç­¾ç‚¹å‡»
document.querySelectorAll('.category-tag').forEach(tag => {
  tag.addEventListener('click', () => {
    // åˆ‡æ¢æ¿€æ´»çŠ¶æ€
    document.querySelectorAll('.category-tag').forEach(t => t.classList.remove('active'));
    tag.classList.add('active');
    
    const category = tag.textContent.trim();
    intentEngine.recordBehavior('click', { element: 'category-filter', category });
  });
});

// ç›‘å¬è´­ç‰©è½¦æŒ‰é’®ç‚¹å‡»
document.querySelectorAll('.btn-add-cart').forEach(btn => {
  btn.addEventListener('click', (e) => {
    e.stopPropagation();
    const product = btn.getAttribute('data-product');
    intentEngine.recordBehavior('click', { product, action: 'add-cart', element: 'add-to-cart-button' });
    
    // è§†è§‰åé¦ˆ
    btn.textContent = 'âœ“ å·²åŠ å…¥';
    btn.style.background = '#7da6ff';
    setTimeout(() => {
      btn.textContent = 'åŠ å…¥è´­ç‰©è½¦';
      btn.style.background = '';
    }, 2000);
    
    showTooltip(btn, 'å·²åŠ å…¥è´­ç‰©è½¦ï¼è½¬åŒ–é˜¶æ®µæå‡');
  });
});

// ç›‘å¬æŸ¥çœ‹æŒ‰é’®ç‚¹å‡»
document.querySelectorAll('.btn-view').forEach(btn => {
  btn.addEventListener('click', (e) => {
    e.stopPropagation();
    const product = btn.getAttribute('data-product');
    intentEngine.recordBehavior('click', { product, action: 'view', element: 'view-button' });
    
    showTooltip(btn, 'æŸ¥çœ‹å•†å“è¯¦æƒ…');
  });
});

// æ˜¾ç¤ºå¼•å¯¼æç¤º
function showTooltip(element, text) {
  const tooltip = document.getElementById('guideTooltip');
  const rect = element.getBoundingClientRect();
  tooltip.textContent = text;
  tooltip.style.left = rect.left + rect.width / 2 + 'px';
  tooltip.style.top = rect.top - 50 + 'px';
  tooltip.classList.add('show');
  
  setTimeout(() => {
    tooltip.classList.remove('show');
  }, 2000);
}

// åˆå§‹æ˜¾ç¤º
intentEngine.displayIntent();

// é¡µé¢åŠ è½½åŠ¨ç”»
window.addEventListener('load', () => {
  setTimeout(() => {
    const loading = document.getElementById('pageLoading');
    if (loading) {
      loading.classList.add('hide');
      setTimeout(() => {
        loading.style.display = 'none';
      }, 1000);
    }
    
    // æ¨¡æ‹Ÿç½‘é¡µåŠ è½½å®Œæˆåæ˜¾ç¤ºè§†é¢‘æ’­æ”¾å™¨
    setTimeout(() => {
      const videoWidget = document.getElementById('videoPlayerWidget');
      if (videoWidget) {
        videoWidget.classList.add('loaded');
      }
    }, 2500); // åœ¨é¡µé¢åŠ è½½åŠ¨ç”»å®Œæˆåæ˜¾ç¤º
  }, 2000);
  
  // ç¡®ä¿æ‰€æœ‰äº§å“å¡ç‰‡åœ¨åŠ¨ç”»å®Œæˆåå¯è§
  const productCards = document.querySelectorAll('.product-card');
  productCards.forEach((card, index) => {
    const delay = 1200 + (index * 200); // å¯¹åº”CSSåŠ¨ç”»å»¶è¿Ÿ
    const animationDuration = 800; // åŠ¨ç”»æ—¶é•¿
    
    // ç›‘å¬åŠ¨ç”»ç»“æŸ
    const handleAnimationEnd = () => {
      card.style.opacity = '1';
      card.style.visibility = 'visible';
      card.style.transform = 'translateY(0) scale(1)';
      card.classList.add('animation-complete');
    };
    
    card.addEventListener('animationend', handleAnimationEnd, { once: true });
    card.addEventListener('webkitAnimationEnd', handleAnimationEnd, { once: true });
    
    // å¤‡ç”¨æ–¹æ¡ˆï¼šå¦‚æœåŠ¨ç”»äº‹ä»¶æœªè§¦å‘ï¼Œåœ¨å»¶è¿Ÿåå¼ºåˆ¶æ˜¾ç¤º
    setTimeout(() => {
      if (!card.classList.contains('animation-complete')) {
        card.style.opacity = '1';
        card.style.visibility = 'visible';
        card.style.transform = 'translateY(0) scale(1)';
        card.classList.add('animation-complete');
      }
    }, delay + animationDuration + 200);
  });
});

// å¼•å¯¼ç³»ç»Ÿ
class GuideSystem {
  constructor() {
    this.currentStep = 0;
    this.steps = [
      { 
        id: 'step1', 
        element: null, 
        hint: 'å°è¯•å‘ä¸‹æ»šåŠ¨é¡µé¢',
        action: 'scroll',
        completed: false 
      },
      { 
        id: 'step2', 
        element: '.shop-banner-btn', 
        hint: 'ç‚¹å‡»"ç«‹å³æ¢ç´¢"æŒ‰é’®',
        action: 'click',
        completed: false 
      },
      { 
        id: 'step3', 
        element: '[data-tracking="product-hover"]', 
        hint: 'æ‚¬åœä»»æ„å•†å“å¡ç‰‡æŸ¥çœ‹è¯¦æƒ…',
        action: 'hover',
        completed: false 
      },
      { 
        id: 'step4', 
        element: '.btn-add-cart', 
        hint: 'ç‚¹å‡»"åŠ å…¥è´­ç‰©è½¦"æŒ‰é’®ï¼Œæå‡è½¬åŒ–é˜¶æ®µ',
        action: 'click',
        completed: false 
      },
      { 
        id: 'step5', 
        element: '.category-tag', 
        hint: 'ç‚¹å‡»åˆ†ç±»æ ‡ç­¾ç­›é€‰å•†å“',
        action: 'click',
        completed: false 
      }
    ];
    this.guideActive = false;
    this.startDelay = 6000; // 6ç§’åå¼€å§‹å¼•å¯¼ï¼Œç»™ç”¨æˆ·è¶³å¤Ÿæ—¶é—´ç†Ÿæ‚‰é¡µé¢
  }
  
  init() {
    setTimeout(() => {
      this.startGuide();
    }, this.startDelay);
  }
  
  startGuide() {
    this.guideActive = true;
    
    // æ˜¾ç¤ºåˆå§‹é€šçŸ¥ï¼ˆå»¶è¿Ÿæ›´ä¹…ï¼Œè®©ç”¨æˆ·å…ˆæµè§ˆï¼‰
    const notification = document.getElementById('guideNotification');
    if (notification) {
      setTimeout(() => {
        notification.style.display = 'block';
        setTimeout(() => {
          notification.style.opacity = '0';
          setTimeout(() => {
            notification.style.display = 'none';
          }, 500);
        }, 6000); // æ˜¾ç¤º6ç§’
      }, 1000);
    }
    
    // æ˜¾ç¤ºæ­¥éª¤æŒ‡ç¤ºå™¨ï¼ˆå»¶è¿Ÿæ˜¾ç¤ºï¼‰
    const stepsEl = document.getElementById('guideSteps');
    if (stepsEl) {
      setTimeout(() => {
        stepsEl.style.display = 'block';
        stepsEl.style.animation = 'slide-in-right 0.8s ease-out';
      }, 2000);
    }
    
    // å»¶è¿Ÿå¼€å§‹ç¬¬ä¸€æ­¥å¼•å¯¼ï¼Œç»™ç”¨æˆ·æ›´å¤šæ—¶é—´
    setTimeout(() => {
      this.showStep(0);
    }, 3000);
  }
  
  showStep(stepIndex) {
    if (stepIndex >= this.steps.length) {
      this.completeGuide();
      return;
    }
    
    this.currentStep = stepIndex;
    const step = this.steps[stepIndex];
    
    // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
    this.steps.forEach((s, i) => {
      const stepEl = document.getElementById(s.id);
      if (stepEl) {
        stepEl.classList.remove('active', 'completed');
        if (i < stepIndex) {
          stepEl.classList.add('completed');
        } else if (i === stepIndex) {
          stepEl.classList.add('active');
        }
      }
    });
    
    // å¦‚æœæ˜¯æ»šåŠ¨æ­¥éª¤ï¼Œä¸éœ€è¦é«˜äº®å…ƒç´ 
    if (step.action === 'scroll') {
      this.showScrollHint();
      return;
    }
    
    // æŸ¥æ‰¾ç›®æ ‡å…ƒç´ 
    let targetElement = null;
    let highlightElement = null; // ç”¨äºé«˜äº®çš„å…ƒç´ ï¼ˆå¯èƒ½æ˜¯çˆ¶å®¹å™¨ï¼‰
    
    if (step.element === '.btn-add-cart') {
      // å¯¹äºè´­ç‰©è½¦æŒ‰é’®ï¼Œæ‰¾åˆ°ç¬¬äºŒä¸ªå•†å“çš„æŒ‰é’®ï¼ˆé¿å…å’Œæ‚¬åœæ­¥éª¤é‡å¤ï¼‰
      const buttons = document.querySelectorAll(step.element);
      if (buttons.length > 0) {
        // è·³è¿‡ç¬¬ä¸€ä¸ªæŒ‰é’®ï¼Œé€‰æ‹©ç¬¬äºŒä¸ªæˆ–ç¬¬ä¸‰ä¸ª
        const targetIndex = buttons.length > 1 ? 1 : 0; // å¦‚æœæœ‰å¤šä¸ªæŒ‰é’®ï¼Œé€‰æ‹©ç¬¬äºŒä¸ª
        targetElement = buttons[targetIndex];
        highlightElement = targetElement.closest('.product-card'); // é«˜äº®æ•´ä¸ªå¡ç‰‡
        
        // å¦‚æœç¬¬äºŒä¸ªä¸åœ¨è§†å£ä¸­ï¼Œå°è¯•ç¬¬ä¸‰ä¸ª
        if (targetElement) {
          const rect = targetElement.getBoundingClientRect();
          if (rect.top >= window.innerHeight || rect.bottom <= 0) {
            // å¦‚æœç¬¬äºŒä¸ªä¸åœ¨è§†å£ï¼Œå°è¯•ç¬¬ä¸‰ä¸ª
            if (buttons.length > 2) {
              targetElement = buttons[2];
              highlightElement = targetElement.closest('.product-card');
            }
          }
        }
      }
    } else if (step.element === '[data-tracking="product-hover"]') {
      // å¯¹äºæ‚¬åœå•†å“å¡ç‰‡ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ªå•†å“å¡ç‰‡
      const cards = document.querySelectorAll(step.element);
      if (cards.length > 0) {
        targetElement = cards[0];
        highlightElement = cards[0];
      }
    } else if (step.element === '.category-tag') {
      // å¯¹äºåˆ†ç±»æ ‡ç­¾ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªéæ¿€æ´»çš„æ ‡ç­¾
      const tags = document.querySelectorAll(step.element);
      for (let tag of tags) {
        if (!tag.classList.contains('active')) {
          targetElement = tag;
          highlightElement = tag;
          break;
        }
      }
      if (!targetElement && tags.length > 0) {
        targetElement = tags[0];
        highlightElement = tags[0];
      }
    } else {
      // å…¶ä»–æƒ…å†µï¼Œä½¿ç”¨é»˜è®¤é€»è¾‘
      const elements = document.querySelectorAll(step.element);
      if (elements.length > 0) {
        targetElement = elements[0];
        highlightElement = elements[0];
      }
    }
    
    if (!targetElement) {
      this.completeStep();
      return;
    }
    
    // é«˜äº®å…ƒç´ å¹¶æ˜¾ç¤ºç®­å¤´
    this.highlightElement(targetElement, highlightElement || targetElement, step.hint);
    
    // ç›‘å¬å®Œæˆäº‹ä»¶
    this.setupStepListener(step, targetElement);
  }
  
  highlightElement(targetElement, highlightElement, hint) {
    // ç§»é™¤ä¹‹å‰çš„é«˜äº®
    document.querySelectorAll('.guide-highlight').forEach(el => {
      el.classList.remove('guide-highlight');
    });
    document.querySelectorAll('.guide-arrow').forEach(el => el.remove());
    document.querySelectorAll('.guide-hint').forEach(el => el.remove());
    
    // æ·»åŠ é«˜äº®åˆ°å®¹å™¨å…ƒç´ ï¼ˆå¦‚æœæœ‰ï¼‰
    if (highlightElement && highlightElement !== targetElement) {
      highlightElement.classList.add('guide-highlight');
    } else {
      targetElement.classList.add('guide-highlight');
    }
    
    // ç­‰å¾…æ»šåŠ¨å®Œæˆåå†å®šä½ç®­å¤´
    setTimeout(() => {
      // è·å–ç›®æ ‡å…ƒç´ çš„å®é™…ä½ç½®ï¼ˆè€ƒè™‘æ»šåŠ¨ï¼‰
      const rect = targetElement.getBoundingClientRect();
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;
      
      // è®¡ç®—å…ƒç´ ä¸­å¿ƒç‚¹
      const centerX = rect.left + scrollLeft + rect.width / 2;
      const centerY = rect.top + scrollTop;
      
      // æ·»åŠ ç®­å¤´ï¼ŒæŒ‡å‘å…ƒç´ ä¸Šæ–¹
      const arrow = document.createElement('div');
      arrow.className = 'guide-arrow';
      arrow.style.position = 'absolute';
      arrow.style.left = centerX - 16 + 'px';
      arrow.style.top = (centerY - 50) + 'px';
      arrow.style.transform = 'translateX(-50%)';
      arrow.innerHTML = `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 5v14M5 12l7-7 7 7"/>
        </svg>
      `;
      document.body.appendChild(arrow);
      
      // æ·»åŠ æç¤ºæ–‡å­—
      const hintEl = document.createElement('div');
      hintEl.className = 'guide-hint';
      hintEl.textContent = hint;
      hintEl.style.position = 'absolute';
      hintEl.style.left = centerX + 'px';
      hintEl.style.top = (centerY - 80) + 'px';
      hintEl.style.transform = 'translateX(-50%)';
      document.body.appendChild(hintEl);
      
      // ç›‘å¬æ»šåŠ¨ï¼Œæ›´æ–°ç®­å¤´ä½ç½®
      const updatePosition = () => {
        const newRect = targetElement.getBoundingClientRect();
        const newScrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const newScrollLeft = window.pageXOffset || document.documentElement.scrollLeft;
        const newCenterX = newRect.left + newScrollLeft + newRect.width / 2;
        const newCenterY = newRect.top + newScrollTop;
        
        arrow.style.left = newCenterX - 16 + 'px';
        arrow.style.top = (newCenterY - 50) + 'px';
        hintEl.style.left = newCenterX + 'px';
        hintEl.style.top = (newCenterY - 80) + 'px';
      };
      
      // åªåœ¨å¼•å¯¼æ¿€æ´»æ—¶ç›‘å¬æ»šåŠ¨
      if (this.guideActive) {
        window.addEventListener('scroll', updatePosition, { passive: true });
        // å­˜å‚¨æ¸…ç†å‡½æ•°
        arrow._cleanup = () => {
          window.removeEventListener('scroll', updatePosition);
        };
      }
    }, 500); // ç­‰å¾…æ»šåŠ¨åŠ¨ç”»å®Œæˆ
    
    // æ»šåŠ¨åˆ°å…ƒç´ ä½ç½®
    targetElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }
  
  showScrollHint() {
    const hintEl = document.createElement('div');
    hintEl.className = 'guide-hint';
    hintEl.textContent = this.steps[this.currentStep].hint;
    hintEl.style.left = '50%';
    hintEl.style.top = '200px';
    hintEl.style.transform = 'translateX(-50%)';
    document.body.appendChild(hintEl);
    
    // å»¶é•¿æç¤ºæ˜¾ç¤ºæ—¶é—´ï¼Œè®©ç”¨æˆ·æœ‰è¶³å¤Ÿæ—¶é—´ç†è§£
    setTimeout(() => {
      hintEl.style.opacity = '0';
      hintEl.style.transform = 'translateX(-50%) translateY(-10px)';
      setTimeout(() => {
        hintEl.remove();
      }, 500);
    }, 8000); // æ˜¾ç¤º8ç§’
  }
  
  setupStepListener(step, element) {
    const handler = (e) => {
      if (step.action === 'click' && e.type === 'click') {
        // å¯¹äºè´­ç‰©è½¦æŒ‰é’®ï¼Œéœ€è¦æ£€æŸ¥æ˜¯å¦æ˜¯ç¬¬ä¸€ä¸ª
        if (step.element === '.btn-add-cart') {
          // æ£€æŸ¥æ˜¯å¦æ˜¯ç¬¬ä¸€ä¸ªè´­ç‰©è½¦æŒ‰é’®
          const firstCartBtn = document.querySelector('.btn-add-cart');
          if (e.target === firstCartBtn || e.target.closest('.btn-add-cart') === firstCartBtn) {
            this.completeStep();
          }
        } else {
          this.completeStep();
        }
      } else if (step.action === 'hover' && e.type === 'mouseenter') {
        this.completeStep();
      }
    };
    
    if (step.action === 'click') {
      // å¯¹äºè´­ç‰©è½¦æŒ‰é’®ï¼Œç›‘å¬æ‰€æœ‰æŒ‰é’®
      if (step.element === '.btn-add-cart') {
        document.querySelectorAll('.btn-add-cart').forEach(btn => {
          btn.addEventListener('click', handler, { once: true });
        });
      } else {
        element.addEventListener('click', handler, { once: true });
      }
    } else if (step.action === 'hover') {
      element.addEventListener('mouseenter', handler, { once: true });
    }
    
    // æ»šåŠ¨ç›‘å¬
    if (step.action === 'scroll') {
      let scrollCount = 0;
      const scrollHandler = () => {
        scrollCount++;
        if (scrollCount >= 2) {
          shopPanel.removeEventListener('scroll', scrollHandler);
          this.completeStep();
        }
      };
      shopPanel.addEventListener('scroll', scrollHandler);
    }
  }
  
  completeStep() {
    this.steps[this.currentStep].completed = true;
    const stepEl = document.getElementById(this.steps[this.currentStep].id);
    if (stepEl) {
      stepEl.classList.remove('active');
      stepEl.classList.add('completed');
    }
    
    // æ¸…ç†é«˜äº®
    document.querySelectorAll('.guide-highlight').forEach(el => {
      el.classList.remove('guide-highlight');
    });
    document.querySelectorAll('.guide-arrow').forEach(el => {
      // æ¸…ç†æ»šåŠ¨ç›‘å¬
      if (el._cleanup) el._cleanup();
      el.remove();
    });
    document.querySelectorAll('.guide-hint').forEach(el => el.remove());
    
    // å»¶è¿Ÿæ˜¾ç¤ºä¸‹ä¸€æ­¥ï¼Œç»™ç”¨æˆ·æ—¶é—´ç†è§£å½“å‰æ­¥éª¤
    setTimeout(() => {
      this.showStep(this.currentStep + 1);
    }, 2000);
  }
  
  completeGuide() {
    this.guideActive = false;
    document.getElementById('guideSteps').style.display = 'none';
    document.querySelectorAll('.guide-highlight').forEach(el => {
      el.classList.remove('guide-highlight');
    });
    document.querySelectorAll('.guide-arrow').forEach(el => {
      // æ¸…ç†æ»šåŠ¨ç›‘å¬
      if (el._cleanup) el._cleanup();
      el.remove();
    });
    document.querySelectorAll('.guide-hint').forEach(el => el.remove());
    
    // ä¸åœ¨è¿™é‡Œè§¦å‘å®Œæˆç‰¹æ•ˆï¼Œè®©ç”¨æˆ·è‡ªç„¶å®Œæˆæ‰€æœ‰è¡Œä¸º
  }
}

// åˆå§‹åŒ–å¼•å¯¼ç³»ç»Ÿ
const guideSystem = new GuideSystem();
guideSystem.init();

// ç›‘å¬æ»šåŠ¨å®Œæˆç¬¬ä¸€æ­¥
let scrollStepCompleted = false;
shopPanel.addEventListener('scroll', () => {
  if (!scrollStepCompleted && guideSystem.guideActive && guideSystem.currentStep === 0) {
    scrollStepCompleted = true;
    setTimeout(() => {
      if (guideSystem.currentStep === 0) {
        guideSystem.completeStep();
      }
    }, 2000);
  }
});

// å®Œæˆæ£€æµ‹å’Œç‰¹æ•ˆ
let completionShown = false;

function checkAndShowCompletion() {
  if (completionShown) return;
  
  // æ£€æŸ¥æ˜¯å¦å®Œæˆäº†æ‰€æœ‰å…³é”®è¡Œä¸º
  const behaviors = intentEngine.behaviors;
  const hasScroll = behaviors.some(b => b.type === 'scroll');
  const hasHover = behaviors.some(b => b.type === 'hover');
  const hasClick = behaviors.some(b => b.type === 'click');
  const hasAddCart = behaviors.some(b => b.type === 'click' && b.data.action === 'add-cart');
  const hasView = behaviors.some(b => b.type === 'view');
  const hasBannerClick = behaviors.some(b => b.type === 'click' && b.data.element === 'banner-button');
  const hasCategoryClick = behaviors.some(b => b.type === 'click' && b.data.element === 'category-filter');
  
  // å¿…é¡»å®Œæˆçš„å…³é”®è¡Œä¸ºï¼š
  // 1. è‡³å°‘12ä¸ªè¡Œä¸ºäº‹ä»¶ï¼ˆç¡®ä¿æœ‰è¶³å¤Ÿçš„äº¤äº’ï¼‰
  // 2. å¿…é¡»åŒ…å«æ»šåŠ¨
  // 3. å¿…é¡»åŒ…å«æ‚¬åœï¼ˆè‡³å°‘2æ¬¡ï¼‰
  // 4. å¿…é¡»åŒ…å«ç‚¹å‡»ï¼ˆè‡³å°‘2æ¬¡ï¼‰
  // 5. å¿…é¡»åŒ…å«åŠ å…¥è´­ç‰©è½¦ï¼ˆå…³é”®è½¬åŒ–è¡Œä¸ºï¼‰
  // 6. å¿…é¡»åŒ…å«Bannerç‚¹å‡»æˆ–åˆ†ç±»ç‚¹å‡»ï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰
  
  const hoverCount = behaviors.filter(b => b.type === 'hover').length;
  const clickCount = behaviors.filter(b => b.type === 'click').length;
  
  const allRequirementsMet = 
    behaviors.length >= 12 &&
    hasScroll &&
    hoverCount >= 2 &&
    clickCount >= 2 &&
    hasAddCart &&
    (hasBannerClick || hasCategoryClick || hasView);
  
  if (allRequirementsMet) {
    showCompletion();
    completionShown = true;
  }
}

function showCompletion() {
  const overlay = document.getElementById('completionOverlay');
  const statsContainer = document.getElementById('completionStats');
  
  // è®¡ç®—ç»Ÿè®¡æ•°æ®
  const behaviors = intentEngine.behaviors;
  const scrollCount = behaviors.filter(b => b.type === 'scroll').length;
  const hoverCount = behaviors.filter(b => b.type === 'hover').length;
  const clickCount = behaviors.filter(b => b.type === 'click').length;
  const addCartCount = behaviors.filter(b => b.type === 'click' && b.data.action === 'add-cart').length;
  const conversionStage = intentEngine.intentData.conversion_stage || 'awareness';
  
  // å¡«å……ç»Ÿè®¡æ•°æ®
  statsContainer.innerHTML = `
    <div class="completion-stat">
      <span class="completion-stat-value">${behaviors.length}</span>
      <span class="completion-stat-label">è¡Œä¸ºäº‹ä»¶</span>
    </div>
    <div class="completion-stat">
      <span class="completion-stat-value">${intentEngine.intentData.core_interests.length}</span>
      <span class="completion-stat-label">å…´è¶£æ ‡ç­¾</span>
    </div>
    <div class="completion-stat">
      <span class="completion-stat-value">${addCartCount}</span>
      <span class="completion-stat-label">åŠ å…¥è´­ç‰©è½¦</span>
    </div>
  `;
  
  // æ˜¾ç¤ºå¼¹çª—
  overlay.classList.add('show');
  
  // è§¦å‘çƒŸèŠ±å’Œå½©çº¸ç‰¹æ•ˆ
  createFireworks();
  createConfetti();
  
  // æ·»åŠ é—ªçƒæ˜Ÿæ˜Ÿ
  addSparkles();
}

function createFireworks() {
  const colors = ['#00ff88', '#7da6ff', '#00cc6f', '#6b95ff'];
  const centerX = window.innerWidth / 2;
  const centerY = window.innerHeight / 2;
  
  for (let i = 0; i < 8; i++) {
    setTimeout(() => {
      const angle = (Math.PI * 2 * i) / 8;
      const distance = 150 + Math.random() * 100;
      
      for (let j = 0; j < 12; j++) {
        const particleAngle = (Math.PI * 2 * j) / 12;
        const particleDistance = 50 + Math.random() * 50;
        const x = Math.cos(particleAngle) * particleDistance;
        const y = Math.sin(particleAngle) * particleDistance;
        
        const firework = document.createElement('div');
        firework.className = 'firework';
        const color = colors[Math.floor(Math.random() * colors.length)];
        firework.style.background = color;
        firework.style.color = color;
        firework.style.left = centerX + 'px';
        firework.style.top = centerY + 'px';
        
        // ä½¿ç”¨transformåŠ¨ç”»
        const startX = 0;
        const startY = 0;
        firework.style.transform = `translate(${startX}px, ${startY}px) scale(1)`;
        firework.style.opacity = '1';
        
        // è§¦å‘åŠ¨ç”»
        requestAnimationFrame(() => {
          firework.style.transition = 'all 0.8s ease-out';
          firework.style.transform = `translate(${x}px, ${y}px) scale(0)`;
          firework.style.opacity = '0';
        });
        
        document.body.appendChild(firework);
        
        setTimeout(() => firework.remove(), 800);
      }
    }, i * 100);
  }
}

function createConfetti() {
  const colors = ['#00ff88', '#7da6ff', '#00cc6f', '#6b95ff', '#ffffff'];
  
  for (let i = 0; i < 50; i++) {
    setTimeout(() => {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.left = Math.random() * 100 + '%';
      confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
      confetti.style.animationDelay = Math.random() * 0.5 + 's';
      confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
      document.body.appendChild(confetti);
      
      setTimeout(() => confetti.remove(), 3000);
    }, i * 30);
  }
}

function addSparkles() {
  const modal = document.querySelector('.completion-modal');
  const sparklePositions = [
    { top: '20%', left: '15%' },
    { top: '30%', right: '20%' },
    { top: '60%', left: '10%' },
    { top: '70%', right: '15%' },
    { top: '50%', left: '50%' }
  ];
  
  sparklePositions.forEach((pos, index) => {
    setTimeout(() => {
      const sparkle = document.createElement('div');
      sparkle.className = 'sparkle';
      Object.assign(sparkle.style, pos);
      sparkle.style.animationDelay = index * 0.2 + 's';
      modal.appendChild(sparkle);
      
      setTimeout(() => sparkle.remove(), 2000);
    }, index * 200);
  });
}

function closeCompletion() {
  const overlay = document.getElementById('completionOverlay');
  overlay.classList.remove('show');
  
  setTimeout(() => {
    overlay.style.display = 'none';
  }, 500);
}

// ç›‘å¬è¡Œä¸ºå˜åŒ–ï¼Œè‡ªåŠ¨æ£€æµ‹å®Œæˆ
let lastBehaviorCount = 0;
setInterval(() => {
  if (intentEngine.behaviors.length !== lastBehaviorCount) {
    lastBehaviorCount = intentEngine.behaviors.length;
    // åªåœ¨è¡Œä¸ºæ•°é‡è¾¾åˆ°ä¸€å®šé˜ˆå€¼åæ‰å¼€å§‹æ£€æŸ¥ï¼ˆé¿å…è¿‡æ—©è§¦å‘ï¼‰
    if (!completionShown && intentEngine.behaviors.length >= 10) {
      checkAndShowCompletion();
    }
  }
}, 1000);

// è§†é¢‘æ’­æ”¾å™¨æ§åˆ¶
const videoPlayer = document.getElementById('productVideo');
const videoWidget = document.getElementById('videoPlayerWidget');
const zoomInBtn = document.getElementById('zoomInBtn');
const zoomOutBtn = document.getElementById('zoomOutBtn');
const muteBtn = document.getElementById('muteBtn');
const muteIcon = document.getElementById('muteIcon');
const fullscreenBtn = document.getElementById('fullscreenBtn');
const closeBtn = document.getElementById('closeBtn');
const videoProductCard = document.querySelector('.video-product-card');

let isMuted = true; // åˆå§‹ä¸ºé™éŸ³ï¼ˆautoplayéœ€è¦ï¼‰
let currentZoom = 'normal'; // normal, zoomed, zoomed-out
let videoWatchStartTime = null;
let videoWatchDuration = 0;
let videoHoverStartTime = null;
let isVideoHovered = false;

// è§†é¢‘è§‚çœ‹æ—¶é•¿è¿½è¸ª
videoPlayer.addEventListener('play', () => {
  videoWatchStartTime = Date.now();
  intentEngine.recordBehavior('video-play', {
    element: 'product-video',
    product: 'F1 Floating Pillow',
    action: 'play'
  });
});

videoPlayer.addEventListener('pause', () => {
  if (videoWatchStartTime) {
    videoWatchDuration += Date.now() - videoWatchStartTime;
    intentEngine.recordBehavior('video-pause', {
      element: 'product-video',
      product: 'F1 Floating Pillow',
      action: 'pause',
      watchDuration: Math.round((Date.now() - videoWatchStartTime) / 1000)
    });
    videoWatchStartTime = null;
  }
});

// è§†é¢‘è§‚çœ‹æ—¶é•¿å®šæœŸè®°å½•ï¼ˆæ¯5ç§’ï¼‰
setInterval(() => {
  if (videoWatchStartTime && !videoPlayer.paused) {
    const currentWatchTime = Math.round((Date.now() - videoWatchStartTime + videoWatchDuration) / 1000);
    if (currentWatchTime % 5 === 0) { // æ¯5ç§’è®°å½•ä¸€æ¬¡
      intentEngine.recordBehavior('video-watch', {
        element: 'product-video',
        product: 'F1 Floating Pillow',
        action: 'watching',
        watchDuration: currentWatchTime
      });
    }
  }
}, 1000);

// è§†é¢‘æ‚¬åœäº‹ä»¶
videoWidget.addEventListener('mouseenter', () => {
  if (!isVideoHovered) {
    isVideoHovered = true;
    videoHoverStartTime = Date.now();
    intentEngine.recordBehavior('hover', {
      element: 'product-video-widget',
      product: 'F1 Floating Pillow',
      type: 'video-hover'
    });
  }
});

videoWidget.addEventListener('mouseleave', () => {
  if (isVideoHovered && videoHoverStartTime) {
    const hoverDuration = Math.round((Date.now() - videoHoverStartTime) / 1000);
    intentEngine.recordBehavior('video-hover-end', {
      element: 'product-video-widget',
      product: 'F1 Floating Pillow',
      hoverDuration: hoverDuration
    });
    isVideoHovered = false;
    videoHoverStartTime = null;
  }
});

// è§†é¢‘ç‚¹å‡»äº‹ä»¶
videoPlayer.addEventListener('click', (e) => {
  if (e.target === videoPlayer) {
    intentEngine.recordBehavior('click', {
      element: 'product-video',
      product: 'F1 Floating Pillow',
      action: 'video-click'
    });
  }
});

// æ”¾å¤§åŠŸèƒ½
zoomInBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  videoWidget.classList.remove('zoomed-out');
  if (currentZoom === 'normal') {
    videoWidget.classList.add('zoomed');
    currentZoom = 'zoomed';
    intentEngine.recordBehavior('click', {
      element: 'video-control',
      action: 'zoom-in',
      product: 'F1 Floating Pillow',
      zoomLevel: 'zoomed'
    });
  } else if (currentZoom === 'zoomed-out') {
    videoWidget.classList.remove('zoomed-out');
    currentZoom = 'normal';
    intentEngine.recordBehavior('click', {
      element: 'video-control',
      action: 'zoom-reset',
      product: 'F1 Floating Pillow',
      zoomLevel: 'normal'
    });
  }
});

// ç¼©å°åŠŸèƒ½
zoomOutBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  videoWidget.classList.remove('zoomed');
  if (currentZoom === 'normal') {
    videoWidget.classList.add('zoomed-out');
    currentZoom = 'zoomed-out';
    intentEngine.recordBehavior('click', {
      element: 'video-control',
      action: 'zoom-out',
      product: 'F1 Floating Pillow',
      zoomLevel: 'zoomed-out'
    });
  } else if (currentZoom === 'zoomed') {
    videoWidget.classList.remove('zoomed');
    currentZoom = 'normal';
    intentEngine.recordBehavior('click', {
      element: 'video-control',
      action: 'zoom-reset',
      product: 'F1 Floating Pillow',
      zoomLevel: 'normal'
    });
  }
});

// é™éŸ³/å–æ¶ˆé™éŸ³åŠŸèƒ½
muteBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  if (videoPlayer.muted) {
    videoPlayer.muted = false;
    muteIcon.innerHTML = `
      <path d="M11 5L6 9H2v6h4l5 4V5zM15.54 8.46a5 5 0 010 7.07M19.07 4.93a10 10 0 010 14.14"/>
    `;
    isMuted = false;
    intentEngine.recordBehavior('click', {
      element: 'video-control',
      action: 'unmute',
      product: 'F1 Floating Pillow'
    });
  } else {
    videoPlayer.muted = true;
    muteIcon.innerHTML = `
      <path d="M11 5L6 9H2v6h4l5 4V5zM19.07 4.93a10 10 0 010 14.14M15.54 8.46a5 5 0 010 7.07"/>
    `;
    isMuted = true;
    intentEngine.recordBehavior('click', {
      element: 'video-control',
      action: 'mute',
      product: 'F1 Floating Pillow'
    });
  }
});

// å…¨å±åŠŸèƒ½
fullscreenBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  if (videoPlayer.requestFullscreen) {
    videoPlayer.requestFullscreen();
  } else if (videoPlayer.webkitRequestFullscreen) {
    videoPlayer.webkitRequestFullscreen();
  } else if (videoPlayer.mozRequestFullScreen) {
    videoPlayer.mozRequestFullScreen();
  } else if (videoPlayer.msRequestFullscreen) {
    videoPlayer.msRequestFullscreen();
  }
  intentEngine.recordBehavior('click', {
    element: 'video-control',
    action: 'fullscreen',
    product: 'F1 Floating Pillow'
  });
});

// äº§å“å¡ç‰‡ç‚¹å‡»äº‹ä»¶
if (videoProductCard) {
  videoProductCard.addEventListener('click', (e) => {
    e.stopPropagation();
    intentEngine.recordBehavior('click', {
      element: 'video-product-card',
      product: 'F1 Floating Pillow',
      action: 'view-product-details',
      price: 'USD 139.0'
    });
  });
  
  videoProductCard.style.cursor = 'pointer';
}

// æ›´æ–°é™éŸ³å›¾æ ‡çŠ¶æ€
videoPlayer.addEventListener('volumechange', () => {
  if (videoPlayer.muted) {
    muteIcon.innerHTML = `
      <path d="M11 5L6 9H2v6h4l5 4V5zM19.07 4.93a10 10 0 010 14.14M15.54 8.46a5 5 0 010 7.07"/>
    `;
  } else {
    muteIcon.innerHTML = `
      <path d="M11 5L6 9H2v6h4l5 4V5zM15.54 8.46a5 5 0 010 7.07M19.07 4.93a10 10 0 010 14.14"/>
    `;
  }
});

// è§†é¢‘åŠ è½½é”™è¯¯å¤„ç†
videoPlayer.addEventListener('error', () => {
  console.warn('è§†é¢‘åŠ è½½å¤±è´¥ï¼Œè¯·ç¡®ä¿ products/product-video.mp4 æ–‡ä»¶å­˜åœ¨');
});

// ç¡®ä¿è§†é¢‘å¾ªç¯æ’­æ”¾
videoPlayer.addEventListener('ended', () => {
  videoPlayer.currentTime = 0;
  videoPlayer.play();
});
</script>

<!-- è§†é¢‘æ’­æ”¾å™¨æ’ä»¶ï¼ˆç‹¬ç«‹æ‚¬æµ®åœ¨æ¨¡æ‹Ÿç½‘é¡µä¸Šæ–¹ï¼‰ -->
<div class="video-player-widget" id="videoPlayerWidget">
  <video id="productVideo" class="product-video" autoplay loop muted playsinline>
    <source src="products/product-video.mp4" type="video/mp4">
    <source src="products/product-video.webm" type="video/webm">
    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
  </video>
  <div class="video-controls-overlay">
    <!-- é¡¶éƒ¨æ§åˆ¶åŒºåŸŸ -->
    <div class="video-controls-top">
      <!-- å·¦ä¸Šè§’ï¼šå…³é—­æŒ‰é’® -->
      <div class="video-controls-top-left">
        <button class="video-control-btn" id="closeBtn" title="å…³é—­" style="display: none;">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <!-- å³ä¸Šè§’ï¼šå…¨å±å’Œé™éŸ³æŒ‰é’® -->
      <div class="video-controls-top-right">
        <button class="video-control-btn" id="fullscreenBtn" title="å…¨å±">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M8 3H5a2 2 0 00-2 2v3m18 0V5a2 2 0 00-2-2h-3m0 18h3a2 2 0 002-2v-3M3 16v3a2 2 0 002 2h3"/>
          </svg>
        </button>
        <button class="video-control-btn" id="muteBtn" title="é™éŸ³/å–æ¶ˆé™éŸ³">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="muteIcon">
            <path d="M11 5L6 9H2v6h4l5 4V5zM19.07 4.93a10 10 0 010 14.14M15.54 8.46a5 5 0 010 7.07"/>
          </svg>
        </button>
      </div>
    </div>
    
    <!-- å³ä¾§å‚ç›´æ ‡ç­¾ï¼šReviews -->
    <div class="video-side-label">Reviews</div>
    
    <!-- åº•éƒ¨äº§å“ä¿¡æ¯è¦†ç›–å±‚ -->
    <div class="video-product-overlay">
      <div class="video-product-card">
        <div class="video-product-thumbnail">
          <img src="products/pillow.jpg" alt="F1 Floating Pillow" 
               onerror="this.onerror=null; this.style.display='none'; this.parentElement.querySelector('.thumbnail-placeholder').style.display='block';"
               onload="this.parentElement.classList.add('has-image'); this.parentElement.querySelector('.thumbnail-placeholder').style.display='none';">
          <svg width="50" height="50" viewBox="0 0 50 50" class="thumbnail-placeholder" style="position: absolute; top: 0; left: 0; z-index: 1;">
            <defs>
              <linearGradient id="pillowGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#7da6ff;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#60a5fa;stop-opacity:1" />
              </linearGradient>
            </defs>
            <rect width="50" height="50" rx="6" fill="url(#pillowGradient)"/>
            <rect x="8" y="12" width="34" height="26" rx="4" fill="rgba(255,255,255,0.3)"/>
            <rect x="12" y="16" width="26" height="18" rx="3" fill="rgba(255,255,255,0.2)"/>
          </svg>
        </div>
        <div class="video-product-info">
          <div class="video-product-name">Nitetronic F1 Floating Pillow</div>
          <div class="video-product-price">
            <span class="video-product-original-price">USD 169.0</span>
            <span class="video-product-discount-price">USD 139.0</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- å³ä¾§æ§åˆ¶æŒ‰é’®ï¼ˆç¼©æ”¾ï¼‰ -->
    <div class="video-controls-right">
      <button class="video-control-btn" id="zoomInBtn" title="æ”¾å¤§">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/>
          <path d="M21 21l-4.35-4.35M11 8v6M8 11h6"/>
        </svg>
      </button>
      <button class="video-control-btn" id="zoomOutBtn" title="ç¼©å°">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/>
          <path d="M21 21l-4.35-4.35M8 11h6"/>
        </svg>
      </button>
    </div>
  </div>
</div>
</body>
</html>
